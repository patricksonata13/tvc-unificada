"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=parse;var _HermesParserDeserializer=_interopRequireDefault(require("./HermesParserDeserializer")),_HermesParserWASM=_interopRequireDefault(require("./HermesParserWASM"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let HermesParserWASM,hermesParse,hermesParseResult_free,hermesParseResult_getError,hermesParseResult_getErrorLine,hermesParseResult_getErrorColumn,hermesParseResult_getProgramBuffer,hermesParseResult_getPositionBuffer,hermesParseResult_getPositionBufferSize;function initHermesParserWASM(){null==HermesParserWASM&&(HermesParserWASM=(0,_HermesParserWASM.default)({quit(e,r){throw r}}),hermesParse=HermesParserWASM.cwrap("hermesParse","number",["number","number","number","number","number","number","number"]),hermesParseResult_free=HermesParserWASM.cwrap("hermesParseResult_free","void",["number"]),hermesParseResult_getError=HermesParserWASM.cwrap("hermesParseResult_getError","string",["number"]),hermesParseResult_getErrorLine=HermesParserWASM.cwrap("hermesParseResult_getErrorLine","number",["number"]),hermesParseResult_getErrorColumn=HermesParserWASM.cwrap("hermesParseResult_getErrorColumn","number",["number"]),hermesParseResult_getProgramBuffer=HermesParserWASM.cwrap("hermesParseResult_getProgramBuffer","number",["number"]),hermesParseResult_getPositionBuffer=HermesParserWASM.cwrap("hermesParseResult_getPositionBuffer","number",["number"]),hermesParseResult_getPositionBufferSize=HermesParserWASM.cwrap("hermesParseResult_getPositionBufferSize","number",["number"]))}function copyToHeap(e,r){HermesParserWASM.HEAP8.set(e,r),HermesParserWASM.HEAP8[r+e.length]=0}function parse(e,r){initHermesParserWASM();const s=Buffer.from(e,"utf8"),t=HermesParserWASM._malloc(s.length+1);if(!t)throw new Error("Parser out of memory");try{copyToHeap(s,t);const e=hermesParse(t,s.length+1,"detect"===r.flow,r.enableExperimentalComponentSyntax,r.enableExperimentalFlowMatchSyntax,r.tokens,r.allowReturnOutsideFunction);try{const s=hermesParseResult_getError(e);if(s){const r=new SyntaxError(s);throw r.loc={line:hermesParseResult_getErrorLine(e),column:hermesParseResult_getErrorColumn(e)},r}return new _HermesParserDeserializer.default(hermesParseResult_getProgramBuffer(e),hermesParseResult_getPositionBuffer(e),hermesParseResult_getPositionBufferSize(e),HermesParserWASM,r).deserialize()}finally{hermesParseResult_free(e)}}finally{HermesParserWASM._free(t)}}