"use strict";function _fakeTimers(){const e=require("@sinonjs/fake-timers");return _fakeTimers=function(){return e},e}function _jestMessageUtil(){const e=require("jest-message-util");return _jestMessageUtil=function(){return e},e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class FakeTimers{_clock;_config;_fakingTime;_global;_fakeTimers;constructor({global:e,config:i}){this._global=e,this._config=i,this._fakingTime=!1,this._fakeTimers=(0,_fakeTimers().withGlobal)(e)}clearAllTimers(){this._fakingTime&&this._clock.reset()}dispose(){this.useRealTimers()}runAllTimers(){this._checkFakeTimers()&&this._clock.runAll()}async runAllTimersAsync(){this._checkFakeTimers()&&await this._clock.runAllAsync()}runOnlyPendingTimers(){this._checkFakeTimers()&&this._clock.runToLast()}async runOnlyPendingTimersAsync(){this._checkFakeTimers()&&await this._clock.runToLastAsync()}advanceTimersToNextTimer(e=1){if(this._checkFakeTimers())for(let i=e;i>0&&(this._clock.next(),this._clock.tick(0),0!==this._clock.countTimers());i--);}async advanceTimersToNextTimerAsync(e=1){if(this._checkFakeTimers())for(let i=e;i>0&&(await this._clock.nextAsync(),await this._clock.tickAsync(0),0!==this._clock.countTimers());i--);}advanceTimersByTime(e){this._checkFakeTimers()&&this._clock.tick(e)}async advanceTimersByTimeAsync(e){this._checkFakeTimers()&&await this._clock.tickAsync(e)}runAllTicks(){this._checkFakeTimers()&&this._clock.runMicrotasks()}useRealTimers(){this._fakingTime&&(this._clock.uninstall(),this._fakingTime=!1)}useFakeTimers(e){this._fakingTime&&this._clock.uninstall(),this._clock=this._fakeTimers.install(this._toSinonFakeTimersConfig(e)),this._fakingTime=!0}reset(){if(this._checkFakeTimers()){const{now:e}=this._clock;this._clock.reset(),this._clock.setSystemTime(e)}}setSystemTime(e){this._checkFakeTimers()&&this._clock.setSystemTime(e)}getRealSystemTime(){return Date.now()}now(){return this._fakingTime?this._clock.now:Date.now()}getTimerCount(){return this._checkFakeTimers()?this._clock.countTimers():0}_checkFakeTimers(){return this._fakingTime||this._global.console.warn(`A function to advance timers was called but the timers APIs are not replaced with fake timers. Call \`jest.useFakeTimers()\` in this test file or enable fake timers for all tests by setting 'fakeTimers': {'enableGlobally': true} in Jest configuration file.\nStack Trace:\n${(0,_jestMessageUtil().formatStackTrace)((new Error).stack,this._config,{noStackTrace:!1})}`),this._fakingTime}_toSinonFakeTimersConfig(e={}){const i="number"==typeof(e={...this._config.fakeTimers,...e}).advanceTimers?e.advanceTimers:void 0,s=new Set(Object.keys(this._fakeTimers.timers));return e.doNotFake?.forEach(e=>{s.delete(e)}),{advanceTimeDelta:i,loopLimit:e.timerLimit||1e5,now:e.now??Date.now(),shouldAdvanceTime:Boolean(e.advanceTimers),shouldClearNativeTimers:!0,toFake:Array.from(s)}}}exports.default=FakeTimers;