import{createRequestHandler as createExpoHandler}from"./abstract";import{createRequestScope}from"../runtime";import{createNodeEnv}from"./environment/node";export{ExpoError}from"./abstract";const scopeSymbol=Symbol.for("expoServerScope");function getContext(){const e=globalThis;if(!e.Netlify)throw new Error('"globalThis.Netlify" is missing but expected.\n- Are you using Netlify Server Functions 1.0 instead of 2.0?\n- Make sure your Netlify function has a default export instead of exporting "handler".');return e.Netlify?.context??{}}const STORE={getStore:()=>getContext()[scopeSymbol],run:(e,t,...o)=>(getContext()[scopeSymbol]=e,t(...o))};export function createRequestHandler(e){const t=createRequestScope(STORE,(e,t)=>({origin:(t??getContext()).site?.url||e.headers.get("Origin")||"null",environment:(t??getContext()).deploy?.context||null,waitUntil:(t??getContext()).waitUntil})),o=createExpoHandler(createNodeEnv(e));return async(e,r)=>{if("multiValueHeaders"in e)throw new Error('Unexpected Request object. API was called by Netlify Server Functions 1.0\n- Make sure your Netlify function has a default export instead of exporting "handler".');return await t(o,e,r)}}