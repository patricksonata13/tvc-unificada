"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createNodeEnv=createNodeEnv,exports.createNodeRequestScope=createNodeRequestScope;const node_fs_1=__importDefault(require("node:fs")),node_path_1=__importDefault(require("node:path")),common_1=require("./common"),ImmutableRequest_1=require("../../ImmutableRequest"),runtime_1=require("../../runtime");function createNodeEnv(e){async function t(t){const n=node_path_1.default.join(e.build,t);if(!node_fs_1.default.existsSync(n))return null;try{return await node_fs_1.default.promises.readFile(n,"utf-8")}catch{return null}}return(0,ImmutableRequest_1.assertRuntimeFetchAPISupport)(),(0,common_1.createEnvironment)({readText:t,readJson:async function(e){const n=await t(e);return null!=n?JSON.parse(n):null},loadModule:async function(t){const n=node_path_1.default.join(e.build,t);return node_fs_1.default.existsSync(n)?/\.c?js$/.test(n)?require(n):await import(n):null}})}function createNodeRequestScope(e,t){return(0,runtime_1.createRequestScope)(e,e=>({origin:e.headers.get("Origin")||"null",environment:t.environment??process.env.NODE_ENV}))}