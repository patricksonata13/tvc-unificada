import fs from"node:fs";import path from"node:path";import{createEnvironment}from"./common";import{assertRuntimeFetchAPISupport}from"../../ImmutableRequest";import{createRequestScope}from"../../runtime";export function createNodeEnv(e){async function t(t){const n=path.join(e.build,t);if(!fs.existsSync(n))return null;try{return await fs.promises.readFile(n,"utf-8")}catch{return null}}return assertRuntimeFetchAPISupport(),createEnvironment({readText:t,readJson:async function(e){const n=await t(e);return null!=n?JSON.parse(n):null},loadModule:async function(t){const n=path.join(e.build,t);return fs.existsSync(n)?/\.c?js$/.test(n)?require(n):await import(n):null}})}export function createNodeRequestScope(e,t){return createRequestScope(e,e=>({origin:e.headers.get("Origin")||"null",environment:t.environment??process.env.NODE_ENV}))}