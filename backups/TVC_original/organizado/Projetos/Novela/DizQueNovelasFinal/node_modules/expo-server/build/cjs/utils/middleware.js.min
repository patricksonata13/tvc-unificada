"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shouldRunMiddleware=shouldRunMiddleware;const matchers_1=require("./matchers");function shouldRunMiddleware(e,t){const r=t.unstable_settings?.matcher;if(!r)return!0;const a=new URL(e.url).pathname;if(r.methods){const t=r.methods.map(e=>e.toUpperCase());if(0===t.length||!t.includes(e.method))return!1}if(r.patterns){const e=Array.isArray(r.patterns)?r.patterns:[r.patterns];return 0!==e.length&&e.some(e=>matchesPattern(a,e))}return!0}function matchesPattern(e,t){if("string"==typeof t){if(t===e)return!0;if(hasNamedParameters(t))return namedParamToRegex(t).test(e)}else if(null!=t)return t.test(e);return!1}function hasNamedParameters(e){return e.split("/").some(e=>(0,matchers_1.matchDynamicName)(e)||(0,matchers_1.matchDeepDynamicRouteName)(e))}function namedParamToRegex(e){const t=(e.replace(/\/$/,"")||"/").split("/").map(e=>e?(0,matchers_1.matchDeepDynamicRouteName)(e)?".+":(0,matchers_1.matchDynamicName)(e)?"[^/]+":e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):"");return new RegExp(`^${t.join("/")}(?:/)?$`)}