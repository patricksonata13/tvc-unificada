import{matchDynamicName,matchDeepDynamicRouteName}from"./matchers";export function shouldRunMiddleware(e,t){const a=t.unstable_settings?.matcher;if(!a)return!0;const n=new URL(e.url).pathname;if(a.methods){const t=a.methods.map(e=>e.toUpperCase());if(0===t.length||!t.includes(e.method))return!1}if(a.patterns){const e=Array.isArray(a.patterns)?a.patterns:[a.patterns];return 0!==e.length&&e.some(e=>matchesPattern(n,e))}return!0}function matchesPattern(e,t){if("string"==typeof t){if(t===e)return!0;if(hasNamedParameters(t))return namedParamToRegex(t).test(e)}else if(null!=t)return t.test(e);return!1}function hasNamedParameters(e){return e.split("/").some(e=>matchDynamicName(e)||matchDeepDynamicRouteName(e))}function namedParamToRegex(e){const t=(e.replace(/\/$/,"")||"/").split("/").map(e=>e?matchDeepDynamicRouteName(e)?".+":matchDynamicName(e)?"[^/]+":e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):"");return new RegExp(`^${t.join("/")}(?:/)?$`)}