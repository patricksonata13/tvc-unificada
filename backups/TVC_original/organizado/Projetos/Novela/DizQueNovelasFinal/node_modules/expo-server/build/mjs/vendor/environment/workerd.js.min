import{createEnvironment}from"./common";import{createRequestScope}from"../../runtime";const createCachedImport=()=>{const e=new Map;return async function(t){let r=e.get(t);if(!r){try{r={type:"success",value:await import(t)}}catch(e){r={type:"error",value:e}}e.set(t,r)}if("success"===r.type)return r.value;throw r.value}};export function createWorkerdEnv(e){const t=e.build||".",r=createCachedImport();return createEnvironment({readText:async function(e){try{return(await r(`${t}/${e}`)).default}catch{return null}},readJson:async function(e){try{const n=await r(`${t}/${e}`);return"string"==typeof n.default&&"{"===n.default[0]?JSON.parse(n.default):n.default}catch{return null}},loadModule:async function(e){const r=`${t}/${e}`;return(await import(r)).default}})}export function createWorkerdRequestScope(e,t){return createRequestScope(e,(e,r,n)=>({origin:e.headers.get("Origin")||"null",environment:t.environment??null,waitUntil:n.waitUntil?.bind(n)}))}