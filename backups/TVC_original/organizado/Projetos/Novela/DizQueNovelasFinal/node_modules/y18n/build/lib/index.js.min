let shim;class Y18N{constructor(e){e=e||{},this.directory=e.directory||"./locales",this.updateFiles="boolean"!=typeof e.updateFiles||e.updateFiles,this.locale=e.locale||"en",this.fallbackToLanguage="boolean"!=typeof e.fallbackToLanguage||e.fallbackToLanguage,this.cache=Object.create(null),this.writeQueue=[]}__(...e){if("string"!=typeof arguments[0])return this._taggedLiteral(arguments[0],...arguments);const t=e.shift();let i=function(){};return"function"==typeof e[e.length-1]&&(i=e.pop()),i=i||function(){},this.cache[this.locale]||this._readLocaleFile(),!this.cache[this.locale][t]&&this.updateFiles?(this.cache[this.locale][t]=t,this._enqueueWrite({directory:this.directory,locale:this.locale,cb:i})):i(),shim.format.apply(shim.format,[this.cache[this.locale][t]||t].concat(e))}__n(){const e=Array.prototype.slice.call(arguments),t=e.shift(),i=e.shift(),s=e.shift();let c=function(){};"function"==typeof e[e.length-1]&&(c=e.pop()),this.cache[this.locale]||this._readLocaleFile();let l=1===s?t:i;if(this.cache[this.locale][t]){l=this.cache[this.locale][t][1===s?"one":"other"]}!this.cache[this.locale][t]&&this.updateFiles?(this.cache[this.locale][t]={one:t,other:i},this._enqueueWrite({directory:this.directory,locale:this.locale,cb:c})):c();const o=[l];return~l.indexOf("%d")&&o.push(s),shim.format.apply(shim.format,o.concat(e))}setLocale(e){this.locale=e}getLocale(){return this.locale}updateLocale(e){this.cache[this.locale]||this._readLocaleFile();for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this.cache[this.locale][t]=e[t])}_taggedLiteral(e,...t){let i="";return e.forEach(function(e,s){const c=t[s+1];i+=e,void 0!==c&&(i+="%s")}),this.__.apply(this,[i].concat([].slice.call(t,1)))}_enqueueWrite(e){this.writeQueue.push(e),1===this.writeQueue.length&&this._processWriteQueue()}_processWriteQueue(){const e=this,t=this.writeQueue[0],i=t.directory,s=t.locale,c=t.cb,l=this._resolveLocaleFile(i,s),o=JSON.stringify(this.cache[s],null,2);shim.fs.writeFile(l,o,"utf-8",function(t){e.writeQueue.shift(),e.writeQueue.length>0&&e._processWriteQueue(),c(t)})}_readLocaleFile(){let e={};const t=this._resolveLocaleFile(this.directory,this.locale);try{shim.fs.readFileSync&&(e=JSON.parse(shim.fs.readFileSync(t,"utf-8")))}catch(i){if(i instanceof SyntaxError&&(i.message="syntax error in "+t),"ENOENT"!==i.code)throw i;e={}}this.cache[this.locale]=e}_resolveLocaleFile(e,t){let i=shim.resolve(e,"./",t+".json");if(this.fallbackToLanguage&&!this._fileExistsSync(i)&&~t.lastIndexOf("_")){const s=shim.resolve(e,"./",t.split("_")[0]+".json");this._fileExistsSync(s)&&(i=s)}return i}_fileExistsSync(e){return shim.exists(e)}}export function y18n(e,t){shim=t;const i=new Y18N(e);return{__:i.__.bind(i),__n:i.__n.bind(i),setLocale:i.setLocale.bind(i),getLocale:i.getLocale.bind(i),updateLocale:i.updateLocale.bind(i),locale:i.locale}}