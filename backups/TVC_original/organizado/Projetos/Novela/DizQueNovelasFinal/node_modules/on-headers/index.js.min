/*!
 * on-headers
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */
"use strict";module.exports=onHeaders;var http=require("http"),isAppendHeaderSupported="function"==typeof http.ServerResponse.prototype.appendHeader,set1dArray=isAppendHeaderSupported?set1dArrayWithAppend:set1dArrayWithSet;function createWriteHead(e,r){var t=!1;return function(a){var s=setWriteHeadHeaders.apply(this,arguments);return t||(t=!0,r.call(this),"number"==typeof s[0]&&this.statusCode!==s[0]&&(s[0]=this.statusCode,s.length=1)),e.apply(this,s)}}function onHeaders(e,r){if(!e)throw new TypeError("argument res is required");if("function"!=typeof r)throw new TypeError("argument listener must be a function");e.writeHead=createWriteHead(e.writeHead,r)}function setHeadersFromArray(e,r){if(r.length&&Array.isArray(r[0]))set2dArray(e,r);else{if(r.length%2!=0)throw new TypeError("headers array is malformed");set1dArray(e,r)}}function setHeadersFromObject(e,r){for(var t=Object.keys(r),a=0;a<t.length;a++){var s=t[a];s&&e.setHeader(s,r[s])}}function setWriteHeadHeaders(e){var r=arguments.length,t=r>1&&"string"==typeof arguments[1]?2:1,a=r>=t+1?arguments[t]:void 0;this.statusCode=e,Array.isArray(a)?setHeadersFromArray(this,a):a&&setHeadersFromObject(this,a);for(var s=new Array(Math.min(r,t)),n=0;n<s.length;n++)s[n]=arguments[n];return s}function set2dArray(e,r){for(var t,a=0;a<r.length;a++)(t=r[a][0])&&e.setHeader(t,r[a][1])}function set1dArrayWithAppend(e,r){for(var t=0;t<r.length;t+=2)e.removeHeader(r[t]);for(var a,s=0;s<r.length;s+=2)(a=r[s])&&e.appendHeader(a,r[s+1])}function set1dArrayWithSet(e,r){for(var t,a=0;a<r.length;a+=2)(t=r[a])&&e.setHeader(t,r[a+1])}