module.exports=globSync,globSync.GlobSync=GlobSync;var rp=require("fs.realpath"),minimatch=require("minimatch"),Minimatch=minimatch.Minimatch,Glob=require("./glob.js").Glob,util=require("util"),path=require("path"),assert=require("assert"),isAbsolute=require("path-is-absolute"),common=require("./common.js"),setopts=common.setopts,ownProp=common.ownProp,childrenIgnored=common.childrenIgnored,isIgnored=common.isIgnored;function globSync(t,r){if("function"==typeof r||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new GlobSync(t,r).found}function GlobSync(t,r){if(!t)throw new Error("must provide pattern");if("function"==typeof r||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof GlobSync))return new GlobSync(t,r);if(setopts(this,t,r),this.noprocess)return this;var i=this.minimatch.set.length;this.matches=new Array(i);for(var s=0;s<i;s++)this._process(this.minimatch.set[s],s,!1);this._finish()}GlobSync.prototype._finish=function(){if(assert.ok(this instanceof GlobSync),this.realpath){var t=this;this.matches.forEach(function(r,i){var s=t.matches[i]=Object.create(null);for(var e in r)try{e=t._makeAbs(e),s[rp.realpathSync(e,t.realpathCache)]=!0}catch(r){if("stat"!==r.syscall)throw r;s[t._makeAbs(e)]=!0}})}common.finish(this)},GlobSync.prototype._process=function(t,r,i){assert.ok(this instanceof GlobSync);for(var s,e=0;"string"==typeof t[e];)e++;switch(e){case t.length:return void this._processSimple(t.join("/"),r);case 0:s=null;break;default:s=t.slice(0,e).join("/")}var o,c=t.slice(e);null===s?o=".":isAbsolute(s)||isAbsolute(t.map(function(t){return"string"==typeof t?t:"[*]"}).join("/"))?(s&&isAbsolute(s)||(s="/"+s),o=s):o=s;var a=this._makeAbs(o);childrenIgnored(this,o)||(c[0]===minimatch.GLOBSTAR?this._processGlobStar(s,o,a,c,r,i):this._processReaddir(s,o,a,c,r,i))},GlobSync.prototype._processReaddir=function(t,r,i,s,e,o){var c=this._readdir(i,o);if(c){for(var a=s[0],n=!!this.minimatch.negate,h=a._glob,l=this.dot||"."===h.charAt(0),f=[],m=0;m<c.length;m++){if("."!==(y=c[m]).charAt(0)||l)(n&&!t?!y.match(a):y.match(a))&&f.push(y)}var p=f.length;if(0!==p)if(1!==s.length||this.mark||this.stat){s.shift();for(m=0;m<p;m++){var u;y=f[m];u=t?[t,y]:[y],this._process(u.concat(s),e,o)}}else{this.matches[e]||(this.matches[e]=Object.create(null));for(var m=0;m<p;m++){var y=f[m];t&&(y="/"!==t.slice(-1)?t+"/"+y:t+y),"/"!==y.charAt(0)||this.nomount||(y=path.join(this.root,y)),this._emitMatch(e,y)}}}},GlobSync.prototype._emitMatch=function(t,r){if(!isIgnored(this,r)){var i=this._makeAbs(r);if(this.mark&&(r=this._mark(r)),this.absolute&&(r=i),!this.matches[t][r]){if(this.nodir){var s=this.cache[i];if("DIR"===s||Array.isArray(s))return}this.matches[t][r]=!0,this.stat&&this._stat(r)}}},GlobSync.prototype._readdirInGlobStar=function(t){if(this.follow)return this._readdir(t,!1);var r,i;try{i=this.fs.lstatSync(t)}catch(t){if("ENOENT"===t.code)return null}var s=i&&i.isSymbolicLink();return this.symlinks[t]=s,s||!i||i.isDirectory()?r=this._readdir(t,!1):this.cache[t]="FILE",r},GlobSync.prototype._readdir=function(t,r){if(r&&!ownProp(this.symlinks,t))return this._readdirInGlobStar(t);if(ownProp(this.cache,t)){var i=this.cache[t];if(!i||"FILE"===i)return null;if(Array.isArray(i))return i}try{return this._readdirEntries(t,this.fs.readdirSync(t))}catch(r){return this._readdirError(t,r),null}},GlobSync.prototype._readdirEntries=function(t,r){if(!this.mark&&!this.stat)for(var i=0;i<r.length;i++){var s=r[i];s="/"===t?t+s:t+"/"+s,this.cache[s]=!0}return this.cache[t]=r,r},GlobSync.prototype._readdirError=function(t,r){switch(r.code){case"ENOTSUP":case"ENOTDIR":var i=this._makeAbs(t);if(this.cache[i]="FILE",i===this.cwdAbs){var s=new Error(r.code+" invalid cwd "+this.cwd);throw s.path=this.cwd,s.code=r.code,s}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:if(this.cache[this._makeAbs(t)]=!1,this.strict)throw r;this.silent||console.error("glob error",r)}},GlobSync.prototype._processGlobStar=function(t,r,i,s,e,o){var c=this._readdir(i,o);if(c){var a=s.slice(1),n=t?[t]:[],h=n.concat(a);this._process(h,e,!1);var l=c.length;if(!this.symlinks[i]||!o)for(var f=0;f<l;f++){if("."!==c[f].charAt(0)||this.dot){var m=n.concat(c[f],a);this._process(m,e,!0);var p=n.concat(c[f],s);this._process(p,e,!0)}}}},GlobSync.prototype._processSimple=function(t,r){var i=this._stat(t);if(this.matches[r]||(this.matches[r]=Object.create(null)),i){if(t&&isAbsolute(t)&&!this.nomount){var s=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=path.join(this.root,t):(t=path.resolve(this.root,t),s&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(r,t)}},GlobSync.prototype._stat=function(t){var r=this._makeAbs(t),i="/"===t.slice(-1);if(t.length>this.maxLength)return!1;if(!this.stat&&ownProp(this.cache,r)){var s=this.cache[r];if(Array.isArray(s)&&(s="DIR"),!i||"DIR"===s)return s;if(i&&"FILE"===s)return!1}var e=this.statCache[r];if(!e){var o;try{o=this.fs.lstatSync(r)}catch(t){if(t&&("ENOENT"===t.code||"ENOTDIR"===t.code))return this.statCache[r]=!1,!1}if(o&&o.isSymbolicLink())try{e=this.fs.statSync(r)}catch(t){e=o}else e=o}this.statCache[r]=e;s=!0;return e&&(s=e.isDirectory()?"DIR":"FILE"),this.cache[r]=this.cache[r]||s,(!i||"FILE"!==s)&&s},GlobSync.prototype._mark=function(t){return common.mark(this,t)},GlobSync.prototype._makeAbs=function(t){return common.makeAbs(this,t)};