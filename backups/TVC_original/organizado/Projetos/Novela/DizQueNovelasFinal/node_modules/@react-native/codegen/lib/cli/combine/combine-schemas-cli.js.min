"use strict";const assert=require("assert"),fs=require("fs"),yargs=require("yargs"),argv=yargs.option("p",{alias:"platform",type:"string",demandOption:!0}).option("o",{alias:"output"}).option("s",{alias:"schema-query"}).parseSync(),platform=argv.platform.toLowerCase(),output=argv.output,schemaQuery=argv.s;if(!["ios","android"].includes(platform))throw new Error(`Invalid platform ${platform}`);if(!schemaQuery.startsWith("@"))throw new Error("The argument provided to --schema-query must be a filename that starts with '@'.");const schemaQueryOutputFile=schemaQuery.replace(/^@/,""),schemaQueryOutput=fs.readFileSync(schemaQueryOutputFile,"utf8"),schemaFiles=schemaQueryOutput.split(" "),modules={},specNameToFile={};for(const e of schemaFiles){const s=JSON.parse(fs.readFileSync(e,"utf8"));if(s.modules)for(const t in s.modules){var _module$excludedPlatf;const o=s.modules[t];modules[t]&&assert.deepEqual(o,modules[t],`App contained two specs with the same file name '${t}'. Schemas: ${specNameToFile[t]}, ${e}. Please rename one of the specs.`);const a=null===(_module$excludedPlatf=o.excludedPlatforms)||void 0===_module$excludedPlatf?void 0:_module$excludedPlatf.map(e=>e.toLowerCase());if(null!=a){if(!(a.includes("ios")&&a.includes("android"))&&a.includes(platform))continue}if("Component"===o.type){const e=o.components||{};if(Object.values(e).some(e=>{var s;return null===(s=e.excludedPlatforms)||void 0===s?void 0:s.map(e=>e.toLowerCase()).includes(platform)}))continue}"Component"===o.type&&"FBReactNativeSpec"===s.libraryName||(modules[t]=o,specNameToFile[t]=e)}}fs.writeFileSync(output,JSON.stringify({modules:modules}));