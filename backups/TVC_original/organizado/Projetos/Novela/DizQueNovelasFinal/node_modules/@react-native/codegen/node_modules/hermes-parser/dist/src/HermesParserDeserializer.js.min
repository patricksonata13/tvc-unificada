"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _HermesParserDecodeUTF8String=_interopRequireDefault(require("./HermesParserDecodeUTF8String")),_HermesParserNodeDeserializers=_interopRequireDefault(require("./HermesParserNodeDeserializers"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class HermesParserDeserializer{constructor(e,t,i,s,r){this.programBufferIdx=void 0,this.positionBufferIdx=void 0,this.positionBufferSize=void 0,this.locMap=void 0,this.HEAPU8=void 0,this.HEAPU32=void 0,this.HEAPF64=void 0,this.options=void 0,this.commentTypes=["CommentLine","CommentBlock","InterpreterDirective"],this.tokenTypes=["Boolean","Identifier","Keyword","Null","Numeric","BigInt","Punctuator","String","RegularExpression","Template","JSXText"],this.programBufferIdx=e/4,this.positionBufferIdx=t/4,this.positionBufferSize=i,this.locMap={},this.HEAPU8=s.HEAPU8,this.HEAPU32=s.HEAPU32,this.HEAPF64=s.HEAPF64,this.options=r}next(){return this.HEAPU32[this.programBufferIdx++]}deserialize(){const e={type:"Program",loc:this.addEmptyLoc(),body:this.deserializeNodeList(),comments:this.deserializeComments()};return!0===this.options.tokens&&(e.tokens=this.deserializeTokens()),this.fillLocs(),e}deserializeBoolean(){return Boolean(this.next())}deserializeNumber(){let e;return this.programBufferIdx%2==0?(e=this.programBufferIdx/2,this.programBufferIdx+=2):(e=(this.programBufferIdx+1)/2,this.programBufferIdx+=3),this.HEAPF64[e]}deserializeString(){const e=this.next();if(0===e)return null;const t=this.next();return(0,_HermesParserDecodeUTF8String.default)(e,t,this.HEAPU8)}deserializeNode(){const e=this.next();if(0===e)return null;return _HermesParserNodeDeserializers.default[e-1].bind(this)()}deserializeNodeList(){const e=this.next(),t=[];for(let i=0;i<e;i++)t.push(this.deserializeNode());return t}deserializeComments(){const e=this.next(),t=[];for(let i=0;i<e;i++){const e=this.commentTypes[this.next()],i=this.addEmptyLoc(),s=this.deserializeString();t.push({type:e,loc:i,value:s})}return t}deserializeTokens(){const e=this.next(),t=[];for(let i=0;i<e;i++){const e=this.tokenTypes[this.next()],i=this.addEmptyLoc(),s=this.deserializeString();t.push({type:e,loc:i,value:s})}return t}addEmptyLoc(){const e={};return this.locMap[this.next()]=e,e}fillLocs(){for(let e=0;e<this.positionBufferSize;e++){const e=this.HEAPU32[this.positionBufferIdx++],t=this.HEAPU32[this.positionBufferIdx++],i=this.HEAPU32[this.positionBufferIdx++],s=this.HEAPU32[this.positionBufferIdx++],r=this.HEAPU32[this.positionBufferIdx++],o=this.locMap[e];0===t?(o.start={line:i,column:s},o.rangeStart=r):(o.end={line:i,column:s},o.rangeEnd=r)}}}exports.default=HermesParserDeserializer;