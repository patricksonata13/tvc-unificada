"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deepCloneNode=deepCloneNode,exports.nodeWith=nodeWith,exports.removeNodeOnParent=removeNodeOnParent,exports.replaceNodeOnParent=replaceNodeOnParent,exports.setParentPointersInDirectChildren=setParentPointersInDirectChildren,exports.shallowCloneNode=shallowCloneNode,exports.updateAllParentPointers=updateAllParentPointers;var _astArrayMutationHelpers=require("./astArrayMutationHelpers"),_getVisitorKeys=require("../traverse/getVisitorKeys"),_SimpleTraverser=require("../traverse/SimpleTraverser");function getParentKey(e,r,t){if(null==r)throw new Error(`Expected parent node to be set on "${e.type}"`);for(const n of(0,_getVisitorKeys.getVisitorKeys)(r,t))if((0,_getVisitorKeys.isNode)(r[n])){if(r[n]===e)return{type:"single",node:r,key:n}}else if(Array.isArray(r[n]))for(let t=0;t<r[n].length;t+=1){if(r[n][t]===e)return{type:"array",node:r,key:n,targetIndex:t}}throw new Error(`Expected to find the ${e.type} as a direct child of the ${r.type}.`)}function replaceNodeOnParent(e,r,t,n){const o=getParentKey(e,r,n),s=o.node;"array"===o.type?s[o.key]=(0,_astArrayMutationHelpers.replaceInArray)(s[o.key],o.targetIndex,[t]):s[o.key]=t}function removeNodeOnParent(e,r,t){const n=getParentKey(e,r,t),o=n.node;"array"===n.type?o[n.key]=(0,_astArrayMutationHelpers.removeFromArray)(o[n.key],n.targetIndex):o[n.key]=null}function setParentPointersInDirectChildren(e,r){for(const t of(0,_getVisitorKeys.getVisitorKeys)(e,r))if((0,_getVisitorKeys.isNode)(e[t]))e[t].parent=e;else if(Array.isArray(e[t]))for(const r of e[t])r.parent=e}function updateAllParentPointers(e,r){_SimpleTraverser.SimpleTraverser.traverse(e,{enter(e,r){e.parent=r},leave(){},visitorKeys:r})}function nodeWith(e,r,t){if(Object.entries(r).every(([r,t])=>{const n=e;return Array.isArray(t)?!!Array.isArray(n[r])&&(0,_astArrayMutationHelpers.arrayIsEqual)(n[r],t):n[r]===t}))return e;const n={...e,...r};return setParentPointersInDirectChildren(n,t),n}function shallowCloneNode(e,r){const t={...e};return setParentPointersInDirectChildren(t,r),t}function deepCloneNode(e,r){const t=JSON.parse(JSON.stringify(e,(e,r)=>{if("parent"!==e)return r}));return updateAllParentPointers(t,r),t}