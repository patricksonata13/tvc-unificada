"use strict";const{FlowParser:FlowParser}=require("../../parsers/flow/parser"),{TypeScriptParser:TypeScriptParser}=require("../../parsers/typescript/parser"),{filterJSFile:filterJSFile}=require("./combine-utils"),fs=require("fs"),glob=require("glob"),path=require("path"),flowParser=new FlowParser,typescriptParser=new TypeScriptParser;function combineSchemas(e,s){return{libraryName:s||"",modules:e.reduce((e,s)=>{const r=fs.readFileSync(s,"utf8");if(r&&(/export\s+default\s+\(?codegenNativeComponent</.test(r)||/extends TurboModule/.test(r))){const r=(".ts"===path.extname(s)||".tsx"===path.extname(s)?typescriptParser:flowParser).parseFile(s);r&&r.modules&&(e.modules={...e.modules,...r.modules})}return e},{modules:{}}).modules}}function expandDirectoriesIntoFiles(e,s,r){return e.flatMap(e=>{if(!fs.lstatSync(e).isDirectory())return[e];const s="\\"===path.sep?e.replace(/\\/g,"/"):e;return glob.sync(`${s}/**/*{,.fb}.{js,ts,tsx}`,{nodir:!0})}).filter(e=>filterJSFile(e,s,r))}function combineSchemasInFileList(e,s,r,i){const t=combineSchemas(expandDirectoriesIntoFiles(e,s,r),i);return 0===Object.keys(t.modules).length&&console.error("No modules to process in combine-js-to-schema-cli. If this is unexpected, please check if you set up your NativeComponent correctly. See combine-js-to-schema.js for how codegen finds modules."),t}function combineSchemasInFileListAndWriteToFile(e,s,r,i,t){const o=combineSchemasInFileList(e,s,i,t),n=JSON.stringify(o);fs.writeFileSync(r,n)}module.exports={combineSchemas:combineSchemas,combineSchemasInFileList:combineSchemasInFileList,combineSchemasInFileListAndWriteToFile:combineSchemasInFileListAndWriteToFile};