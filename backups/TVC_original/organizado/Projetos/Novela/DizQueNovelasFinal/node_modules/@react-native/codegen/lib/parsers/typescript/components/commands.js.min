"use strict";const{parseTopLevelType:parseTopLevelType}=require("../parseTopLevelType"),{getPrimitiveTypeAnnotation:getPrimitiveTypeAnnotation}=require("./componentsUtils");function buildCommandSchemaInternal(e,t,n,o,a){var r,p;const y=n[0].typeAnnotation;if(null==y.typeAnnotation||"TSTypeReference"!==y.typeAnnotation.type||"React"!==(null===(r=y.typeAnnotation.typeName.left)||void 0===r?void 0:r.name)||"ElementRef"!==(null===(p=y.typeAnnotation.typeName.right)||void 0===p?void 0:p.name))throw new Error(`The first argument of method ${e} must be of type React.ElementRef<>`);const i=n.slice(1).map(t=>{const n=t.name,r=parseTopLevelType(t.typeAnnotation.typeAnnotation,a,o).type,p="TSTypeReference"===r.type?a.getTypeAnnotationName(r):r.type;let y;switch(p){case"RootTag":y={type:"ReservedTypeAnnotation",name:"RootTag"};break;case"TSBooleanKeyword":case"Int32":case"Double":case"Float":case"TSStringKeyword":y=getPrimitiveTypeAnnotation(p);break;case"Array":case"ReadOnlyArray":if("TSTypeReference"===!r.type)throw new Error("Array and ReadOnlyArray are TSTypeReference for array");y={type:"ArrayTypeAnnotation",elementType:getCommandArrayElementTypeType(r.typeParameters.params[0],a)};break;case"TSArrayType":y={type:"ArrayTypeAnnotation",elementType:getCommandArrayElementTypeType(r.elementType,a)};break;default:throw new Error(`Unsupported param type for method "${e}", param "${n}". Found ${p}`)}return{name:n,optional:!1,typeAnnotation:y}});return{name:e,optional:t,typeAnnotation:{type:"FunctionTypeAnnotation",params:i,returnTypeAnnotation:{type:"VoidTypeAnnotation"}}}}function getCommandArrayElementTypeType(e,t){if(null==e||"object"!=typeof e)throw new Error("Expected an object, received "+typeof e);const n=e.type;if("string"!=typeof n)throw new Error("Command array element type must be a string");if("TSTypeReference"===n){const n="object"==typeof e.typeName?t.getTypeAnnotationName(e):null;if("string"!=typeof n)throw new Error("Expected TSTypeReference AST name to be a string");try{return getPrimitiveTypeAnnotation(n)}catch(e){return{type:"MixedTypeAnnotation"}}}return getPrimitiveTypeAnnotation(n)}function buildCommandSchema(e,t,n){if("TSPropertySignature"===e.type){const o=parseTopLevelType(e.typeAnnotation.typeAnnotation,n,t);return buildCommandSchemaInternal(e.key.name,e.optional||o.optional,o.type.parameters||o.type.params,t,n)}return buildCommandSchemaInternal(e.key.name,e.optional||!1,e.parameters||e.params,t,n)}function getCommands(e,t,n){return e.filter(e=>"TSPropertySignature"===e.type||"TSMethodSignature"===e.type).map(e=>buildCommandSchema(e,t,n)).filter(Boolean)}module.exports={getCommands:getCommands};