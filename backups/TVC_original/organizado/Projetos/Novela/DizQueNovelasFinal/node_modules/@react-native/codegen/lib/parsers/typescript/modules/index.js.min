"use strict";const{UnsupportedEnumDeclarationParserError:UnsupportedEnumDeclarationParserError,UnsupportedGenericParserError:UnsupportedGenericParserError,UnsupportedObjectPropertyWithIndexerTypeAnnotationParserError:UnsupportedObjectPropertyWithIndexerTypeAnnotationParserError,UnsupportedTypeAnnotationParserError:UnsupportedTypeAnnotationParserError}=require("../../errors"),{parseObjectProperty:parseObjectProperty}=require("../../parsers-commons"),{emitArrayType:emitArrayType,emitCommonTypes:emitCommonTypes,emitDictionary:emitDictionary,emitFunction:emitFunction,emitNumberLiteral:emitNumberLiteral,emitPromise:emitPromise,emitRootTag:emitRootTag,emitStringLiteral:emitStringLiteral,emitUnion:emitUnion,translateArrayTypeAnnotation:translateArrayTypeAnnotation,typeAliasResolution:typeAliasResolution,typeEnumResolution:typeEnumResolution}=require("../../parsers-primitives"),{flattenProperties:flattenProperties}=require("../components/componentsUtils"),{flattenIntersectionType:flattenIntersectionType}=require("../parseTopLevelType");function translateObjectTypeAnnotation(e,t,r,n,o,a,i,p,s,y,l,u){const m=n.map(n=>y(()=>parseObjectProperty(t,n,e,i,p,s,y,l,r,translateTypeAnnotation,u))).filter(Boolean);let T;return T=0===a.length?{type:"ObjectTypeAnnotation",properties:m}:{type:"ObjectTypeAnnotation",properties:m,baseTypes:a},typeAliasResolution(o,T,p,r)}function translateTypeReferenceAnnotation(e,t,r,n,o,a,i,p,s,y){switch(e){case"RootTag":return emitRootTag(t);case"Promise":return emitPromise(n,r,y,t,o,a,i,p,s,translateTypeAnnotation);case"Array":case"ReadonlyArray":return emitArrayType(n,r,y,o,a,i,s,t,translateTypeAnnotation);default:{const e=emitCommonTypes(n,o,r,a,i,p,s,t,y);if(!e)throw new UnsupportedGenericParserError(n,r,y);return e}}}function translateTypeAnnotation(e,t,r,n,o,a,i,p){const{nullable:s,typeAnnotation:y,typeResolutionStatus:l}=p.getResolvedTypeAnnotation(t,r,p);switch(p.getResolveTypeAnnotationFN()(t,r,p),y.type){case"TSArrayType":return translateArrayTypeAnnotation(e,r,n,o,i,"Array",y.elementType,s,translateTypeAnnotation,p);case"TSTypeOperator":if("readonly"===y.operator&&"TSArrayType"===y.typeAnnotation.type)return translateArrayTypeAnnotation(e,r,n,o,i,"ReadonlyArray",y.typeAnnotation.elementType,s,translateTypeAnnotation,p);throw new UnsupportedGenericParserError(e,y,p);case"TSTypeReference":return translateTypeReferenceAnnotation(p.getTypeAnnotationName(y),s,y,e,r,n,o,a,i,p);case"TSInterfaceDeclaration":{var u;const m=(null!==(u=y.extends)&&void 0!==u?u:[]).map(e=>e.expression.name);for(const t of m)translateTypeAnnotation(e,{type:"TSTypeReference",typeName:{type:"Identifier",name:t}},r,n,o,a,i,p);return translateObjectTypeAnnotation(e,t,s,flattenProperties([y],r,p),l,m,r,n,o,a,i,p)}case"TSIntersectionType":return translateObjectTypeAnnotation(e,t,s,flattenProperties(flattenIntersectionType(y,p,r),r,p),l,[],r,n,o,a,i,p);case"TSTypeLiteral":if(y.members){const t=y.members.filter(e=>"TSIndexSignature"===e.type),l=y.members.filter(e=>"TSPropertySignature"===e.type);if(t.length>0&&l.length>0)throw new UnsupportedObjectPropertyWithIndexerTypeAnnotationParserError(e,y);if(t.length>0){const y=translateTypeAnnotation(e,t[0].typeAnnotation,r,n,o,a,i,p);return emitDictionary(s,y)}}return translateObjectTypeAnnotation(e,t,s,y.members,l,[],r,n,o,a,i,p);case"TSEnumDeclaration":if(y.members.some(e=>e.initializer&&"NumericLiteral"===e.initializer.type&&!Number.isInteger(e.initializer.value)))throw new UnsupportedEnumDeclarationParserError(e,y,p.language());return typeEnumResolution(y,l,s,e,o,p);case"TSFunctionType":return emitFunction(s,e,y,r,n,o,a,i,translateTypeAnnotation,p);case"TSUnionType":return emitUnion(s,e,y,p);case"TSLiteralType":{const t=y.literal;switch(t.type){case"StringLiteral":return emitStringLiteral(s,t.value);case"NumericLiteral":return emitNumberLiteral(s,t.value);default:throw new UnsupportedTypeAnnotationParserError(e,y,p.language())}}default:{const t=emitCommonTypes(e,r,y,n,o,a,i,s,p);if(!t)throw new UnsupportedTypeAnnotationParserError(e,y,p.language());return t}}}module.exports={typeScriptTranslateTypeAnnotation:translateTypeAnnotation};