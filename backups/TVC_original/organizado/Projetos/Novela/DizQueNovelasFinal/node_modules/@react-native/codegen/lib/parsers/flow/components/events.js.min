"use strict";const{throwIfArgumentPropsAreNull:throwIfArgumentPropsAreNull,throwIfBubblingTypeIsNull:throwIfBubblingTypeIsNull,throwIfEventHasNoName:throwIfEventHasNoName}=require("../../error-utils"),{buildPropertiesForEvent:buildPropertiesForEvent,emitBuildEventSchema:emitBuildEventSchema,getEventArgument:getEventArgument,handleEventHandler:handleEventHandler}=require("../../parsers-commons"),{emitBoolProp:emitBoolProp,emitDoubleProp:emitDoubleProp,emitFloatProp:emitFloatProp,emitInt32Prop:emitInt32Prop,emitMixedProp:emitMixedProp,emitObjectProp:emitObjectProp,emitStringProp:emitStringProp,emitUnionProp:emitUnionProp}=require("../../parsers-primitives");function getPropertyType(e,t,n,r){const o=extractTypeFromTypeAnnotation(n,r);switch(o){case"BooleanTypeAnnotation":return emitBoolProp(e,t);case"StringTypeAnnotation":return emitStringProp(e,t);case"Int32":return emitInt32Prop(e,t);case"Double":return emitDoubleProp(e,t);case"Float":return emitFloatProp(e,t);case"$ReadOnly":return getPropertyType(e,t,n.typeParameters.params[0],r);case"ObjectTypeAnnotation":return emitObjectProp(e,t,r,n,extractArrayElementType);case"UnionTypeAnnotation":return emitUnionProp(e,t,r,n);case"UnsafeMixed":return emitMixedProp(e,t);case"ArrayTypeAnnotation":case"$ReadOnlyArray":return{name:e,optional:t,typeAnnotation:extractArrayElementType(n,e,r)};default:throw new Error(`Unable to determine event type for "${e}": ${o}`)}}function extractArrayElementType(e,t,n){const r=extractTypeFromTypeAnnotation(e,n);switch(r){case"BooleanTypeAnnotation":return{type:"BooleanTypeAnnotation"};case"StringTypeAnnotation":return{type:"StringTypeAnnotation"};case"Int32":return{type:"Int32TypeAnnotation"};case"Float":return{type:"FloatTypeAnnotation"};case"NumberTypeAnnotation":case"Double":return{type:"DoubleTypeAnnotation"};case"UnionTypeAnnotation":return{type:"StringLiteralUnionTypeAnnotation",types:e.types.map(e=>({type:"StringLiteralTypeAnnotation",value:n.getLiteralValue(e)}))};case"UnsafeMixed":return{type:"MixedTypeAnnotation"};case"ObjectTypeAnnotation":return{type:"ObjectTypeAnnotation",properties:n.getObjectProperties(e).map(e=>buildPropertiesForEvent(e,n,getPropertyType))};case"ArrayTypeAnnotation":return{type:"ArrayTypeAnnotation",elementType:extractArrayElementType(e.elementType,t,n)};case"$ReadOnlyArray":const o=e.typeParameters.params;if(1!==o.length)throw new Error(`Events only supports arrays with 1 Generic type. Found ${o.length} types:\n${prettify(o)}`);return{type:"ArrayTypeAnnotation",elementType:extractArrayElementType(o[0],t,n)};default:throw new Error(`Unrecognized ${r} for Array ${t} in events.\n${prettify(e)}`)}}function prettify(e){return JSON.stringify(e,null,2)}function extractTypeFromTypeAnnotation(e,t){return"GenericTypeAnnotation"===e.type?t.getTypeAnnotationName(e):e.type}function findEventArgumentsAndType(e,t,n,r,o){throwIfEventHasNoName(t,e);const a=e.getTypeAnnotationName(t);return"$ReadOnly"===a?{argumentProps:t.typeParameters.params[0].properties,paperTopLevelNameDeprecated:o,bubblingType:r}:"BubblingEventHandler"===a||"DirectEventHandler"===a?handleEventHandler(a,t,e,n,findEventArgumentsAndType):n[a]?findEventArgumentsAndType(e,n[a].right,n,r,o):{argumentProps:null,bubblingType:null,paperTopLevelNameDeprecated:null}}function buildEventSchema(e,t,n){const r=t.key.name,o=t.optional||"NullableTypeAnnotation"===t.value.type;let a="NullableTypeAnnotation"===t.value.type?t.value.typeAnnotation:t.value;if("GenericTypeAnnotation"!==a.type||"BubblingEventHandler"!==n.getTypeAnnotationName(a)&&"DirectEventHandler"!==n.getTypeAnnotationName(a))return null;const{argumentProps:p,bubblingType:i,paperTopLevelNameDeprecated:y}=findEventArgumentsAndType(n,a,e),l=throwIfArgumentPropsAreNull(p,r),u=throwIfBubblingTypeIsNull(i,r),m=getEventArgument(l,n,getPropertyType);return emitBuildEventSchema(y,r,o,u,m)}function getEvents(e,t,n){return e.filter(e=>"ObjectTypeProperty"===e.type).map(e=>buildEventSchema(t,e,n)).filter(Boolean)}module.exports={getEvents:getEvents,extractArrayElementType:extractArrayElementType};