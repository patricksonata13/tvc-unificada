import*as t from"../helpers/helpers.js";import*as e from"../../lit/lit.js";import{render as o,html as i,nothing as s}from"../../lit/lit.js";import*as n from"../../../core/i18n/i18n.js";import*as a from"../../../core/platform/platform.js";import*as r from"../../../services/window_bounds/window_bounds.js";import*as l from"../render_coordinator/render_coordinator.js";import*as d from"../../visual_logging/visual_logging.js";import"../buttons/buttons.js";var h={cssText:`:host{white-space:normal}\n/*# sourceURL=${import.meta.resolve("./buttonDialog.css")} */\n`};const g=new CSSStyleSheet;g.replaceSync(h.cssText);class c extends HTMLElement{#t=this.attachShadow({mode:"open"});#e=this.#i.bind(this);#s=null;#o=null;#n=null;connectedCallback(){this.#t.adoptedStyleSheets=[g]}set data(e){this.#n=e,t.ScheduledRender.scheduleRender(this,this.#e)}#r(){if(!this.#s)throw new Error("Dialog not found");this.#s.setDialogVisible(!0),t.ScheduledRender.scheduleRender(this,this.#e)}#l(e){if(!this.#s)throw new Error("Dialog not found");this.#s.setDialogVisible(!1),e&&e.stopImmediatePropagation(),t.ScheduledRender.scheduleRender(this,this.#e)}#i(){if(!this.#n)throw new Error("ButtonDialog.data is not set");if(!t.ScheduledRender.isScheduledRender(this))throw new Error("Button dialog render was not scheduled");o(i`
      <devtools-button
        @click=${this.#r}
        on-render=${t.Directives.nodeRenderedCallback(t=>{this.#o=t})}
        .data=${{variant:this.#n.variant,iconName:this.#n.iconName,disabled:this.#n.disabled,title:this.#n.iconTitle,jslogContext:this.#n.jslogContext}}
      ></devtools-button>
      <devtools-dialog
        @clickoutsidedialog=${this.#l}
        .origin=${()=>{if(!this.#o)throw new Error("Button not found");return this.#o}}
        .position=${this.#n.position??"bottom"}
        .horizontalAlignment=${this.#n.horizontalAlignment??"right"}
        .closeOnESC=${this.#n.closeOnESC??!1}
        .closeOnScroll=${this.#n.closeOnScroll??!1}
        .closeButton=${this.#n.closeButton??!1}
        .dialogTitle=${this.#n.dialogTitle}
        .jslogContext=${this.#n.jslogContext??""}
        on-render=${t.Directives.nodeRenderedCallback(t=>{this.#s=t})}
      >
        <slot></slot>
      </devtools-dialog>
      `,this.#t,{host:this}),this.#n.openOnRender&&(this.#r(),this.#n.openOnRender=!1)}}customElements.define("devtools-button-dialog",c);var p=Object.freeze({__proto__:null,ButtonDialog:c}),u={cssText:`:host{--override-transparent:rgb(0 0 0/0%);display:var(--dialog-display)}dialog::backdrop{background:var(--override-transparent)}dialog{background:transparent;border:none;top:var(--dialog-top);padding:var(--dialog-padding);left:var(--dialog-left);right:var(--dialog-right);margin:var(--dialog-margin);margin-left:var(--dialog-margin-left,0);margin-bottom:var(--dialog-margin-bottom);animation-name:slideIn;animation-duration:100ms;animation-timing-function:cubic-bezier(0,0,0.3,1);overflow:hidden;filter:drop-shadow(0 4px 8px rgb(0 0 0/15%)) drop-shadow(0 1px 3px rgb(0 0 0/30%))}dialog:focus,\ndialog:focus-visible{outline:none}#content{min-width:var(--content-min-width);background:var(--color-background-elevation-dark-only);border-radius:var(--sys-size-5);max-height:var(--dialog-max-height);max-width:var(--dialog-max-width);overflow:auto;outline:none}.dialog-header{display:flex;justify-content:space-between;align-items:center;padding:var(--sys-size-5) var(--sys-size-5) var(--sys-size-5) var(--sys-size-8);&:empty{padding:0;height:var(--sys-size-7)}.dialog-header-text{font:var(--sys-typescale-body2-medium);padding-top:var(--sys-size-3)}devtools-button{margin:3px}}.dialog-content{padding:0 var(--sys-size-8) var(--sys-size-7) var(--sys-size-8);overflow:hidden}@keyframes slideIn{from{transform:translateY(var(--dialog-offset-y));opacity:0%}to{opacity:100%}}\n/*# sourceURL=${import.meta.resolve("./dialog.css")} */\n`};const m=new CSSStyleSheet;m.replaceSync(u.cssText);const{html:v}=e,y={close:"Close"},b=n.i18n.registerUIStrings("ui/components/dialogs/Dialog.ts",y),w=n.i18n.getLocalizedString.bind(void 0,b),f="HTMLDialogElement"in globalThis,D=10,S=30,C="MODAL";class x extends HTMLElement{#t=this.attachShadow({mode:"open"});#e=this.#i.bind(this);#a=this.#d.bind(this);#h=this.#c.bind(this);#g={origin:C,position:"bottom",horizontalAlignment:"center",getConnectorCustomXPosition:null,dialogShownCallback:null,windowBoundsService:r.WindowBoundsService.WindowBoundsServiceImpl.instance(),closeOnESC:!0,closeOnScroll:!0,closeButton:!1,dialogTitle:"",jslogContext:""};#s=null;#p=!1;#u=!1;#m=new DOMRect(0,0,0,0);#y=new DOMRect(0,0,0,0);#v=null;#b=null;#w=new MutationObserver(this.#a);#f=new ResizeObserver(this.#S.bind(this));#x=this.windowBoundsService.getDevToolsBoundingElement();#E=this.#P.bind(this);get origin(){return this.#g.origin}set origin(t){this.#g.origin=t,this.#C()}get position(){return this.#g.position}set position(t){this.#g.position=t,this.#C()}get horizontalAlignment(){return this.#g.horizontalAlignment}set horizontalAlignment(t){this.#g.horizontalAlignment=t,this.#C()}get windowBoundsService(){return this.#g.windowBoundsService}set windowBoundsService(t){this.#g.windowBoundsService=t,this.#x=this.windowBoundsService.getDevToolsBoundingElement(),this.#C()}get bestVerticalPosition(){return this.#v}get bestHorizontalAlignment(){return this.#b}get getConnectorCustomXPosition(){return this.#g.getConnectorCustomXPosition}set getConnectorCustomXPosition(t){this.#g.getConnectorCustomXPosition=t,this.#C()}get dialogShownCallback(){return this.#g.dialogShownCallback}get jslogContext(){return this.#g.jslogContext}set dialogShownCallback(t){this.#g.dialogShownCallback=t,this.#C()}set closeOnESC(t){this.#g.closeOnESC=t,this.#C()}set closeOnScroll(t){this.#g.closeOnScroll=t,this.#C()}set closeButton(t){this.#g.closeButton=t,this.#C()}set dialogTitle(t){this.#g.dialogTitle=t,this.#C()}set jslogContext(t){this.#g.jslogContext=t,this.#C()}#S(){this.#y=this.#k().getBoundingClientRect()}#C(){t.ScheduledRender.scheduleRender(this,this.#e)}connectedCallback(){this.#t.adoptedStyleSheets=[m],window.addEventListener("resize",this.#a),this.#w.observe(this.#x,{childList:!0,subtree:!0}),this.#x.addEventListener("wheel",this.#h),this.style.setProperty("--dialog-padding","0"),this.style.setProperty("--dialog-display",f?"block":"none"),this.style.setProperty("--override-dialog-content-border","10px solid transparent"),this.style.setProperty("--dialog-padding","3px 5px")}disconnectedCallback(){window.removeEventListener("resize",this.#a),this.#x.removeEventListener("wheel",this.#h),this.#w.disconnect(),this.#f.disconnect()}#k(){if(!this.#s){if(this.#s=this.#t.querySelector("dialog"),!this.#s)throw new Error("Dialog not found");this.#f.observe(this.#s)}return this.#s}getHitArea(){return this.#m}async setDialogVisible(t){t?await this.#r():this.#l()}async#D(t){if(t.stopPropagation(),t instanceof PointerEvent&&""===t.pointerType)return;const e=this.#$(t),i=this.#z(t);if(!e)if("pointermove"!==t.type)this.dispatchEvent(new E);else{if(i)return;this.dispatchEvent(new P)}}#$(t){const e=this.#y;let i="bottom"===this.bestVerticalPosition?20:-20;this.#g.origin===C&&(i=0);const s=t.pageX>=e.left&&t.pageX<=e.left+e.width,o=t.pageY>=e.top+i&&t.pageY<=e.top+e.height+i;return s&&o}#z(t){const e=this.#m,i=t.pageX>=e.left&&t.pageX<=e.left+e.width,s=t.pageY>=e.top&&t.pageY<=e.top+e.height;return i&&s}#O(t){if(!t||t===C)throw new Error("Dialog origin is null");const e=t instanceof Function?t():t;return e instanceof DOMPoint?{top:e.y,bottom:e.y,left:e.x,right:e.x}:e instanceof HTMLElement?e.getBoundingClientRect():e}#B(t,e){return e.right-t.left>t.right-e.left?"left":"right"}#R(t,e,i){return t.bottom+e>i.height&&t.top-e>i.top?"top":"bottom"}#A(){this.#g.origin&&(this.#p=!0,l.read(()=>{const t=this.#x.getBoundingClientRect(),e=t.width,i=t.height,s=t.left,o=t.top,n=t.right;if(this.#g.origin===C)return void l.write(()=>{this.style.setProperty("--dialog-top",`${o}px`),this.style.setProperty("--dialog-left",`${s}px`),this.style.setProperty("--dialog-margin","auto"),this.style.setProperty("--dialog-margin-left","auto"),this.style.setProperty("--dialog-margin-bottom","auto"),this.style.setProperty("--dialog-max-height",i-S+"px"),this.style.setProperty("--dialog-max-width",e-S+"px"),this.style.setProperty("--dialog-right",document.body.clientWidth-n+"px")});const r=this.#g.origin,d=this.#O(r),{top:h,right:c,bottom:g,left:p}=d,u=(p+c)/2,m=c-p+D,y=document.body.clientWidth,v=this.#g.getConnectorCustomXPosition?this.#g.getConnectorCustomXPosition():u;l.write(()=>{this.style.setProperty("--dialog-top","0");const r=this.#k();r.style.visibility="hidden",this.#p&&!r.hasAttribute("open")&&(r.showModal(),this.setAttribute("open",""),this.#p=!1);const{width:l,height:b}=r.getBoundingClientRect();if(this.#b="auto"===this.#g.horizontalAlignment?this.#B(d,t):this.#g.horizontalAlignment,this.#v="auto"===this.#g.position?this.#R(d,b,t):this.#g.position,"auto"!==this.#b&&"auto"!==this.#v){switch(this.#m.height=g-h+D,this.#m.width=m,this.style.setProperty("--content-min-width",v-p+20+10+"px"),this.style.setProperty("--dialog-left","auto"),this.style.setProperty("--dialog-right","auto"),this.style.setProperty("--dialog-margin","0"),this.#b){case"left":{const t=Math.max(p,s),e=n-t-S;this.style.setProperty("--dialog-left",`${t}px`),this.#m.x=p,this.style.setProperty("--dialog-max-width",`${e}px`);break}case"right":{const t=y-c,e=y-n,i=Math.max(t,e),o=y-i-s-S;this.#m.x=y-i-m,this.style.setProperty("--dialog-right",`${i}px`),this.style.setProperty("--dialog-max-width",`${o}px`);break}case"center":{const t=Math.min(e-S,l);let i=Math.max(u-.5*t,s);i=Math.min(i,n-t),this.style.setProperty("--dialog-left",`${i}px`),this.#m.x=u-.5*m,this.style.setProperty("--dialog-max-width",e-S+"px");break}default:a.assertNever(this.#b,`Unknown alignment type: ${this.#b}`)}switch(this.#v){case"top":this.style.setProperty("--dialog-top","0"),this.style.setProperty("--dialog-margin","auto"),this.style.setProperty("--dialog-margin-bottom",innerHeight-h+"px"),this.#m.y=h-D,this.style.setProperty("--dialog-offset-y","20px"),this.style.setProperty("--dialog-max-height",i-(innerHeight-h)-S+"px");break;case"bottom":this.style.setProperty("--dialog-top",`${g}px`),this.#m.y=h,this.style.setProperty("--dialog-offset-y","-20px"),this.style.setProperty("--dialog-max-height",i-(g-o)-S+"px");break;default:a.assertNever(this.#v,`Unknown position type: ${this.#v}`)}r.close(),r.style.visibility=""}})}))}async#r(){if(!f)return;if(this.#p||this.hasAttribute("open"))return;this.#p=!0,this.#A(),await l.done(),this.#p=!1;const t=this.#k();t.hasAttribute("open")||t.showModal(),this.#g.dialogShownCallback&&await this.#g.dialogShownCallback(),this.#S(),document.body.addEventListener("keydown",this.#E)}#c(t){!this.#$(t)&&this.#g.closeOnScroll&&this.#k().hasAttribute("open")&&(this.#l(),this.dispatchEvent(new B))}#P(t){this.#k().hasAttribute("open")&&this.#g.closeOnESC&&t.key===a.KeyboardUtilities.ESCAPE_KEY&&(t.stopPropagation(),t.preventDefault(),this.#l(),this.dispatchEvent(new B))}#T(t){t.stopPropagation(),t.preventDefault(),this.#k().hasAttribute("open")&&this.#g.closeOnESC&&this.dispatchEvent(new B)}#d(){this.#s?.hasAttribute("open")&&this.#x!==document.body&&(this.#l(),this.dispatchEvent(new B))}#l(){!this.#u&&this.#k().hasAttribute("open")&&(this.#u=!0,l.write(()=>{this.#m.width=0,this.removeAttribute("open"),this.#k().close(),this.#u=!1,document.body.removeEventListener("keydown",this.#E)}))}getDialogBounds(){return this.#y}#j(){return this.#g.dialogTitle||this.#g.closeButton?v`
        <span class="dialog-header-text">${this.#g.dialogTitle}</span>
        ${this.#g.closeButton?v`
          <devtools-button
            @click=${this.#l}
            .data=${{variant:"toolbar",iconName:"cross",title:w(y.close),size:"SMALL"}}
            jslog=${d.close().track({click:!0})}
          ></devtools-button>
        `:e.nothing}
    `:null}#i(){if(!t.ScheduledRender.isScheduledRender(this))throw new Error("Dialog render was not scheduled");f?(e.render(v`
      <dialog @click=${this.#D} @pointermove=${this.#D} @cancel=${this.#T}
              jslog=${d.dialog(this.#g.jslogContext).track({resize:!0,keydown:"Escape"}).parent("mapped")}>
        <div id="content">
          <div class="dialog-header">${this.#j()}</div>
          <div class='dialog-content'>
            <slot></slot>
          </div>
        </div>
      </dialog>
    `,this.#t,{host:this}),d.setMappedParent(this.#k(),this.parentElementOrShadowHost())):e.render(v`
        <slot></slot>
      `,this.#t,{host:this})}}customElements.define("devtools-dialog",x);class P extends Event{static eventName="pointerleftdialog";constructor(){super(P.eventName,{bubbles:!0,composed:!0})}}class E extends Event{static eventName="clickoutsidedialog";constructor(){super(E.eventName,{bubbles:!0,composed:!0})}}class B extends Event{static eventName="forceddialogclose";constructor(){super(B.eventName,{bubbles:!0,composed:!0})}}var A=Object.freeze({__proto__:null,CONNECTOR_HEIGHT:D,ClickOutsideDialogEvent:E,DIALOG_PADDING_FROM_WINDOW:S,DIALOG_SIDE_PADDING:5,DIALOG_VERTICAL_PADDING:3,Dialog:x,ForcedDialogClose:B,MODAL:C,PointerLeftDialogEvent:P}),z={cssText:`.keybinds-list{display:flex;flex-direction:column;margin:0;padding:0}.keybinds-list-item{display:grid;align-items:baseline;justify-content:space-between;grid-template-rows:1fr;grid-template-columns:1fr var(--sys-size-11) 1fr;border-bottom:var(--sys-size-1) solid var(--sys-color-divider);padding:var(--sys-size-4) 0;&:last-of-type{border-bottom:unset}.keybinds-list-title{grid-row:1/1}.shortcuts-for-actions{grid-area:auto/3/auto/span 1}}.keys-container{display:flex;gap:var(--sys-size-3)}.shortcuts-for-actions{display:flex;flex-direction:column;align-items:flex-end;gap:var(--sys-size-3)}.nav-radio-buttons{display:flex;flex-direction:column;border-bottom:var(--sys-size-1) solid var(--sys-color-divider);padding-bottom:var(--sys-size-5);& label{display:flex;font:var(--sys-typescale-body3-regular);gap:var(--sys-size-2)}}.keybinds-key{display:flex;align-items:center;justify-content:center;box-sizing:border-box;padding:var(--sys-size-4);min-width:var(--sys-size-11);height:var(--sys-size-11);font:var(--sys-typescale-body5-medium);white-space:nowrap;border-radius:var(--sys-shape-corner-small);background:var(--sys-color-tonal-container)}\n/*# sourceURL=${import.meta.resolve("./shortcutDialog.css")} */\n`};const k=new CSSStyleSheet;k.replaceSync(z.cssText);const O={showShortcutTitle:"Show shortcuts",dialogTitle:"Keyboard shortcuts"},R=n.i18n.registerUIStrings("ui/components/dialogs/ShortcutDialog.ts",O),T=n.i18n.getLocalizedString.bind(void 0,R);class $ extends HTMLElement{#t=this.attachShadow({mode:"open"});#e=this.#i.bind(this);#L=[];#_=!1;#M=null;connectedCallback(){this.#t.adoptedStyleSheets=[k]}set data(e){this.#L=e.shortcuts,e.open&&(this.#_=e.open),t.ScheduledRender.scheduleRender(this,this.#e)}prependElement(t){this.#M=t}#i(){if(!t.ScheduledRender.isScheduledRender(this))throw new Error("Shortcut dialog render was not scheduled");o(i`
      <devtools-button-dialog .data=${{openOnRender:this.#_,closeButton:!0,dialogTitle:T(O.dialogTitle),variant:"toolbar",iconName:"help",iconTitle:T(O.showShortcutTitle)}}>
        <ul class="keybinds-list">
          ${this.#M?i`${this.#M}`:s}
          ${this.#L.map(t=>i`
              <li class="keybinds-list-item">
                <div class="keybinds-list-title">${t.title}</div>
                <div class="shortcuts-for-actions">
                  ${t.bindings.map(t=>i`
                    <div class="keys-container">
                      ${t.map(t=>i`
                          <span class="keybinds-key">${t}</span>
                      `)}
                    </div>
                  `)}
                  </div>
              </li>`)}
        </ul>
      </devtools-button-dialog>
      `,this.#t,{host:this})}}customElements.define("devtools-shortcut-dialog",$);var I=Object.freeze({__proto__:null,ShortcutDialog:$});export{p as ButtonDialog,A as Dialog,I as ShortcutDialog};