"use strict";function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:t+""}function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}import invariant from"invariant";const{UnsupportedObjectPropertyTypeAnnotationParserError:UnsupportedObjectPropertyTypeAnnotationParserError}=require("./errors"),{parseFlowAndThrowErrors:parseFlowAndThrowErrors}=require("./flow/parseFlowAndThrowErrors"),{buildPropSchema:buildPropSchema}=require("./parsers-commons"),{flattenProperties:flattenProperties}=require("./typescript/components/componentsUtils"),schemaMock={modules:{StringPropNativeComponentView:{type:"Component",components:{StringPropNativeComponentView:{extendsProps:[],events:[],props:[],commands:[]}}}}};export class MockedParser{constructor(){_defineProperty(this,"typeParameterInstantiation","TypeParameterInstantiation"),_defineProperty(this,"typeAlias","TypeAlias"),_defineProperty(this,"enumDeclaration","EnumDeclaration"),_defineProperty(this,"interfaceDeclaration","InterfaceDeclaration"),_defineProperty(this,"nullLiteralTypeAnnotation","NullLiteralTypeAnnotation"),_defineProperty(this,"undefinedLiteralTypeAnnotation","VoidLiteralTypeAnnotation")}isProperty(e){return"ObjectTypeProperty"===e.type}getKeyName(e,t){if(!this.isProperty(e))throw new UnsupportedObjectPropertyTypeAnnotationParserError(t,e,e.type,this.language());return e.key.name}language(){return"Flow"}getTypeAnnotationName(e){var t;return null==e||null===(t=e.id)||void 0===t?void 0:t.name}checkIfInvalidModule(e){return!1}remapUnionTypeAnnotationMemberNames(e){return[]}getStringLiteralUnionTypeAnnotationStringLiterals(e){return[]}parseFile(e){return schemaMock}parseString(e,t){return schemaMock}parseModuleFixture(e){return schemaMock}getAst(e,t){return parseFlowAndThrowErrors(e,{filename:t})}getFunctionTypeAnnotationParameters(e){return e.params}getFunctionNameFromParameter(e){return e.name}getParameterName(e){return e.name.name}getParameterTypeAnnotation(e){return e.typeAnnotation}getFunctionTypeAnnotationReturnType(e){return e.returnType}parseEnumMembersType(e){return e.type}validateEnumMembersSupported(e,t){}parseEnumMembers(e){return"StringTypeAnnotation"===e.type?[{name:"Hello",value:{type:"StringLiteralTypeAnnotation",value:"hello"}},{name:"Goodbye",value:{type:"StringLiteralTypeAnnotation",value:"goodbye"}}]:[{name:"On",value:{type:"NumberLiteralTypeAnnotation",value:1}},{name:"Off",value:{type:"NumberLiteralTypeAnnotation",value:0}}]}isModuleInterface(e){return"InterfaceDeclaration"===e.type&&1===e.extends.length&&"InterfaceExtends"===e.extends[0].type&&"TurboModule"===e.extends[0].id.name}isGenericTypeAnnotation(e){return!0}extractAnnotatedElement(e,t){return t[e.typeParameters.params[0].id.name]}getTypes(e){return{}}callExpressionTypeParameters(e){return e.typeArguments||null}computePartialProperties(e,t,n,r,o,a,i){return[{name:"a",optional:!0,typeAnnotation:{type:"StringTypeAnnotation"}},{name:"b",optional:!0,typeAnnotation:{type:"BooleanTypeAnnotation"}}]}functionTypeAnnotation(e){return"FunctionTypeAnnotation"===e}getTypeArgumentParamsFromDeclaration(e){return e.typeArguments.params}getNativeComponentType(e,t){return{propsTypeName:e[0].id.name,componentName:t[0].value}}getAnnotatedElementProperties(e){return e.right.properties}bodyProperties(e){return e.body.properties}convertKeywordToTypeAnnotation(e){return e}argumentForProp(e){return e.expression}nameForArgument(e){return e.expression.name}isOptionalProperty(e){return e.optional||!1}getTypeAnnotationFromProperty(e){return e.typeAnnotation.typeAnnotation}getGetTypeAnnotationFN(){return()=>({})}getGetSchemaInfoFN(){return()=>({name:"MockedSchema",optional:!1,typeAnnotation:"BooleanTypeAnnotation",defaultValue:!1,withNullDefault:!1})}getResolveTypeAnnotationFN(){return()=>({nullable:!1,typeAnnotation:null,typeResolutionStatus:{successful:!1}})}getResolvedTypeAnnotation(e,t){invariant(null!=e,"resolveTypeAnnotation(): typeAnnotation cannot be null");let n=e,r=!1,o={successful:!1};for(;;){if("NullableTypeAnnotation"===n.type){r=!0,n=n.typeAnnotation;continue}if("GenericTypeAnnotation"!==n.type)break;const e=t[n.id.name];if(null==e)break;switch(e.type){case"TypeAlias":o={successful:!0,type:"alias",name:n.id.name},n=e.right;break;case"EnumDeclaration":o={successful:!0,type:"enum",name:n.id.name},n=e.body;break;default:throw new TypeError(`A non GenericTypeAnnotation must be a type declaration ('TypeAlias') or enum ('EnumDeclaration'). Instead, got the unsupported ${e.type}.`)}}return{nullable:r,typeAnnotation:n,typeResolutionStatus:o}}getExtendsProps(e,t){return e.filter(e=>"ObjectTypeSpreadProperty"===e.type).map(e=>this.extendsForProp(e,t,this)).filter(Boolean)}extendsForProp(e,t,n){this.argumentForProp(e)||console.log("null",e);const r=n.nameForArgument(e);if(null!=t[r])return null;if("ViewProps"===r)return{type:"ReactNativeBuiltInType",knownTypeName:"ReactNativeCoreViewProps"};throw new Error(`Unable to handle prop spread: ${r}`)}removeKnownExtends(e,t){return e.filter(e=>"ObjectTypeSpreadProperty"!==e.type||null===this.extendsForProp(e,t,this))}getProps(e,t){const n=this.removeKnownExtends(e,t);return{props:flattenProperties(n,t,this).map(e=>buildPropSchema(e,t,this)).filter(Boolean),extendsProps:this.getExtendsProps(e,t)}}getProperties(e,t){const n=t[e];try{return n.right.typeParameters.params[0].properties}catch(t){throw new Error(`Failed to find type definition for "${e}", please check that you have a valid codegen flow file`)}}nextNodeForTypeAlias(e){return e.right}nextNodeForEnum(e){return e.body}genericTypeAnnotationErrorMessage(e){return`A non GenericTypeAnnotation must be a type declaration ('${this.typeAlias}') or enum ('${this.enumDeclaration}'). Instead, got the unsupported ${e.type}.`}extractTypeFromTypeAnnotation(e){return"GenericTypeAnnotation"===e.type?e.id.name:e.type}getObjectProperties(e){return e.properties}getLiteralValue(e){return e.value}getPaperTopLevelNameDeprecated(e){return e.typeParameters.params.length>1?e.typeParameters.params[1].value:null}}