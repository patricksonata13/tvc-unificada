"use strict";let FlowParser,TypeScriptParser,RNCodegen;const{cheap:traverseCheap}=require("@babel/traverse").default,{basename:basename}=require("path");try{FlowParser=require("@react-native/codegen/src/parsers/flow/parser").FlowParser,TypeScriptParser=require("@react-native/codegen/src/parsers/typescript/parser").TypeScriptParser,RNCodegen=require("@react-native/codegen/src/generators/RNCodegen")}catch(e){FlowParser=require("@react-native/codegen/lib/parsers/flow/parser").FlowParser,TypeScriptParser=require("@react-native/codegen/lib/parsers/typescript/parser").TypeScriptParser,RNCodegen=require("@react-native/codegen/lib/generators/RNCodegen")}const flowParser=new FlowParser,typeScriptParser=new TypeScriptParser;function parseFile(e,r){if(e.endsWith("js"))return flowParser.parseString(r);if(e.endsWith("ts"))return typeScriptParser.parseString(r);throw new Error(`Unable to parse file '${e}'. Unsupported filename extension.`)}function generateViewConfig(e,r){const t=parseFile(e,r),a=basename(e).replace(/NativeComponent\.(js|ts)$/,"");return RNCodegen.generateViewConfig({libraryName:a,schema:t})}function isCodegenDeclaration(e){return!!e&&(!(!e.left||!e.left.left||"codegenNativeComponent"!==e.left.left.name)||(!(!e.callee||!e.callee.name||"codegenNativeComponent"!==e.callee.name)||(!("TypeCastExpression"!==e.type&&"AsExpression"!==e.type||!e.expression||!e.expression.callee||!e.expression.callee.name||"codegenNativeComponent"!==e.expression.callee.name)||!!("TSAsExpression"===e.type&&e.expression&&e.expression.callee&&e.expression.callee.name&&"codegenNativeComponent"===e.expression.callee.name))))}module.exports=function({parse:e,types:r}){return{pre(e){this.code=e.code,this.filename=e.opts.filename,this.defaultExport=null,this.commandsExport=null,this.codeInserted=!1},visitor:{ExportNamedDeclaration(e){if(!this.codeInserted)if(e.node.declaration&&e.node.declaration.declarations&&e.node.declaration.declarations[0]){const r=e.node.declaration.declarations[0];if("VariableDeclarator"===r.type){if(r.init&&"CallExpression"===r.init.type&&"Identifier"===r.init.callee.type&&"codegenNativeCommands"===r.init.callee.name){if("Identifier"===r.id.type&&"Commands"!==r.id.name)throw e.buildCodeFrameError("Native commands must be exported with the name 'Commands'");return void(this.commandsExport=e)}if("Commands"===r.id.name)throw e.buildCodeFrameError("'Commands' is a reserved export and may only be used to export the result of codegenNativeCommands.")}}else e.node.specifiers&&e.node.specifiers.length>0&&e.node.specifiers.forEach(r=>{if("ExportSpecifier"===r.type&&"Identifier"===r.local.type&&"Commands"===r.local.name)throw e.buildCodeFrameError("'Commands' is a reserved export and may only be used to export the result of codegenNativeCommands.")})},ExportDefaultDeclaration(e,r){isCodegenDeclaration(e.node.declaration)&&(this.defaultExport=e)},Program:{exit(r){if(this.defaultExport){const r=generateViewConfig(this.filename,this.code),t=e(r,{babelrc:!1,browserslistConfigFile:!1,configFile:!1});traverseCheap(t,e=>{e?.loc&&(e.loc=this.defaultExport.node.loc,e.start=this.defaultExport.node.start,e.end=this.defaultExport.node.end)}),this.defaultExport.replaceWithMultiple(t.program.body),null!=this.commandsExport&&this.commandsExport.remove(),this.codeInserted=!0}}}}}};