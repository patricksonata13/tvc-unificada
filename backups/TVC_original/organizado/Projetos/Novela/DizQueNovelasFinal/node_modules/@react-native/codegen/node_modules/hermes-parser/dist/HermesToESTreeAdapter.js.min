"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _HermesASTAdapter=_interopRequireDefault(require("./HermesASTAdapter")),_getModuleDocblock=require("./getModuleDocblock");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class HermesToESTreeAdapter extends _HermesASTAdapter.default{constructor(e,t){super(e),this.code=void 0,this.code=t}fixSourceLocation(e){var t;const r=e.loc;null!=r&&(e.loc={source:null!=(t=this.sourceFilename)?t:null,start:r.start,end:r.end},e.range=[r.rangeStart,r.rangeEnd],delete e.start,delete e.end)}mapNode(e){switch(this.fixSourceLocation(e),e.type){case"Program":return this.mapProgram(e);case"NullLiteral":return this.mapNullLiteral(e);case"BooleanLiteral":case"StringLiteral":case"NumericLiteral":case"JSXStringLiteral":return this.mapSimpleLiteral(e);case"BigIntLiteral":return this.mapBigIntLiteral(e);case"RegExpLiteral":return this.mapRegExpLiteral(e);case"Empty":return this.mapEmpty(e);case"TemplateElement":return this.mapTemplateElement(e);case"BigIntLiteralTypeAnnotation":return this.mapBigIntLiteralTypeAnnotation(e);case"GenericTypeAnnotation":return this.mapGenericTypeAnnotation(e);case"ImportDeclaration":return this.mapImportDeclaration(e);case"ImportSpecifier":return this.mapImportSpecifier(e);case"ExportDefaultDeclaration":return this.mapExportDefaultDeclaration(e);case"ExportNamedDeclaration":return this.mapExportNamedDeclaration(e);case"ExportAllDeclaration":return this.mapExportAllDeclaration(e);case"Property":return this.mapProperty(e);case"FunctionDeclaration":case"FunctionExpression":case"ArrowFunctionExpression":return this.mapFunction(e);case"PrivateName":return this.mapPrivateName(e);case"ClassProperty":case"ClassPrivateProperty":return this.mapClassProperty(e);case"MemberExpression":case"OptionalMemberExpression":case"CallExpression":case"OptionalCallExpression":return this.mapChainExpression(e);case"BlockStatement":return this.mapBlockStatement(e);default:return this.mapNodeDefault(e)}}mapProgram(e){const t=this.mapNodeDefault(e);return e.sourceType=this.getSourceType(),e.docblock=(0,_getModuleDocblock.getModuleDocblock)(t),t}mapSimpleLiteral(e){return{type:"Literal",loc:e.loc,range:e.range,value:e.value,raw:this.code.slice(e.range[0],e.range[1]),literalType:(()=>{switch(e.type){case"NullLiteral":return"null";case"BooleanLiteral":return"boolean";case"StringLiteral":case"JSXStringLiteral":return"string";case"NumericLiteral":return"numeric";case"BigIntLiteral":return"bigint";case"RegExpLiteral":return"regexp"}return null})()}}mapBigIntLiteral(e){return{...this.mapSimpleLiteral(e),...this.getBigIntLiteralValue(e.bigint)}}mapNullLiteral(e){return{...this.mapSimpleLiteral(e),value:null}}mapRegExpLiteral(e){const{pattern:t,flags:r}=e;let a;try{a=new RegExp(t,r)}catch(e){a=null}return{...this.mapSimpleLiteral(e),value:a,regex:{pattern:t,flags:r}}}mapBigIntLiteralTypeAnnotation(e){return{...e,...this.getBigIntLiteralValue(e.raw)}}mapTemplateElement(e){return{type:"TemplateElement",loc:e.loc,range:e.range,tail:e.tail,value:{cooked:e.cooked,raw:e.raw}}}mapGenericTypeAnnotation(e){return null==e.typeParameters&&"Identifier"===e.id.type&&"this"===e.id.name?{type:"ThisTypeAnnotation",loc:e.loc,range:e.range}:this.mapNodeDefault(e)}mapProperty(e){const t=this.mapNodeDefault(e);return"FunctionExpression"!==t.value.type||!t.method&&"init"===t.kind||(t.value.loc.start=t.key.loc.end,t.value.range[0]=t.key.range[1]),t}mapComment(e){return"CommentBlock"===e.type?e.type="Block":"CommentLine"===e.type&&(e.type="Line"),e}mapFunction(e){const t=this.mapNodeDefault(e);switch(t.type){case"FunctionDeclaration":case"FunctionExpression":return t.expression=!1,t;case"ArrowFunctionExpression":return t.expression="BlockStatement"!==t.body.type,t}return t}mapChainExpression(e){const t=this.mapNodeDefault(e),{child:r,childKey:a,isOptional:n}=(()=>{const e=!0===t.optional;return t.type.endsWith("MemberExpression")?{child:t.object,childKey:"object",isOptional:e}:t.type.endsWith("CallExpression")?{child:t.callee,childKey:"callee",isOptional:e}:{child:t.expression,childKey:"expression",isOptional:!1}})(),i="ChainExpression"===r.type&&"MemberExpression"!==t.type&&"CallExpression"!==t.type;if(t.type.startsWith("Optional")?(t.type=t.type.replace("Optional",""),t.optional=n):t.optional=!1,!i&&!n)return t;if(i){const e=r.expression;t[a]=e}return{type:"ChainExpression",expression:t,loc:t.loc,range:t.range}}mapClassProperty(e){const t=this.mapNodeDefault(e),r=(()=>{if("ClassPrivateProperty"===t.type){const e=this.mapNodeDefault(t.key);return{type:"PrivateIdentifier",name:e.name,range:e.range,loc:e.loc}}return t.key})();return{...t,computed:"ClassPrivateProperty"!==t.type&&t.computed,key:r,type:"PropertyDefinition"}}mapPrivateName(e){return{type:"PrivateIdentifier",name:e.id.name,range:e.range,loc:e.loc}}mapExportNamedDeclaration(e){const t=super.mapExportNamedDeclaration(e),r=t.specifiers.find(e=>"ExportNamespaceSpecifier"===e.type);if(null!=r){var a;if(1!==t.specifiers.length)throw new Error("Cannot use an export all with any other specifiers");return{type:"ExportAllDeclaration",source:t.source,exportKind:null!=(a=t.exportKind)?a:"value",exported:r.exported,range:t.range,loc:t.loc}}return t}mapExportAllDeclaration(e){var t;const r=super.mapExportAllDeclaration(e);return r.exported=null!=(t=r.exported)?t:null,r}mapBlockStatement(e){return e.implicit&&e.body.length?this.mapNode(e.body[0]):(delete e.implicit,this.mapNodeDefault(e))}}exports.default=HermesToESTreeAdapter;