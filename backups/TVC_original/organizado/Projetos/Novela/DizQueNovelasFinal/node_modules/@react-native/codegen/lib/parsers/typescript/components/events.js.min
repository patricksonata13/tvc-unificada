"use strict";const{throwIfArgumentPropsAreNull:throwIfArgumentPropsAreNull,throwIfBubblingTypeIsNull:throwIfBubblingTypeIsNull,throwIfEventHasNoName:throwIfEventHasNoName}=require("../../error-utils"),{buildPropertiesForEvent:buildPropertiesForEvent,emitBuildEventSchema:emitBuildEventSchema,getEventArgument:getEventArgument,handleEventHandler:handleEventHandler}=require("../../parsers-commons"),{emitBoolProp:emitBoolProp,emitDoubleProp:emitDoubleProp,emitFloatProp:emitFloatProp,emitInt32Prop:emitInt32Prop,emitMixedProp:emitMixedProp,emitObjectProp:emitObjectProp,emitStringProp:emitStringProp,emitUnionProp:emitUnionProp}=require("../../parsers-primitives"),{parseTopLevelType:parseTopLevelType}=require("../parseTopLevelType"),{flattenProperties:flattenProperties}=require("./componentsUtils");function getPropertyType(e,t,r,n){const o=parseTopLevelType(r,n),p=o.type,a=t||o.optional,i="TSTypeReference"===p.type?n.getTypeAnnotationName(p):p.type;switch(i){case"TSBooleanKeyword":return emitBoolProp(e,a);case"TSStringKeyword":return emitStringProp(e,a);case"Int32":return emitInt32Prop(e,a);case"Double":return emitDoubleProp(e,a);case"Float":return emitFloatProp(e,a);case"TSTypeLiteral":return emitObjectProp(e,a,n,p,extractArrayElementType);case"TSUnionType":return emitUnionProp(e,a,n,p);case"UnsafeMixed":return emitMixedProp(e,a);case"TSArrayType":return{name:e,optional:a,typeAnnotation:extractArrayElementType(p,e,n)};default:throw new Error(`Unable to determine event type for "${e}": ${i}`)}}function extractArrayElementType(e,t,r){const n=extractTypeFromTypeAnnotation(e,r);switch(n){case"TSParenthesizedType":return extractArrayElementType(e.typeAnnotation,t,r);case"TSBooleanKeyword":return{type:"BooleanTypeAnnotation"};case"TSStringKeyword":return{type:"StringTypeAnnotation"};case"Float":return{type:"FloatTypeAnnotation"};case"Int32":return{type:"Int32TypeAnnotation"};case"TSNumberKeyword":case"Double":return{type:"DoubleTypeAnnotation"};case"TSUnionType":return{type:"StringLiteralUnionTypeAnnotation",types:e.types.map(e=>({type:"StringLiteralTypeAnnotation",value:r.getLiteralValue(e)}))};case"TSTypeLiteral":return{type:"ObjectTypeAnnotation",properties:r.getObjectProperties(e).map(e=>buildPropertiesForEvent(e,r,getPropertyType))};case"TSArrayType":return{type:"ArrayTypeAnnotation",elementType:extractArrayElementType(e.elementType,t,r)};default:throw new Error(`Unrecognized ${n} for Array ${t} in events.\n${JSON.stringify(e,null,2)}`)}}function extractTypeFromTypeAnnotation(e,t){return"TSTypeReference"===e.type?t.getTypeAnnotationName(e):e.type}function findEventArgumentsAndType(e,t,r,n,o){if("TSInterfaceDeclaration"===t.type)return{argumentProps:flattenProperties([t],r,e),paperTopLevelNameDeprecated:o,bubblingType:n};if("TSTypeLiteral"===t.type)return{argumentProps:e.getObjectProperties(t),paperTopLevelNameDeprecated:o,bubblingType:n};throwIfEventHasNoName(t,e);const p=e.getTypeAnnotationName(t);if("Readonly"===p)return findEventArgumentsAndType(e,t.typeParameters.params[0],r,n,o);if("BubblingEventHandler"===p||"DirectEventHandler"===p)return handleEventHandler(p,t,e,r,findEventArgumentsAndType);if(r[p]){let t=r[p];return"TSTypeAliasDeclaration"===t.type&&(t=t.typeAnnotation),findEventArgumentsAndType(e,t,r,n,o)}return{argumentProps:null,bubblingType:null,paperTopLevelNameDeprecated:null}}function buildEventSchema(e,t,r){const n=parseTopLevelType(t.typeAnnotation.typeAnnotation,r,e),o=t.key.name,p=n.type,a=t.optional||n.optional,{argumentProps:i,bubblingType:l,paperTopLevelNameDeprecated:y}=findEventArgumentsAndType(r,p,e),u=throwIfArgumentPropsAreNull(i,o),m=throwIfBubblingTypeIsNull(l,o),s=getEventArgument(u,r,getPropertyType);return emitBuildEventSchema(y,o,a,m,s)}function getEvents(e,t,r){return e.map(e=>buildEventSchema(t,e,r)).filter(Boolean)}module.exports={getEvents:getEvents,extractArrayElementType:extractArrayElementType};