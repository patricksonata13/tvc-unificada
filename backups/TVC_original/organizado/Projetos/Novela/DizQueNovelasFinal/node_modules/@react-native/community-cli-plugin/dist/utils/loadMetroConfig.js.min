"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=loadMetroConfig;var _errors=require("./errors"),_metroPlatformResolver=require("./metroPlatformResolver"),_metroConfig=require("metro-config"),_path=_interopRequireDefault(require("path"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const debug=require("debug")("ReactNative:CommunityCliPlugin");function getCommunityCliDefaultConfig(e,t){const r=Object.keys(e.platforms).filter(t=>e.platforms[t].npmPackageName),o={platforms:[...Object.keys(e.platforms),"native"]};return r.length&&(o.resolveRequest=(0,_metroPlatformResolver.reactNativePlatformResolver)(r.reduce((t,r)=>(t[r]=e.platforms[r].npmPackageName,t),{}),t.resolver?.resolveRequest)),{resolver:o,serializer:{getModulesRunBeforeMainModule:()=>[require.resolve(_path.default.join(e.reactNativePath,"Libraries/Core/InitializeCore"),{paths:[e.root]}),...r.map(t=>require.resolve(`${e.platforms[t].npmPackageName}/Libraries/Core/InitializeCore`,{paths:[e.root]}))]}}}async function loadMetroConfig(e,t={}){let r=null;try{r=require("@react-native/metro-config")}catch(e){throw new Error("Cannot resolve `@react-native/metro-config`. Ensure it is listed in your project's `devDependencies`.")}const o=r.getDefaultConfig(e.root);if(global.__REACT_NATIVE_METRO_CONFIG_LOADED=!1,"function"!=typeof r.setFrameworkDefaults)throw new Error("`@react-native/metro-config` does not have the expected API. Ensure it matches your React Native version.");r.setFrameworkDefaults(getCommunityCliDefaultConfig(e,o));const i=e.root,a=await(0,_metroConfig.resolveConfig)(t.config,i);if(a.isEmpty)throw new _errors.CLIError(`No Metro config found in ${i}`);if(debug(`Reading Metro config from ${a.filepath}`),!global.__REACT_NATIVE_METRO_CONFIG_LOADED)for(const e of"\n=================================================================================================\nFrom React Native 0.73, your project's Metro config should extend '@react-native/metro-config'\nor it will fail to build. Please copy the template at:\nhttps://github.com/react-native-community/template/blob/main/template/metro.config.js\nThis warning will be removed in future (https://github.com/facebook/metro/issues/1018).\n=================================================================================================\n    ".trim().split("\n"))console.warn(e);return(0,_metroConfig.loadConfig)({cwd:i,...t})}