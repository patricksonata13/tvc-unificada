import*as e from"../../core/sdk/sdk.js";import*as t from"../../ui/visual_logging/visual_logging.js";import*as i from"../../core/i18n/i18n.js";import*as n from"../../core/platform/platform.js";import*as o from"../sources/sources.js";import*as s from"../../ui/legacy/legacy.js";import*as r from"../../core/common/common.js";import"../../ui/components/buttons/buttons.js";import*as a from"../event_listeners/event_listeners.js";var l={cssText:`:host{margin:0;padding:2px 4px;min-height:18px}.tree-outline{padding:0}.tree-outline li{margin-left:14px;user-select:text}.tree-outline li.parent{margin-left:1px}.tree-outline li:not(.parent)::before{display:none}.breakpoint-hit{background-color:var(--sys-color-yellow-container);color:var(--sys-color-on-yellow-container)}.breakpoint-hit .breakpoint-hit-marker{background-color:var(--sys-color-yellow-container);border-right:3px solid var(--sys-color-yellow-outline);color:var(--sys-color-on-yellow-container);height:100%;left:0;margin-left:-30px;position:absolute;right:-4px;z-index:-1}dt-checkbox.source-code{max-width:100%}\n/*# sourceURL=${import.meta.resolve("./categorizedBreakpointsSidebarPane.css")} */\n`};const d={auctionWorklet:"Ad Auction Worklet",animation:"Animation",breakpointHit:"breakpoint hit",canvas:"Canvas",clipboard:"Clipboard",control:"Control",device:"Device",domMutation:"DOM Mutation",dragDrop:"Drag / drop",geolocation:"Geolocation",keyboard:"Keyboard",load:"Load",media:"Media",mouse:"Mouse",notification:"Notification",parse:"Parse",pictureinpicture:"Picture-in-Picture",pointer:"Pointer",script:"Script",sharedStorageWorklet:"Shared Storage Worklet",timer:"Timer",touch:"Touch",trustedTypeViolations:"Trusted Type Violations",webaudio:"WebAudio",window:"Window",worker:"Worker",xhr:"XHR"},c=i.i18n.registerUIStrings("panels/browser_debugger/CategorizedBreakpointsSidebarPane.ts",d),h=i.i18n.getLocalizedString.bind(void 0,c),p=i.i18n.getLazilyComputedLocalizedString.bind(void 0,c);class g extends s.Widget.VBox{#e;#t;#o;#n;#i;#s;constructor(t,o,n){super(!0),this.#e=new s.TreeOutline.TreeOutlineInShadow,this.#e.registerRequiredCSS(l),this.#e.setShowSelectionOnKeyboardFocus(!0),this.contentElement.appendChild(this.#e.element),this.#t=o,this.#o=n;const r=[...new Set(t.map(e=>e.category()))].sort((e,t)=>{const o=u(e),n=u(t);return o.localeCompare(n,i.DevToolsLocale.DevToolsLocale.instance().locale)});this.#n=new Map;for(const e of r)this.createCategory(e);if(r.length>0){const e=this.#n.get(r[0]);e&&e.element.select()}this.#i=new Map;for(const e of t)this.createBreakpoint(e);e.TargetManager.TargetManager.instance().addModelListener(e.DebuggerModel.DebuggerModel,e.DebuggerModel.Events.DebuggerPaused,this.update,this),e.TargetManager.TargetManager.instance().addModelListener(e.DebuggerModel.DebuggerModel,e.DebuggerModel.Events.DebuggerResumed,this.update,this),s.Context.Context.instance().addFlavorChangeListener(e.Target.Target,this.update,this)}get categories(){return this.#n}get breakpoints(){return this.#i}focus(){this.#e.forceSelect()}handleSpaceKeyEventOnBreakpoint(e,t){e&&" "===e.key&&(t&&t.checkbox.click(),e.consume(!0))}createCategory(e){const t=s.UIUtils.CheckboxLabel.create(u(e),void 0,void 0,e,!0);t.checkboxElement.addEventListener("click",this.categoryCheckboxClicked.bind(this,e),!0),t.checkboxElement.tabIndex=-1;const o=new s.TreeOutline.TreeElement(t,void 0,e);o.listItemElement.addEventListener("keydown",t=>{this.handleSpaceKeyEventOnBreakpoint(t,this.#n.get(e))}),t.checkboxElement.addEventListener("keydown",t=>{o.listItemElement.focus(),this.handleSpaceKeyEventOnBreakpoint(t,this.#n.get(e))}),s.ARIAUtils.setChecked(o.listItemElement,!1),this.#e.appendChild(o),this.#n.set(e,{element:o,checkbox:t.checkboxElement})}createBreakpoint(e){const t=s.UIUtils.CheckboxLabel.create(o.CategorizedBreakpointL10n.getLocalizedBreakpointName(e.name),void 0,void 0,n.StringUtilities.toKebabCase(e.name),!0);t.classList.add("source-code","breakpoint"),t.checkboxElement.addEventListener("click",this.breakpointCheckboxClicked.bind(this,e),!0),t.checkboxElement.tabIndex=-1;const i=new s.TreeOutline.TreeElement(t,void 0,n.StringUtilities.toKebabCase(e.name));i.listItemElement.addEventListener("keydown",t=>{this.handleSpaceKeyEventOnBreakpoint(t,this.#i.get(e))}),t.checkboxElement.addEventListener("keydown",t=>{i.listItemElement.focus(),this.handleSpaceKeyEventOnBreakpoint(t,this.#i.get(e))}),s.ARIAUtils.setChecked(i.listItemElement,!1),i.listItemElement.createChild("div","breakpoint-hit-marker");const r=this.#n.get(e.category());r&&r.element.appendChild(i),this.#i.set(e,{element:i,checkbox:t.checkboxElement})}getBreakpointFromPausedDetails(e){return null}update(){const t=s.Context.Context.instance().flavor(e.Target.Target),o=t?t.model(e.DebuggerModel.DebuggerModel):null,n=o?o.debuggerPausedDetails():null;if(!n||n.reason!==this.#o||!n.auxData)return void(this.#s&&(s.ARIAUtils.setDescription(this.#s,""),this.#s.classList.remove("breakpoint-hit"),this.#s=void 0));const i=this.getBreakpointFromPausedDetails(n);if(!i)return;s.ViewManager.ViewManager.instance().showView(this.#t);const r=this.#n.get(i.category());r&&r.element.expand();const a=this.#i.get(i);a&&(this.#s=a.element.listItemElement,s.ARIAUtils.setDescription(this.#s,h(d.breakpointHit)),this.#s.classList.add("breakpoint-hit"))}categoryCheckboxClicked(e){const t=this.#n.get(e);if(!t)return;const o=t.checkbox.checked;s.ARIAUtils.setChecked(t.element.listItemElement,o);for(const[t,n]of this.#i)if(t.category()===e){const e=this.#i.get(t);e&&(e.checkbox.checked=o,this.toggleBreakpoint(t,o),s.ARIAUtils.setChecked(n.element.listItemElement,o))}}toggleBreakpoint(e,t){e.setEnabled(t)}breakpointCheckboxClicked(e){const t=this.#i.get(e);if(!t)return;this.toggleBreakpoint(e,t.checkbox.checked),s.ARIAUtils.setChecked(t.element.listItemElement,t.checkbox.checked);let o=!1,n=!1;for(const t of this.#i.keys())t.category()===e.category()&&(t.enabled()?o=!0:n=!0);const i=this.#n.get(e.category());i&&(i.checkbox.checked=o,i.checkbox.indeterminate=o&&n,i.checkbox.indeterminate?s.ARIAUtils.setCheckboxAsIndeterminate(i.element.listItemElement):s.ARIAUtils.setChecked(i.element.listItemElement,o))}}const k={animation:p(d.animation),"auction-worklet":p(d.auctionWorklet),canvas:p(d.canvas),clipboard:p(d.clipboard),control:p(d.control),device:p(d.device),"dom-mutation":p(d.domMutation),"drag-drop":p(d.dragDrop),geolocation:p(d.geolocation),keyboard:p(d.keyboard),load:p(d.load),media:p(d.media),mouse:p(d.mouse),notification:p(d.notification),parse:p(d.parse),"picture-in-picture":p(d.pictureinpicture),pointer:p(d.pointer),script:p(d.script),"shared-storage-worklet":p(d.sharedStorageWorklet),timer:p(d.timer),touch:p(d.touch),"trusted-type-violation":p(d.trustedTypeViolations),"web-audio":p(d.webaudio),window:p(d.window),worker:p(d.worker),xhr:p(d.xhr)};function u(e){return k[e]()}var b=Object.freeze({__proto__:null,CSPViolationBreakpointsSidebarPane:class extends g{constructor(){super(e.DOMDebuggerModel.DOMDebuggerManager.instance().cspViolationBreakpoints(),"sources.csp-violation-breakpoints","CSPViolation"),this.contentElement.setAttribute("jslog",`${t.section("sources.csp-violation-breakpoints")}`)}getBreakpointFromPausedDetails(t){const o=t.auxData?.violationType?t.auxData.violationType:"",n=e.DOMDebuggerModel.DOMDebuggerManager.instance().cspViolationBreakpoints().find(e=>e.type()===o);return n||null}toggleBreakpoint(t,o){t.setEnabled(o),e.DOMDebuggerModel.DOMDebuggerManager.instance().updateCSPViolationBreakpoints()}}}),m={cssText:`.dom-breakpoints-container{overflow:auto}.breakpoint-list{padding-bottom:3px}.breakpoint-list .dom-breakpoint > div{overflow:hidden;text-overflow:ellipsis}.breakpoint-entry{display:flex;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;padding:2px 0}.breakpoint-entry:focus-visible{background-color:var(--sys-color-tonal-container)}.breakpoint-hit{background-color:var(--sys-color-neutral-container);color:var(--sys-color-on-surface)}.placeholder{display:flex;height:100%;justify-content:center}:host-context(.sources.panel) .empty-view-scroller{display:none}:host-context(.elements.panel) .placeholder .gray-info-message{display:none}@media (forced-colors: active){.breakpoint-entry:focus-visible,\n  .breakpoint-list .breakpoint-entry:hover{forced-color-adjust:none;background-color:Highlight}.breakpoint-entry:focus-visible *,\n  .breakpoint-list .breakpoint-entry:hover *{color:HighlightText}}\n/*# sourceURL=${import.meta.resolve("./domBreakpointsSidebarPane.css")} */\n`};const v={noBreakpoints:"No DOM breakpoints",domBreakpointsDescription:"DOM breakpoints pause on the code that changes a DOM node or its children.",domBreakpointsList:"DOM Breakpoints list",sS:"{PH1}: {PH2}",sSS:"{PH1}: {PH2}, {PH3}",checked:"checked",unchecked:"unchecked",sBreakpointHit:"{PH1} breakpoint hit",breakpointHit:"breakpoint hit",revealDomNodeInElementsPanel:"Reveal DOM node in Elements panel",removeBreakpoint:"Remove breakpoint",removeAllDomBreakpoints:"Remove all DOM breakpoints",subtreeModified:"Subtree modified",attributeModified:"Attribute modified",nodeRemoved:"Node removed",breakOn:"Break on",breakpointRemoved:"Breakpoint removed",breakpointSet:"Breakpoint set"},x=i.i18n.registerUIStrings("panels/browser_debugger/DOMBreakpointsSidebarPane.ts",v),M=i.i18n.getLocalizedString.bind(void 0,x),f=i.i18n.getLazilyComputedLocalizedString.bind(void 0,x);let D;class C extends s.Widget.VBox{elementToCheckboxes;#r;#i;#a;#d;constructor(){super(!0),this.registerRequiredCSS(m),this.elementToCheckboxes=new WeakMap,this.contentElement.setAttribute("jslog",`${t.section("sources.dom-breakpoints").track({resize:!0})}`),this.contentElement.classList.add("dom-breakpoints-container"),this.#r=this.contentElement.createChild("div","placeholder"),this.#r.createChild("div","gray-info-message").textContent=M(v.noBreakpoints);const o=new s.EmptyWidget.EmptyWidget(v.noBreakpoints,M(v.domBreakpointsDescription));o.appendLink("https://developer.chrome.com/docs/devtools/javascript/breakpoints#dom"),o.show(this.#r),this.#i=new s.ListModel.ListModel,this.#a=new s.ListControl.ListControl(this.#i,this,s.ListControl.ListMode.NonViewport),this.contentElement.appendChild(this.#a.element),this.#a.element.classList.add("breakpoint-list","hidden"),s.ARIAUtils.markAsList(this.#a.element),s.ARIAUtils.setLabel(this.#a.element,M(v.domBreakpointsList)),e.TargetManager.TargetManager.instance().addModelListener(e.DOMDebuggerModel.DOMDebuggerModel,"DOMBreakpointAdded",this.breakpointAdded,this),e.TargetManager.TargetManager.instance().addModelListener(e.DOMDebuggerModel.DOMDebuggerModel,"DOMBreakpointToggled",this.breakpointToggled,this),e.TargetManager.TargetManager.instance().addModelListener(e.DOMDebuggerModel.DOMDebuggerModel,"DOMBreakpointsRemoved",this.breakpointsRemoved,this);for(const t of e.TargetManager.TargetManager.instance().models(e.DOMDebuggerModel.DOMDebuggerModel)){t.retrieveDOMBreakpoints();for(const e of t.domBreakpoints())this.addBreakpoint(e)}this.#d=null,this.update()}static instance(){return D||(D=new C),D}createElementForItem(e){const o=document.createElement("div");o.classList.add("breakpoint-entry"),o.setAttribute("jslog",`${t.domBreakpoint().context(e.type).track({keydown:"ArrowUp|ArrowDown|PageUp|PageDown"})}`),o.addEventListener("contextmenu",this.contextMenu.bind(this,e),!0),s.ARIAUtils.markAsListitem(o),o.tabIndex=-1;const n=s.UIUtils.CheckboxLabel.create(void 0,e.enabled),i=n.checkboxElement;i.addEventListener("click",this.checkboxClicked.bind(this,e),!1),i.tabIndex=-1,this.elementToCheckboxes.set(o,i),o.appendChild(n),o.addEventListener("keydown",e=>{" "===e.key&&(n.checkboxElement.click(),e.consume(!0))});const a=document.createElement("div");a.classList.add("dom-breakpoint"),o.appendChild(a);const d=document.createElement("div"),l=E.get(e.type);d.textContent=l?l():null;const c=l?l():"";s.ARIAUtils.setLabel(i,c),i.setAttribute("jslog",`${t.toggle().track({click:!0})}`);const h=e.enabled?M(v.checked):M(v.unchecked),p=document.createElement("monospace");return p.style.display="block",a.appendChild(p),r.Linkifier.Linkifier.linkify(e.node,{preventKeyboardFocus:!0,tooltip:void 0}).then(e=>{p.appendChild(e),s.ARIAUtils.setLabel(i,M(v.sS,{PH1:c,PH2:e.deepTextContent()})),s.ARIAUtils.setLabel(o,M(v.sSS,{PH1:c,PH2:e.deepTextContent(),PH3:h}))}),a.appendChild(d),e===this.#d?(o.classList.add("breakpoint-hit"),s.ARIAUtils.setDescription(o,M(v.sBreakpointHit,{PH1:h})),s.ARIAUtils.setDescription(i,M(v.breakpointHit))):s.ARIAUtils.setDescription(o,h),this.#r.classList.add("hidden"),this.#a.element.classList.remove("hidden"),o}heightForItem(e){return 0}isItemSelectable(e){return!0}updateSelectedItemARIA(e,t){return!0}selectedItemChanged(e,t,o,n){o&&(o.tabIndex=-1),n&&(this.setDefaultFocusedElement(n),n.tabIndex=0,this.hasFocus()&&n.focus())}breakpointAdded(e){this.addBreakpoint(e.data)}breakpointToggled(e){const t=this.hasFocus(),o=e.data;this.#a.refreshItem(o),t&&this.focus()}breakpointsRemoved(e){const t=this.hasFocus(),o=e.data;let n=-1;for(const e of o){const t=this.#i.indexOf(e);t>=0&&(this.#i.remove(t),n=t)}if(0===this.#i.length)this.#r.classList.remove("hidden"),this.setDefaultFocusedElement(this.#r),this.#a.element.classList.add("hidden");else if(n>=0){const e=this.#i.at(n);e&&this.#a.selectItem(e)}t&&this.focus()}addBreakpoint(e){this.#i.insertWithComparator(e,(e,t)=>e.type>t.type?-1:e.type<t.type?1:0),this.#a.selectedItem()&&this.hasFocus()||this.#a.selectItem(this.#i.at(0))}contextMenu(e,t){const o=new s.ContextMenu.ContextMenu(t);o.defaultSection().appendItem(M(v.revealDomNodeInElementsPanel),()=>r.Revealer.reveal(e.node),{jslogContext:"reveal-in-elements"}),o.defaultSection().appendItem(M(v.removeBreakpoint),()=>{e.domDebuggerModel.removeDOMBreakpoint(e.node,e.type)},{jslogContext:"remove-breakpoint"}),o.defaultSection().appendItem(M(v.removeAllDomBreakpoints),()=>{e.domDebuggerModel.removeAllDOMBreakpoints()},{jslogContext:"remove-all-dom-breakpoints"}),o.show()}checkboxClicked(e,t){e.domDebuggerModel.toggleDOMBreakpoint(e,!!t.target&&t.target.checked)}flavorChanged(e){this.update()}update(){const t=s.Context.Context.instance().flavor(e.DebuggerModel.DebuggerPausedDetails);if(this.#d){const e=this.#d;this.#d=null,this.#a.refreshItem(e)}if(!t?.auxData||"DOM"!==t.reason)return;const o=t.debuggerModel.target().model(e.DOMDebuggerModel.DOMDebuggerModel);if(!o)return;const n=o.resolveDOMBreakpointData(t.auxData);if(n){for(const e of this.#i)e.node===n.node&&e.type===n.type&&(this.#d=e);this.#d&&this.#a.refreshItem(this.#d),s.ViewManager.ViewManager.instance().showView("sources.dom-breakpoints")}}}const E=new Map([["subtree-modified",f(v.subtreeModified)],["attribute-modified",f(v.attributeModified)],["node-removed",f(v.nodeRemoved)]]);var B=Object.freeze({__proto__:null,ContextMenuProvider:class{appendApplicableItems(t,n,i){if(i.pseudoType())return;const r=i.domModel().target().model(e.DOMDebuggerModel.DOMDebuggerModel);if(!r)return;function a(e){if(!r)return;const t=o.DebuggerPausedMessage.BreakpointTypeNouns.get(e),n=t?t():"";r.hasDOMBreakpoint(i,e)?(r.removeDOMBreakpoint(i,e),s.ARIAUtils.alert(`${M(v.breakpointRemoved)}: ${n}`)):(r.setDOMBreakpoint(i,e),s.ARIAUtils.alert(`${M(v.breakpointSet)}: ${n}`))}const d=n.debugSection().appendSubMenuItem(M(v.breakOn),!1,"break-on"),l={SubtreeModified:"subtree-modified",AttributeModified:"attribute-modified",NodeRemoved:"node-removed"};for(const e of Object.values(l)){const t=o.DebuggerPausedMessage.BreakpointTypeNouns.get(e);t&&d.defaultSection().appendCheckboxItem(t(),a.bind(null,e),{checked:r.hasDOMBreakpoint(i,e),jslogContext:e})}}},DOMBreakpointsSidebarPane:C});let y;class w extends g{constructor(){let o=e.DOMDebuggerModel.DOMDebuggerManager.instance().eventListenerBreakpoints();const n=e.EventBreakpointsModel.EventBreakpointsManager.instance().eventListenerBreakpoints();o=o.concat(n),super(o,"sources.event-listener-breakpoints","EventListener"),this.contentElement.setAttribute("jslog",`${t.section("sources.event-listener-breakpoints")}`)}static instance(){return y||(y=new w),y}getBreakpointFromPausedDetails(t){const o=t.auxData;return e.DOMDebuggerModel.DOMDebuggerManager.instance().resolveEventListenerBreakpoint(o)||e.EventBreakpointsModel.EventBreakpointsManager.instance().resolveEventListenerBreakpoint(o)}}var L=Object.freeze({__proto__:null,EventListenerBreakpointsSidebarPane:w});class I extends s.ThrottledWidget.ThrottledWidget{#l;eventListenersView;constructor(){super(),this.contentElement.setAttribute("jslog",`${t.section("sources.global-listeners")}`),this.eventListenersView=new a.EventListenersView.EventListenersView(this.update.bind(this),!0),this.eventListenersView.show(this.element),this.setDefaultFocusedChild(this.eventListenersView),this.update()}toolbarItems(){const e=s.Toolbar.Toolbar.createActionButton("browser-debugger.refresh-global-event-listeners");return e.setSize("SMALL"),[e]}async doUpdate(){this.#l&&(this.#l.runtimeModel.releaseObjectGroup(A),this.#l=void 0);const t=[],o=s.Context.Context.instance().flavor(e.RuntimeModel.ExecutionContext);if(o){this.#l=o;const e=await o.evaluate({expression:"self",objectGroup:A,includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1},!1,!1);"error"in e||e.exceptionDetails||t.push(e.object)}await this.eventListenersView.addObjects(t)}wasShown(){super.wasShown(),s.Context.Context.instance().addFlavorChangeListener(e.RuntimeModel.ExecutionContext,this.update,this),s.Context.Context.instance().setFlavor(I,this)}willHide(){s.Context.Context.instance().setFlavor(I,null),s.Context.Context.instance().removeFlavorChangeListener(e.RuntimeModel.ExecutionContext,this.update,this),super.willHide(),this.#l&&(this.#l.runtimeModel.releaseObjectGroup(A),this.#l=void 0)}}const A="object-event-listeners-sidebar-pane";var O=Object.freeze({__proto__:null,ActionDelegate:class{handleAction(e,t){if("browser-debugger.refresh-global-event-listeners"===t){const t=e.flavor(I);return!!t&&(t.update(),!0)}return!1}},ObjectEventListenersSidebarPane:I,objectGroupName:A}),R={cssText:`.breakpoint-list{padding-bottom:3px}.breakpoint-list .editing.being-edited{overflow:hidden;white-space:nowrap}.breakpoint-condition{display:block;margin:4px 8px 4px 23px}.breakpoint-condition-input{display:block;margin-left:0;margin-right:0;border:1px solid var(--sys-color-neutral-outline);border-radius:4px;&:focus{outline:5px auto var(--sys-color-tonal-outline);box-shadow:none}}.breakpoint-entry{white-space:nowrap;padding:2px 0}.breakpoint-list .breakpoint-entry:focus-visible{background-color:var(--sys-color-tonal-container)}.breakpoint-entry dt-checkbox{max-width:100%}.breakpoint-hit{background-color:var(--sys-color-yellow-container);border-right:3px solid var(--sys-color-yellow-outline);color:var(--sys-color-on-yellow-container)}@media (forced-colors: active){.breakpoint-list .breakpoint-entry:hover,\n  .breakpoint-list .breakpoint-entry:focus-visible{forced-color-adjust:none;background-color:Highlight}.breakpoint-list .breakpoint-entry:hover *,\n  .breakpoint-list .breakpoint-entry:focus-visible *{color:HighlightText}}\n/*# sourceURL=${import.meta.resolve("./xhrBreakpointsSidebarPane.css")} */\n`};const S={xhrfetchBreakpoints:"XHR/fetch Breakpoints",noBreakpoints:"No breakpoints",addXhrfetchBreakpoint:"Add XHR/fetch breakpoint",addBreakpoint:"Add breakpoint",breakWhenUrlContains:"Break when URL contains:",urlBreakpoint:"URL Breakpoint",urlContainsS:'URL contains "{PH1}"',anyXhrOrFetch:"Any XHR or fetch",breakpointHit:"breakpoint hit",removeAllBreakpoints:"Remove all breakpoints",removeBreakpoint:"Remove breakpoint"},T=i.i18n.registerUIStrings("panels/browser_debugger/XHRBreakpointsSidebarPane.ts",S),P=i.i18n.getLocalizedString.bind(void 0,T),U=new WeakMap,j=new WeakMap;let H;class V extends s.Widget.VBox{#i;#a;#r;#c;#h;#p;constructor(){super(!0),this.registerRequiredCSS(R),this.#i=new s.ListModel.ListModel,this.#a=new s.ListControl.ListControl(this.#i,this,s.ListControl.ListMode.NonViewport),this.contentElement.setAttribute("jslog",`${t.section("source.xhr-breakpoints")}`),this.contentElement.appendChild(this.#a.element),this.#a.element.classList.add("breakpoint-list","hidden"),s.ARIAUtils.markAsList(this.#a.element),s.ARIAUtils.setLabel(this.#a.element,P(S.xhrfetchBreakpoints)),this.#r=this.contentElement.createChild("div","gray-info-message"),this.#r.textContent=P(S.noBreakpoints),this.#c=new Map,this.#h=new s.Toolbar.ToolbarButton(P(S.addXhrfetchBreakpoint),"plus",void 0,"sources.add-xhr-fetch-breakpoint"),this.#h.setSize("SMALL"),this.#h.addEventListener("Click",()=>{this.addButtonClicked()}),this.#r.addEventListener("contextmenu",this.emptyElementContextMenu.bind(this),!0),this.#r.tabIndex=-1,this.restoreBreakpoints(),this.update()}static instance(){return H||(H=new V),H}toolbarItems(){return[this.#h]}emptyElementContextMenu(e){const t=new s.ContextMenu.ContextMenu(e);t.defaultSection().appendItem(P(S.addBreakpoint),this.addButtonClicked.bind(this),{jslogContext:"sources.add-xhr-fetch-breakpoint"}),t.show()}async addButtonClicked(){await s.ViewManager.ViewManager.instance().showView("sources.xhr-breakpoints");const o=document.createElement("p");o.classList.add("breakpoint-condition"),o.textContent=P(S.breakWhenUrlContains),o.setAttribute("jslog",`${t.value("condition").track({change:!0})}`);const n=o.createChild("span","breakpoint-condition-input");s.ARIAUtils.setLabel(n,P(S.urlBreakpoint)),this.addListElement(o,this.#a.element.firstChild);const i=new s.InplaceEditor.Config((t,n)=>{this.removeListElement(o),e.DOMDebuggerModel.DOMDebuggerManager.instance().addXHRBreakpoint(n,!0),this.setBreakpoint(n),this.update()},()=>{this.removeListElement(o),this.update()},void 0);s.InplaceEditor.InplaceEditor.startEditing(n,i)}heightForItem(e){return 0}isItemSelectable(e){return!0}setBreakpoint(e){-1!==this.#i.indexOf(e)?this.#a.refreshItem(e):this.#i.insertWithComparator(e,(e,t)=>e>t?1:e<t?-1:0),this.#a.selectedItem()&&this.hasFocus()||this.#a.selectItem(this.#i.at(0))}createElementForItem(o){const n=document.createElement("div");s.ARIAUtils.markAsListitem(n);const i=n.createChild("div","breakpoint-entry");U.set(n,i);const r=e.DOMDebuggerModel.DOMDebuggerManager.instance().xhrBreakpoints().get(o)||!1;s.ARIAUtils.markAsCheckbox(i),s.ARIAUtils.setChecked(i,r),i.addEventListener("contextmenu",this.contextMenu.bind(this,o),!0);const a=o?P(S.urlContainsS,{PH1:o}):P(S.anyXhrOrFetch),d=s.UIUtils.CheckboxLabel.create(a,r,void 0,void 0,!0);return s.ARIAUtils.setHidden(d,!0),s.ARIAUtils.setLabel(i,a),i.appendChild(d),d.checkboxElement.addEventListener("click",this.checkboxClicked.bind(this,o,r),!1),i.addEventListener("click",e=>{e.target===i&&this.checkboxClicked(o,r)},!1),j.set(i,d.checkboxElement),d.checkboxElement.tabIndex=-1,i.tabIndex=-1,o===this.#a.selectedItem()&&(i.tabIndex=0,this.setDefaultFocusedElement(i)),i.addEventListener("keydown",e=>{let t=!1;" "===e.key?(this.checkboxClicked(o,r),t=!0):"Enter"===e.key&&(this.labelClicked(o),t=!0),t&&e.consume(!0)}),o===this.#p&&(i.classList.add("breakpoint-hit"),s.ARIAUtils.setDescription(i,P(S.breakpointHit))),d.classList.add("cursor-auto"),d.textElement.addEventListener("dblclick",this.labelClicked.bind(this,o),!1),this.#c.set(o,n),n.setAttribute("jslog",`${t.item().track({click:!0,dblclick:!0,keydown:"ArrowUp|ArrowDown|PageUp|PageDown|Enter|Space"})}`),n}selectedItemChanged(e,t,o,n){if(o){const e=U.get(o);if(!e)throw new Error("Expected breakpoint entry to be found for an element");e.tabIndex=-1}if(n){const e=U.get(n);if(!e)throw new Error("Expected breakpoint entry to be found for an element");this.setDefaultFocusedElement(e),e.tabIndex=0,this.hasFocus()&&e.focus()}}updateSelectedItemARIA(e,t){return!0}removeBreakpoint(e){const t=this.#i.indexOf(e);t>=0&&this.#i.remove(t),this.#c.delete(e),this.update()}addListElement(e,t){this.#a.element.insertBefore(e,t),this.#r.classList.add("hidden"),this.#a.element.classList.remove("hidden")}removeListElement(e){this.#a.element.removeChild(e),this.#a.element.firstElementChild||(this.#r.classList.remove("hidden"),this.#a.element.classList.add("hidden"))}contextMenu(t,o){const n=new s.ContextMenu.ContextMenu(o),i=P(S.removeAllBreakpoints);n.defaultSection().appendItem(P(S.addBreakpoint),this.addButtonClicked.bind(this),{jslogContext:"sources.add-xhr-fetch-breakpoint"}),n.defaultSection().appendItem(P(S.removeBreakpoint),function(){e.DOMDebuggerModel.DOMDebuggerManager.instance().removeXHRBreakpoint(t),this.removeBreakpoint(t)}.bind(this),{jslogContext:"sources.remove-xhr-fetch-breakpoint"}),n.defaultSection().appendItem(i,function(){for(const t of this.#c.keys())e.DOMDebuggerModel.DOMDebuggerManager.instance().removeXHRBreakpoint(t),this.removeBreakpoint(t);this.update()}.bind(this),{jslogContext:"sources.remove-all-xhr-fetch-breakpoints"}),n.show()}checkboxClicked(t,o){const n=this.hasFocus();e.DOMDebuggerModel.DOMDebuggerManager.instance().toggleXHRBreakpoint(t,!o),this.#a.refreshItem(t),this.#a.selectItem(t),n&&this.focus()}labelClicked(o){const n=this.#c.get(o),i=document.createElement("span");i.classList.add("breakpoint-condition"),i.textContent=o,i.setAttribute("jslog",`${t.value("condition").track({change:!0})}`),n&&(this.#a.element.insertBefore(i,n),n.classList.add("hidden"));const r=new s.InplaceEditor.Config((t,n,i,s)=>{this.removeListElement(t),e.DOMDebuggerModel.DOMDebuggerManager.instance().removeXHRBreakpoint(o),this.removeBreakpoint(o);let r=!0;if(s){const e=U.get(s),t=e?j.get(e):void 0;t&&(r=t.checked)}e.DOMDebuggerModel.DOMDebuggerManager.instance().addXHRBreakpoint(n,r),this.setBreakpoint(n),this.#a.selectItem(n),this.focus()},(e,t)=>{this.removeListElement(e),t&&t.classList.remove("hidden"),this.focus()},n);s.InplaceEditor.InplaceEditor.startEditing(i,r)}flavorChanged(e){this.update()}update(){const t=0===this.#i.length;this.#a.element.classList.toggle("hidden",t),this.#r.classList.toggle("hidden",!t);const o=s.Context.Context.instance().flavor(e.DebuggerModel.DebuggerPausedDetails);if(!o||"XHR"!==o.reason){if(this.#p){const e=this.#p;this.#p=void 0,this.#i.indexOf(e)>=0&&this.#a.refreshItem(e)}return}const n=o.auxData?.breakpointURL;this.#p=n,this.#i.indexOf(n)<0||(this.#a.refreshItem(n),s.ViewManager.ViewManager.instance().showView("sources.xhr-breakpoints"))}restoreBreakpoints(){const t=e.DOMDebuggerModel.DOMDebuggerManager.instance().xhrBreakpoints();for(const e of t.keys())this.setBreakpoint(e)}}var F=Object.freeze({__proto__:null,XHRBreakpointsSidebarPane:V});export{b as CSPViolationBreakpointsSidebarPane,B as DOMBreakpointsSidebarPane,L as EventListenerBreakpointsSidebarPane,O as ObjectEventListenersSidebarPane,F as XHRBreakpointsSidebarPane};