"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _util=require("util");class OpenDebuggerKeyboardHandler{#e;#t;#r=null;constructor({devServerUrl:e,reporter:t}){this.#e=e,this.#t=t}async#s(e){this.#r=null,this.#n();try{await fetch(new URL("/open-debugger?target="+encodeURIComponent(e.id),this.#e).href,{method:"POST"})}catch(t){this.#a("error","Failed to open debugger for %s (%s): %s",e.title,e.description,"Network error"),null!=t.cause&&this.#a("error","Cause: %s",t.cause),this.#n()}}async handleOpenDebugger(){this.#l("Fetching available debugging targets..."),this.#r=null;try{const e=await fetch(this.#e+"/json/list",{method:"POST"});if(200!==e.status)throw new Error(`Unexpected status code: ${e.status}`);const t=await e.json();if(!Array.isArray(t))throw new Error("Expected array.");if(0===t.length)this.#a("warn","No connected targets"),this.#n();else if(1===t.length){const e=t[0];this.#s(e)}else this.#r=t,t.length>9&&this.#a("warn","10 or more debug targets available, showing the first 9."),this.#l(`Multiple debug targets available, please select:\n  ${t.slice(0,9).map(({title:e},t)=>`${(0,_util.styleText)(["white","inverse"],` ${t+1} `)} - "${e}"`).join("\n  ")}`)}catch(e){this.#a("error",`Failed to fetch debug targets: ${e.message}`),this.#n()}}maybeHandleTargetSelection(e){if(e>="1"&&e<="9"){const t=Number(e)-1;if(null!=this.#r&&t<this.#r.length){const e=this.#r[t];return this.#s(e),!0}}return!1}dismiss(){this.#n(),this.#r=null}#a(e,...t){this.#t.update({type:"unstable_server_log",level:e,data:t})}#l(e){this.#t.update({type:"unstable_server_menu_updated",message:e})}#n(){this.#t.update({type:"unstable_server_menu_cleared"})}}exports.default=OpenDebuggerKeyboardHandler;