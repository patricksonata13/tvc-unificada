"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _assetCatalogIOS=require("./assetCatalogIOS"),_createKeepFileAsync=_interopRequireDefault(require("./createKeepFileAsync")),_filterPlatformAssetScales=_interopRequireDefault(require("./filterPlatformAssetScales")),_getAssetDestPathAndroid=_interopRequireDefault(require("./getAssetDestPathAndroid")),_getAssetDestPathIOS=_interopRequireDefault(require("./getAssetDestPathIOS")),_fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_util=require("util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}async function saveAssets(e,t,s,a){if(null==s)return void console.warn("Warning: Assets destination folder is not set, skipping...");const o={},i="android"===t?_getAssetDestPathAndroid.default:_getAssetDestPathIOS.default,r=e=>{const a=new Set((0,_filterPlatformAssetScales.default)(t,e.scales));e.scales.forEach((t,r)=>{if(!a.has(t))return;const l=e.files[r],n=_path.default.join(s,i(e,t));o[l]=n})};if("ios"===t&&null!=a){const s=_path.default.join(a,"RNAssets.xcassets");if(!_fs.default.existsSync(s))return void console.error(`${(0,_util.styleText)("red","error")}: Could not find asset catalog 'RNAssets.xcassets' in ${a}. Make sure to create it if it does not exist.`);console.info("Adding images to asset catalog",s),(0,_assetCatalogIOS.cleanAssetCatalog)(s);for(const a of e)if((0,_assetCatalogIOS.isCatalogAsset)(a)){const e=(0,_assetCatalogIOS.getImageSet)(s,a,(0,_filterPlatformAssetScales.default)(t,a.scales));(0,_assetCatalogIOS.writeImageSet)(e)}else r(a);console.info("Done adding images to asset catalog")}else e.forEach(r);return"android"===t&&await(0,_createKeepFileAsync.default)(e,s),copyAll(o)}function copyAll(e){const t=Object.keys(e);return 0===t.length?Promise.resolve():(console.info(`Copying ${t.length} asset files`),new Promise((s,a)=>{const o=i=>{if(i)a(i);else if(0===t.length)console.info("Done copying assets"),s();else{const s=t.shift();copy(s,e[s],o)}};o()}))}function copy(e,t,s){const a=_path.default.dirname(t);_fs.default.mkdir(a,{recursive:!0},a=>{a?s(a):_fs.default.createReadStream(e).pipe(_fs.default.createWriteStream(t)).on("finish",s)})}var _default=exports.default=saveAssets;