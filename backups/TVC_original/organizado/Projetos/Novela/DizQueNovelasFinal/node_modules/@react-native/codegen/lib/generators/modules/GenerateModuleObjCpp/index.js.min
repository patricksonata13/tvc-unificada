"use strict";const{createAliasResolver:createAliasResolver,getModules:getModules}=require("../Utils"),{serializeStruct:serializeStruct}=require("./header/serializeStruct"),{EventEmitterHeaderTemplate:EventEmitterHeaderTemplate}=require("./serializeEventEmitter"),{serializeMethod:serializeMethod}=require("./serializeMethod"),{serializeModuleSource:serializeModuleSource}=require("./source/serializeModule"),{StructCollector:StructCollector}=require("./StructCollector"),ModuleDeclarationTemplate=({hasteModuleName:e,structDeclarations:t,eventEmitters:n,protocolMethods:o})=>`${t}\n@protocol ${e}Spec <RCTBridgeModule, RCTTurboModule>\n\n${o}\n\n@end\n\n@interface ${e}SpecBase : NSObject {\n@protected\nfacebook::react::EventEmitterCallback _eventEmitterCallback;\n}\n- (void)setEventEmitterCallback:(EventEmitterCallbackWrapper *)eventEmitterCallbackWrapper;\n\n${n}\n@end\n\nnamespace facebook::react {\n  /**\n   * ObjC++ class for module '${e}'\n   */\n  class JSI_EXPORT ${e}SpecJSI : public ObjCTurboModule {\n  public:\n    ${e}SpecJSI(const ObjCTurboModule::InitParams &params);\n  };\n} // namespace facebook::react`,HeaderFileTemplate=({headerFileName:e,moduleDeclarations:t,structInlineMethods:n,assumeNonnull:o})=>{const r=e.replace(/\.h$/,"");return`/**\n * This code was generated by [react-native-codegen](https://www.npmjs.com/package/react-native-codegen).\n *\n * Do not edit this file as changes may cause incorrect behavior and will be lost\n * once the code is regenerated.\n *\n * @generated by codegen project: GenerateModuleObjCpp\n *\n * We create an umbrella header (and corresponding implementation) here since\n * Cxx compilation in BUCK has a limitation: source-code producing genrule()s\n * must have a single output. More files => more genrule()s => slower builds.\n */\n\n#ifndef __cplusplus\n#error This file must be compiled as Obj-C++. If you are importing it, you must change your file extension to .mm.\n#endif\n\n// Avoid multiple includes of ${r} symbols\n#ifndef ${r}_H\n#define ${r}_H\n\n#import <Foundation/Foundation.h>\n#import <RCTRequired/RCTRequired.h>\n#import <RCTTypeSafety/RCTConvertHelpers.h>\n#import <RCTTypeSafety/RCTTypedModuleConstants.h>\n#import <React/RCTBridgeModule.h>\n#import <React/RCTCxxConvert.h>\n#import <React/RCTManagedPointer.h>\n#import <ReactCommon/RCTTurboModule.h>\n#import <optional>\n#import <vector>\n\n`+(o?"\nNS_ASSUME_NONNULL_BEGIN\n":"")+t+"\n"+n+(o?"\nNS_ASSUME_NONNULL_END\n":"\n")+`#endif // ${r}_H\n`},SourceFileTemplate=({headerFileName:e,moduleImplementations:t})=>`/**\n * This code was generated by [react-native-codegen](https://www.npmjs.com/package/react-native-codegen).\n *\n * Do not edit this file as changes may cause incorrect behavior and will be lost\n * once the code is regenerated.\n *\n * @generated by codegen project: GenerateModuleObjCpp\n *\n * We create an umbrella header (and corresponding implementation) here since\n * Cxx compilation in BUCK has a limitation: source-code producing genrule()s\n * must have a single output. More files => more genrule()s => slower builds.\n */\n\n#import "${e}"\n\n${t}\n`;module.exports={generate(e,t,n,o,r){const a=getModules(t),i=[],l=[],s=[],c=Object.keys(a).sort();for(const e of c){const{aliasMap:t,excludedPlatforms:n,spec:o}=a[e];if(null!=n&&n.includes("iOS"))continue;const r=createAliasResolver(t),c=new StructCollector,u=[],d=t=>{u.push(...serializeMethod(e,t,c,r))};o.methods.filter(e=>"getConstants"!==e.name).forEach(d),o.methods.filter(e=>"getConstants"===e.name).forEach(d);const m=c.getAllStructs(),p=[],h=[];for(const t of m){const{methods:n,declaration:o}=serializeStruct(e,t);p.push(o),h.push(n)}i.push(ModuleDeclarationTemplate({hasteModuleName:e,structDeclarations:p.join("\n"),eventEmitters:o.eventEmitters.map(e=>EventEmitterHeaderTemplate(e)).join("\n"),protocolMethods:u.map(({protocolMethod:e})=>e).join("\n")})),l.push(h.join("\n")),s.push(serializeModuleSource(e,m,e,o.eventEmitters,u.filter(({selector:e})=>"@selector(constantsToExport)"!==e)))}const u=`${e}.h`,d=HeaderFileTemplate({headerFileName:u,moduleDeclarations:i.join("\n"),structInlineMethods:l.join("\n"),assumeNonnull:o}),m=`${e}-generated.mm`,p=SourceFileTemplate({headerFileName:u,moduleImplementations:s.join("\n")});return new Map([[u,d],[m,p]])}};