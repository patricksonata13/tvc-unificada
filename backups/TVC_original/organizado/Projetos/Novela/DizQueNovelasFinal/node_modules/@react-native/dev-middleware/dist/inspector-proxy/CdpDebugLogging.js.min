"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _timers=require("timers"),_util=_interopRequireDefault(require("util"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const debug=require("debug")("Metro:InspectorProxy"),debugCDPMessages=require("debug")("Metro:InspectorProxyCDPMessages"),CDP_MESSAGES_BATCH_DEBUGGING_THROTTLE_MS=5e3;function getCDPLogPrefix(e){return _util.default.format("[(Debugger) %s (Proxy) %s (Device)]","DebuggerToProxy"===e?"->":"ProxyToDebugger"===e?"<-":"  ","ProxyToDevice"===e?"->":"DeviceToProxy"===e?"<-":"  ")}class CdpDebugLogging{#e={DebuggerToProxy:()=>{},ProxyToDebugger:()=>{},DeviceToProxy:()=>{},ProxyToDevice:()=>{}};constructor(){debug.enabled&&this.#s()}#s(){const e={DebuggerToProxy:{count:0,size:0},ProxyToDebugger:{count:0,size:0},DeviceToProxy:{count:0,size:0},ProxyToDevice:{count:0,size:0}};Object.keys(e).forEach(s=>{let t=null;this.#e[s]=r=>{if(r.length>102400){const e=JSON.stringify(JSON.parse(r,(e,s)=>Array.isArray(s)?"[ARRAY]":"string"==typeof s&&s.length>50?s.slice(0,50)+"...":s),null,2);debug("%s A large message (%s MB) was %s- %s",getCDPLogPrefix(s),(r.length/1048576).toFixed(2),s.startsWith("Proxy")?"  sent  ":"received",e)}null==t&&(t=(0,_timers.setTimeout)(()=>{debug("%s %s CDP messages of size %s MB %s in the last %ss.",getCDPLogPrefix(s),String(e[s].count).padStart(4),String((e[s].size/1048576).toFixed(2)).padStart(6),s.startsWith("Proxy")?"  sent  ":"received",5),e[s].count=0,e[s].size=0,t=null},5e3).unref()),e[s].count++,e[s].size+=r.length}})}log(e,s){debugCDPMessages.enabled&&debugCDPMessages("%s message: %s",getCDPLogPrefix(e),s),debug.enabled&&this.#e[e](s)}}exports.default=CdpDebugLogging;