"use strict";const{getEnumName:getEnumName}=require("../Utils"),{generateStructName:generateStructName,getCppTypeForAnnotation:getCppTypeForAnnotation,getEnumMaskName:getEnumMaskName,getImports:getImports}=require("./CppHelpers.js");function getNativeTypeFromAnnotation(e,t,n){const r=t.typeAnnotation;switch(r.type){case"BooleanTypeAnnotation":case"StringTypeAnnotation":case"Int32TypeAnnotation":case"DoubleTypeAnnotation":case"FloatTypeAnnotation":return getCppTypeForAnnotation(r.type);case"ReservedPropTypeAnnotation":switch(r.name){case"ColorPrimitive":return"SharedColor";case"ImageSourcePrimitive":return"ImageSource";case"ImageRequestPrimitive":return"ImageRequest";case"PointPrimitive":return"Point";case"EdgeInsetsPrimitive":return"EdgeInsets";case"DimensionPrimitive":return"YGValue";default:throw r.name,new Error("Received unknown ReservedPropTypeAnnotation")}case"ArrayTypeAnnotation":{const o=r.elementType.type;if("ArrayTypeAnnotation"===o)return`std::vector<${getNativeTypeFromAnnotation(e,{typeAnnotation:r.elementType,name:""},n.concat([t.name]))}>`;if("ObjectTypeAnnotation"===o){return`std::vector<${generateStructName(e,n.concat([t.name]))}>`}if("StringEnumTypeAnnotation"===o){const n=getEnumName(e,t.name);return getEnumMaskName(n)}return`std::vector<${getNativeTypeFromAnnotation(e,{typeAnnotation:r.elementType,name:e},n.concat([t.name]))}>`}case"ObjectTypeAnnotation":return generateStructName(e,n.concat([t.name]));case"StringEnumTypeAnnotation":case"Int32EnumTypeAnnotation":return getEnumName(e,t.name);case"MixedTypeAnnotation":return"folly::dynamic";default:throw new Error(`Received invalid typeAnnotation for ${e} prop ${t.name}, received ${r.type}`)}}function convertTypesToConstAddressIfNeeded(e,t){return t.has(e)?`${e} const &`:e}function convertValueToSharedPointerWithMove(e,t,n){return n.has(e)?`std::make_shared<${e}>(std::move(${t}))`:t}function convertVariableToSharedPointer(e,t){return t.has(e)?`std::shared_ptr<${e}>`:e}function convertVariableToPointer(e,t,n){return n.has(e)?`*${t}`:t}const convertCtorParamToAddressType=e=>{const t=new Set;return t.add("ImageSource"),convertTypesToConstAddressIfNeeded(e,t)},convertCtorInitToSharedPointers=(e,t)=>{const n=new Set;return n.add("ImageRequest"),convertValueToSharedPointerWithMove(e,t,n)},convertGettersReturnTypeToAddressType=e=>{const t=new Set;return t.add("ImageRequest"),convertTypesToConstAddressIfNeeded(e,t)},convertVarTypeToSharedPointer=e=>{const t=new Set;return t.add("ImageRequest"),convertVariableToSharedPointer(e,t)},convertVarValueToPointer=(e,t)=>{const n=new Set;return n.add("ImageRequest"),convertVariableToPointer(e,t,n)};function getLocalImports(e){const t=new Set;function n(e){switch(e){case"ColorPrimitive":return void t.add("#include <react/renderer/graphics/Color.h>");case"ImageSourcePrimitive":return void t.add("#include <react/renderer/imagemanager/primitives.h>");case"ImageRequestPrimitive":return void t.add("#include <react/renderer/imagemanager/ImageRequest.h>");case"PointPrimitive":return void t.add("#include <react/renderer/graphics/Point.h>");case"EdgeInsetsPrimitive":return void t.add("#include <react/renderer/graphics/RectangleEdges.h>");case"DimensionPrimitive":return t.add("#include <yoga/Yoga.h>"),void t.add("#include <react/renderer/core/graphicsConversions.h>");default:throw new Error(`Invalid ReservedPropTypeAnnotation name, got ${e}`)}}return e.forEach(e=>{const r=e.typeAnnotation;if("ReservedPropTypeAnnotation"===r.type&&n(r.name),"ArrayTypeAnnotation"===r.type&&(t.add("#include <vector>"),"StringEnumTypeAnnotation"===r.elementType.type&&t.add("#include <cinttypes>")),"ArrayTypeAnnotation"===r.type&&"ReservedPropTypeAnnotation"===r.elementType.type&&n(r.elementType.name),"ArrayTypeAnnotation"===r.type&&"ObjectTypeAnnotation"===r.elementType.type){t.add("#include <react/renderer/core/propsConversions.h>");const e=r.elementType.properties,n=getImports(e),o=getLocalImports(e);n.forEach(t.add,t),o.forEach(t.add,t)}if("ObjectTypeAnnotation"===r.type){t.add("#include <react/renderer/core/propsConversions.h>");const e=getImports(r.properties),n=getLocalImports(r.properties);e.forEach(t.add,t),n.forEach(t.add,t)}}),t}module.exports={getNativeTypeFromAnnotation:getNativeTypeFromAnnotation,convertCtorParamToAddressType:convertCtorParamToAddressType,convertGettersReturnTypeToAddressType:convertGettersReturnTypeToAddressType,convertCtorInitToSharedPointers:convertCtorInitToSharedPointers,convertVarTypeToSharedPointer:convertVarTypeToSharedPointer,convertVarValueToPointer:convertVarValueToPointer,getLocalImports:getLocalImports};