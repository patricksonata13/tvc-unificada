"use strict";function _worker_threads(){const e=require("worker_threads");return _worker_threads=function(){return e},e}function _jestUtil(){const e=require("jest-util");return _jestUtil=function(){return e},e}var _types=require("../types");let file=null,setupArgs=[],initialized=!1;const messageListener=e=>{switch(e[0]){case _types.CHILD_MESSAGE_INITIALIZE:const r=e;file=r[2],setupArgs=r[3],process.env.JEST_WORKER_ID=r[4];break;case _types.CHILD_MESSAGE_CALL:const t=e;execMethod(t[2],t[3]);break;case _types.CHILD_MESSAGE_END:end();break;case _types.CHILD_MESSAGE_MEM_USAGE:reportMemoryUsage();break;case _types.CHILD_MESSAGE_CALL_SETUP:if(initialized)reportSuccess(void 0);else{const e=require(file);initialized=!0,e.setup?execFunction(e.setup,e,setupArgs,reportSuccess,reportInitializeError):reportSuccess(void 0)}break;default:throw new TypeError(`Unexpected request from parent process: ${e[0]}`)}};function reportMemoryUsage(){if(_worker_threads().isMainThread)throw new Error("Child can only be used on a forked process");const e=[_types.PARENT_MESSAGE_MEM_USAGE,process.memoryUsage().heapUsed];_worker_threads().parentPort.postMessage(e)}function reportSuccess(e){if(_worker_threads().isMainThread)throw new Error("Child can only be used on a forked process");try{_worker_threads().parentPort.postMessage([_types.PARENT_MESSAGE_OK,e])}catch(e){reportClientError(e)}}function reportClientError(e){return reportError(e,_types.PARENT_MESSAGE_CLIENT_ERROR)}function reportInitializeError(e){return reportError(e,_types.PARENT_MESSAGE_SETUP_ERROR)}function reportError(e,r){if(_worker_threads().isMainThread)throw new Error("Child can only be used on a forked process");null==e&&(e=new Error('"null" or "undefined" thrown')),_worker_threads().parentPort.postMessage([r,e.constructor&&e.constructor.name,e.message,e.stack,"object"==typeof e?{...e}:e])}function end(){const e=require(file);e.teardown?execFunction(e.teardown,e,[],exitProcess,exitProcess):exitProcess()}function exitProcess(){_worker_threads().parentPort.removeListener("message",messageListener)}function execMethod(e,r){const t=require(file);let s;function o(){execFunction(s,t,r,reportSuccess,reportClientError)}s="default"===e?t.__esModule?t.default:t:t[e],!initialized&&t.setup?(initialized=!0,execFunction(t.setup,t,setupArgs,o,reportInitializeError)):o()}function execFunction(e,r,t,s,o){let n;try{n=e.apply(r,t)}catch(e){return void o(e)}(0,_jestUtil().isPromise)(n)?n.then(s,o):s(n)}_worker_threads().parentPort.on("message",messageListener);