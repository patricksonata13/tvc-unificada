"use strict";const chalk=require("chalk"),cliCursor=require("cli-cursor"),cliSpinners=require("cli-spinners"),logSymbols=require("log-symbols"),stripAnsi=require("strip-ansi"),wcwidth=require("wcwidth"),TEXT=Symbol("text"),PREFIX_TEXT=Symbol("prefixText");class Ora{constructor(t){"string"==typeof t&&(t={text:t}),this.options=Object.assign({text:"",color:"cyan",stream:process.stderr},t),this.spinner=this.options.spinner,this.color=this.options.color,this.hideCursor=!1!==this.options.hideCursor,this.interval=this.options.interval||this.spinner.interval||100,this.stream=this.options.stream,this.id=null,this.isEnabled="boolean"==typeof this.options.isEnabled?this.options.isEnabled:this.stream&&this.stream.isTTY&&!process.env.CI,this.text=this.options.text,this.prefixText=this.options.prefixText,this.linesToClear=0,this.indent=this.options.indent}get indent(){return this._indent}set indent(t=0){if(!(t>=0&&Number.isInteger(t)))throw new Error("The `indent` option must be an integer from 0 and up");this._indent=t}get spinner(){return this._spinner}set spinner(t){if(this.frameIndex=0,"object"==typeof t){if(void 0===t.frames)throw new Error("The given spinner must have a `frames` property");this._spinner=t}else if("win32"===process.platform)this._spinner=cliSpinners.line;else if(void 0===t)this._spinner=cliSpinners.dots;else{if(!cliSpinners[t])throw new Error(`There is no built-in spinner named '${t}'. See https://github.com/sindresorhus/cli-spinners/blob/master/spinners.json for a full list.`);this._spinner=cliSpinners[t]}}get text(){return this[TEXT]}get prefixText(){return this[PREFIX_TEXT]}get isSpinning(){return null!==this.id}updateLineCount(){const t=this.stream.columns||80,s="string"==typeof this[PREFIX_TEXT]?this[PREFIX_TEXT]+"-":"";this.lineCount=stripAnsi(s+"--"+this[TEXT]).split("\n").reduce((s,i)=>s+Math.max(1,Math.ceil(wcwidth(i)/t)),0)}set text(t){this[TEXT]=t,this.updateLineCount()}set prefixText(t){this[PREFIX_TEXT]=t,this.updateLineCount()}frame(){const{frames:t}=this.spinner;let s=t[this.frameIndex];this.color&&(s=chalk[this.color](s)),this.frameIndex=++this.frameIndex%t.length;return("string"==typeof this.prefixText?this.prefixText+" ":"")+s+("string"==typeof this.text?" "+this.text:"")}clear(){if(!this.isEnabled||!this.stream.isTTY)return this;for(let t=0;t<this.linesToClear;t++)t>0&&this.stream.moveCursor(0,-1),this.stream.clearLine(),this.stream.cursorTo(this.indent);return this.linesToClear=0,this}render(){return this.clear(),this.stream.write(this.frame()),this.linesToClear=this.lineCount,this}start(t){return t&&(this.text=t),this.isEnabled?(this.isSpinning||(this.hideCursor&&cliCursor.hide(this.stream),this.render(),this.id=setInterval(this.render.bind(this),this.interval)),this):(this.stream.write(`- ${this.text}\n`),this)}stop(){return this.isEnabled?(clearInterval(this.id),this.id=null,this.frameIndex=0,this.clear(),this.hideCursor&&cliCursor.show(this.stream),this):this}succeed(t){return this.stopAndPersist({symbol:logSymbols.success,text:t})}fail(t){return this.stopAndPersist({symbol:logSymbols.error,text:t})}warn(t){return this.stopAndPersist({symbol:logSymbols.warning,text:t})}info(t){return this.stopAndPersist({symbol:logSymbols.info,text:t})}stopAndPersist(t={}){const s=t.prefixText||this.prefixText,i="string"==typeof s?s+" ":"",e=t.text||this.text,r="string"==typeof e?" "+e:"";return this.stop(),this.stream.write(`${i}${t.symbol||" "}${r}\n`),this}}const oraFactory=function(t){return new Ora(t)};module.exports=oraFactory,module.exports.default=oraFactory,module.exports.promise=(t,s)=>{if("function"!=typeof t.then)throw new TypeError("Parameter `action` must be a Promise");const i=new Ora(s);return i.start(),t.then(()=>{i.succeed()},()=>{i.fail()}),i};