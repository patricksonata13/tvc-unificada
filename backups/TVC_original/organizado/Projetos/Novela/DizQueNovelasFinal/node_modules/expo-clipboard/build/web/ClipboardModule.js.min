import{ClipboardUnavailableException,CopyFailureException,NoPermissionException,PasteFailureException}from"./Exceptions";import{base64toBlob,blobToBase64Async,findHtmlInClipboardAsync,findImageInClipboardAsync,getImageSizeFromBlobAsync,htmlToPlainText,isClipboardPermissionDeniedAsync}from"./Utils";import{StringFormat}from"../Clipboard.types";export default{async getStringAsync(t){if(!navigator.clipboard)throw new ClipboardUnavailableException;try{if(t.preferredFormat===StringFormat.HTML){const t=await navigator.clipboard.read(),a=await findHtmlInClipboardAsync(t);return a?await new Response(a).text():await navigator.clipboard.readText()}{let t=await navigator.clipboard.readText();if(!t||""===t){const a=await navigator.clipboard.read(),e=await findHtmlInClipboardAsync(a),i=await(e?.text());t=htmlToPlainText(i??"")}return t}}catch(t){if("object"==typeof t&&"NotAllowedError"===t?.name||await isClipboardPermissionDeniedAsync())throw new NoPermissionException;try{return window.clipboardData.getData("Text")}catch{return Promise.reject(new Error("Unable to retrieve item from clipboard"))}}},setString(t){const a=document.createElement("textarea");a.textContent=t,document.body.appendChild(a),a.select();try{return document.execCommand("copy"),!0}catch{return!1}finally{document.body.removeChild(a)}},async setStringAsync(t,a){if(a.inputFormat===StringFormat.HTML){if(!navigator.clipboard)throw new ClipboardUnavailableException;try{const a=createHtmlClipboardItem(t);return await navigator.clipboard.write([a]),!0}catch(t){if("object"==typeof t&&"NotAllowedError"===t?.name||await isClipboardPermissionDeniedAsync())throw new NoPermissionException;throw new CopyFailureException(t.message)}}try{if(!navigator.clipboard)throw new Error;return await navigator.clipboard.writeText(t),!0}catch{return this.setString(t)}},hasStringAsync:async()=>await clipboardHasTypesAsync(["text/plain","text/html"]),async getImageAsync(t){if(!navigator.clipboard)throw new ClipboardUnavailableException;try{const t=await navigator.clipboard.read(),a=await findImageInClipboardAsync(t);if(!a)return null;const[e,i]=await Promise.all([blobToBase64Async(a),getImageSizeFromBlobAsync(a)]);return{data:e,size:i}}catch(t){if("object"==typeof t&&"NotAllowedError"===t?.name||await isClipboardPermissionDeniedAsync())throw new NoPermissionException;throw new PasteFailureException(t.message)}},async setImageAsync(t){if(!navigator.clipboard)throw new ClipboardUnavailableException;try{const a=base64toBlob(t,"image/png");await navigator.clipboard.write([new ClipboardItem({[a.type]:a})])}catch(t){throw new CopyFailureException(t.message)}},hasImageAsync:async()=>await clipboardHasTypesAsync(["image/png","image/jpeg"]),addClipboardListener(){},removeClipboardListener(){}};async function clipboardHasTypesAsync(t){if(!navigator.clipboard)throw new ClipboardUnavailableException;try{return(await navigator.clipboard.read()).flatMap(t=>t.types).some(a=>t.includes(a))}catch(t){if("object"==typeof t&&"NotAllowedError"===t?.name||await isClipboardPermissionDeniedAsync())throw new NoPermissionException;throw t}}function createHtmlClipboardItem(t){return new ClipboardItem({"text/html":new Blob([t],{type:"text/html"}),"text/plain":new Blob([htmlToPlainText(t)],{type:"text/plain"})})}