Object.defineProperty(exports,"__esModule",{value:!0});var wonka=require("wonka"),core=require("@urql/core"),retryExchange=(e={})=>{var{retryIf:r,retryWith:t}=e,a=e.initialDelayMs||1e3,o=e.maxDelayMs||15e3,n=e.maxNumberAttempts||2,u=null==e.randomDelay||!!e.randomDelay;return({forward:e,dispatchDebug:i})=>y=>{var{source:c,next:d}=wonka.makeSubject(),l=wonka.mergeMap(e=>{var r=e.context.retry||{count:0,delay:null},t=++r.count,c=r.delay||a,d=Math.random()+1.5;u?c*d<o?c*=d:c=o:c=Math.min(t*a,o),r.delay=c;var l=wonka.filter(r=>("query"===r.kind||"teardown"===r.kind)&&r.key===e.key)(y);return"production"!==process.env.NODE_ENV&&i({type:"retryAttempt",message:`The operation has failed and a retry has been triggered (${t} / ${n})`,operation:e,data:{retryCount:t,delayAmount:c},source:"retryExchange"}),wonka.takeUntil(l)(wonka.debounce(()=>c)(wonka.fromValue(core.makeOperation(e.kind,e,{...e.context,retry:r}))))})(c);return wonka.filter(e=>{var a=e.operation.context.retry;if(!(e.error&&(r?r(e.error,e.operation):t||e.error.networkError)))return a&&(a.count=0,a.delay=null),!0;if(!((a&&a.count||0)>=n-1)){var o=t?t(e.error,e.operation):e.operation;return!o||(d(o),!1)}return"production"!==process.env.NODE_ENV&&i({type:"retryExhausted",message:"Maximum number of retries has been reached. No further retries will be performed.",operation:e.operation,source:"retryExchange"}),!0})(e(wonka.merge([y,l])))}};exports.retryExchange=retryExchange;