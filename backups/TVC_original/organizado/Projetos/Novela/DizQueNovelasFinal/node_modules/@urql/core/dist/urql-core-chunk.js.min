var graphql_web=require("@0no-co/graphql.web"),wonka=require("wonka"),generateErrorMessage=(e,r)=>{var t="";if(e)return`[Network] ${e.message}`;if(r)for(var a=0,n=r.length;a<n;a++)t&&(t+="\n"),t+=`[GraphQL] ${r[a].message}`;return t},rehydrateGraphQlError=e=>e&&"string"==typeof e.message&&(e.extensions||"GraphQLError"===e.name)?e:"object"==typeof e&&"string"==typeof e.message?new graphql_web.GraphQLError(e.message,e.nodes,e.source,e.positions,e.path,e,e.extensions||{}):new graphql_web.GraphQLError(e);class CombinedError extends Error{constructor(e){var r=(e.graphQLErrors||[]).map(rehydrateGraphQlError),t=generateErrorMessage(e.networkError,r);super(t),this.name="CombinedError",this.message=t,this.graphQLErrors=r,this.networkError=e.networkError,this.response=e.response}toString(){return this.message}}var phash=(e,r)=>{for(var t=0|(r||5381),a=0,n=0|e.length;a<n;a++)t=(t<<5)+t+e.charCodeAt(a);return t},seen=new Set,cache=new WeakMap,stringify=(e,r)=>{if(null===e||seen.has(e))return"null";if("object"!=typeof e)return JSON.stringify(e)||"";if(e.toJSON)return stringify(e.toJSON(),r);if(Array.isArray(e)){for(var t="[",a=0,n=e.length;a<n;a++)t.length>1&&(t+=","),t+=stringify(e[a],r)||"null";return t+="]"}if(!r&&(FileConstructor!==NoopConstructor&&e instanceof FileConstructor||BlobConstructor!==NoopConstructor&&e instanceof BlobConstructor))return"null";var o=Object.keys(e).sort();if(!o.length&&e.constructor&&Object.getPrototypeOf(e).constructor!==Object.prototype.constructor){var s=cache.get(e)||Math.random().toString(36).slice(2);return cache.set(e,s),stringify({__key:s},r)}seen.add(e);for(var i="{",c=0,p=o.length;c<p;c++){var l=stringify(e[o[c]],r);l&&(i.length>1&&(i+=","),i+=stringify(o[c],r)+":"+l)}return seen.delete(e),i+="}"},extract=(e,r,t)=>{if(null==t||"object"!=typeof t||t.toJSON||seen.has(t));else if(Array.isArray(t))for(var a=0,n=t.length;a<n;a++)extract(e,`${r}.${a}`,t[a]);else if(t instanceof FileConstructor||t instanceof BlobConstructor)e.set(r,t);else for(var o in seen.add(t),t)extract(e,`${r}.${o}`,t[o])},stringifyVariables=(e,r)=>(seen.clear(),stringify(e,r||!1));class NoopConstructor{}var FileConstructor="undefined"!=typeof File?File:NoopConstructor,BlobConstructor="undefined"!=typeof Blob?Blob:NoopConstructor,extractFiles=e=>{var r=new Map;return FileConstructor===NoopConstructor&&BlobConstructor===NoopConstructor||(seen.clear(),extract(r,"variables",e)),r},SOURCE_NAME="gql",GRAPHQL_STRING_RE=/("{3}[\s\S]*"{3}|"(?:\\.|[^"])*")/g,REPLACE_CHAR_RE=/(?:#[^\n\r]+)?(?:[\r\n]+|$)/g,replaceOutsideStrings=(e,r)=>r%2==0?e.replace(REPLACE_CHAR_RE,"\n"):e,sanitizeDocument=e=>e.split(GRAPHQL_STRING_RE).map(replaceOutsideStrings).join("").trim(),prints=new Map,docs=new Map,stringifyDocument=e=>{var r;return"string"==typeof e?r=sanitizeDocument(e):e.loc&&docs.get(e.__key)===e?r=e.loc.source.body:(r=prints.get(e)||sanitizeDocument(graphql_web.print(e)),prints.set(e,r)),"string"==typeof e||e.loc||(e.loc={start:0,end:r.length,source:{body:r,name:SOURCE_NAME,locationOffset:{line:1,column:1}}}),r},hashDocument=e=>{var r;if(e.documentId)r=phash(e.documentId);else if(r=phash(stringifyDocument(e)),e.definitions){var t=getOperationName(e);t&&(r=phash(`\n# ${t}`,r))}return r},keyDocument=e=>{var r,t;return"string"==typeof e?(r=hashDocument(e),t=docs.get(r)||graphql_web.parse(e,{noLocation:!0})):(r=e.__key||hashDocument(e),t=docs.get(r)||e),t.loc||stringifyDocument(t),t.__key=r,docs.set(r,t),t},createRequest=(e,r,t)=>{var a=r||{},n=keyDocument(e),o=stringifyVariables(a,!0),s=n.__key;return"{}"!==o&&(s=phash(o,s)),{key:s,query:n,variables:a,extensions:t}},getOperationName=e=>{for(var r=0,t=e.definitions.length;r<t;r++){var a=e.definitions[r];if(a.kind===graphql_web.Kind.OPERATION_DEFINITION)return a.name?a.name.value:void 0}},getOperationType=e=>{for(var r=0,t=e.definitions.length;r<t;r++){var a=e.definitions[r];if(a.kind===graphql_web.Kind.OPERATION_DEFINITION)return a.operation}},makeResult=(e,r,t)=>{if(!("data"in r||"errors"in r&&Array.isArray(r.errors)))throw new Error("No Content");var a="subscription"===e.kind;return{operation:e,data:r.data,error:Array.isArray(r.errors)?new CombinedError({graphQLErrors:r.errors,response:t}):void 0,extensions:r.extensions?{...r.extensions}:void 0,hasNext:null==r.hasNext?a:r.hasNext,stale:!1}},deepMerge=(e,r)=>{if("object"==typeof e&&null!=e){if(Array.isArray(e)){e=[...e];for(var t=0,a=r.length;t<a;t++)e[t]=deepMerge(e[t],r[t]);return e}if(!e.constructor||e.constructor===Object){for(var n in e={...e},r)e[n]=deepMerge(e[n],r[n]);return e}}return r},mergeResultPatch=(e,r,t,a)=>{var n=e.error?e.error.graphQLErrors:[],o=!!e.extensions||!!(r.payload||r).extensions,s={...e.extensions,...(r.payload||r).extensions},i=r.incremental;"path"in r&&(i=[r]);var c={data:e.data};if(i)for(var p=function(){var e=i[l];Array.isArray(e.errors)&&n.push(...e.errors),e.extensions&&(Object.assign(s,e.extensions),o=!0);var r="data",t=c,p=[];if(e.path)p=e.path;else if(a){var d=a.find(r=>r.id===e.id);p=e.subPath?[...d.path,...e.subPath]:d.path}for(var u=0,f=p.length;u<f;r=p[u++])t=t[r]=Array.isArray(t[r])?[...t[r]]:{...t[r]};if(e.items)for(var h=+r>=0?r:0,y=0,m=e.items.length;y<m;y++)t[h+y]=deepMerge(t[h+y],e.items[y]);else void 0!==e.data&&(t[r]=deepMerge(t[r],e.data))},l=0,d=i.length;l<d;l++)p();else c.data=(r.payload||r).data||e.data,n=r.errors||r.payload&&r.payload.errors||n;return{operation:e.operation,data:c.data,error:n.length?new CombinedError({graphQLErrors:n,response:t}):void 0,extensions:o?s:void 0,hasNext:null!=r.hasNext?r.hasNext:e.hasNext,stale:!1}},makeErrorResult=(e,r,t)=>({operation:e,data:void 0,error:new CombinedError({networkError:r,response:t}),extensions:void 0,hasNext:!1,stale:!1});function makeFetchBody(e){var r={query:void 0,documentId:void 0,operationName:getOperationName(e.query),variables:e.variables||void 0,extensions:e.extensions};return!("documentId"in e.query)||!e.query.documentId||e.query.definitions&&e.query.definitions.length?e.extensions&&e.extensions.persistedQuery&&!e.extensions.persistedQuery.miss||(r.query=stringifyDocument(e.query)):r.documentId=e.query.documentId,r}var makeFetchURL=(e,r)=>{var t="query"===e.kind&&e.context.preferGetMethod;if(!t||!r)return e.context.url;var a=splitOutSearchParams(e.context.url);for(var n in r){var o=r[n];o&&a[1].set(n,"object"==typeof o?stringifyVariables(o):o)}var s=a.join("?");return s.length>2047&&"force"!==t?(e.context.preferGetMethod=!1,e.context.url):s},splitOutSearchParams=e=>{var r=e.indexOf("?");return r>-1?[e.slice(0,r),new URLSearchParams(e.slice(r+1))]:[e,new URLSearchParams]},serializeBody=(e,r)=>{var t="query"===e.kind&&!!e.context.preferGetMethod;if(r&&!t){var a=stringifyVariables(r),n=extractFiles(r.variables);if(n.size){var o=new FormData;o.append("operations",a),o.append("map",stringifyVariables({...[...n.keys()].map(e=>[e])}));var s=0;for(var i of n.values())o.append(""+s++,i);return o}return a}},isHeaders=e=>"has"in e&&!Object.keys(e).length,makeFetchOptions=(e,r)=>{var t={accept:"subscription"===e.kind?"text/event-stream, multipart/mixed":"application/graphql-response+json, application/graphql+json, application/json, text/event-stream, multipart/mixed"},a=("function"==typeof e.context.fetchOptions?e.context.fetchOptions():e.context.fetchOptions)||{};if(a.headers)if(isHeaders(a.headers))a.headers.forEach((e,r)=>{t[r]=e});else if(Array.isArray(a.headers))a.headers.forEach((e,r)=>{Array.isArray(e)?t[e[0]]?t[e[0]]=`${t[e[0]]},${e[1]}`:t[e[0]]=e[1]:t[r]=e});else for(var n in a.headers)t[n.toLowerCase()]=a.headers[n];var o=serializeBody(e,r);return"string"!=typeof o||t["content-type"]||(t["content-type"]="application/json"),{...a,method:o?"POST":"GET",body:o,headers:t}},boundaryHeaderRe=/boundary="?([^=";]+)"?/i,eventStreamRe=/data: ?([^\n]+)/;async function*streamBody(e){if(e.body[Symbol.asyncIterator])for await(var r of e.body)yield r;else{var t,a=e.body.getReader();try{for(;!(t=await a.read()).done;)yield t.value}finally{a.cancel()}}}async function*streamToBoundedChunks(e,r){var t,a="undefined"!=typeof TextDecoder?new TextDecoder:null,n="";for await(var o of e)for(n+="Buffer"===o.constructor.name?o.toString():a.decode(o,{stream:!0});(t=n.indexOf(r))>-1;)yield n.slice(0,t),n=n.slice(t+r.length)}async function*parseJSON(e){yield JSON.parse(await e.text())}async function*parseEventStream(e){var r;for await(var t of streamToBoundedChunks(streamBody(e),"\n\n")){var a=t.match(eventStreamRe);if(a){var n=a[1];try{yield r=JSON.parse(n)}catch(e){if(!r)throw e}if(r&&!1===r.hasNext)break}}r&&!1!==r.hasNext&&(yield{hasNext:!1})}async function*parseMultipartMixed(e,r){var t,a=e.match(boundaryHeaderRe),n="--"+(a?a[1]:"-"),o=!0;for await(var s of streamToBoundedChunks(streamBody(r),"\r\n"+n)){if(o){o=!1;var i=s.indexOf(n);if(!(i>-1))continue;s=s.slice(i+n.length)}try{yield t=JSON.parse(s.slice(s.indexOf("\r\n\r\n")+4))}catch(e){if(!t)throw e}if(t&&!1===t.hasNext)break}t&&!1!==t.hasNext&&(yield{hasNext:!1})}async function*parseMaybeJSON(e){var r=await e.text();try{var t=JSON.parse(r);"production"!==process.env.NODE_ENV&&console.warn('Found response with content-type "text/plain" but it had a valid "application/json" response.'),yield t}catch(e){throw new Error(r)}}async function*fetchOperation(e,r,t){var a,n=!0,o=null;try{yield await Promise.resolve();var s,i=(a=await(e.context.fetch||fetch)(r,t)).headers.get("Content-Type")||"";for await(var c of/multipart\/mixed/i.test(i)?parseMultipartMixed(i,a):/text\/event-stream/i.test(i)?parseEventStream(a):/text\//i.test(i)?parseMaybeJSON(a):parseJSON(a))c.pending&&!o?s=c.pending:c.pending&&(s=[...s,...c.pending]),o=o?mergeResultPatch(o,c,a,s):makeResult(e,c,a),n=!1,yield o,n=!0;o||(yield o=makeResult(e,{},a))}catch(r){if(!n)throw r;yield makeErrorResult(e,a&&(a.status<200||a.status>=300)&&a.statusText?new Error(a.statusText):r,a)}}function makeFetchSource(e,r,t){var a;return"undefined"!=typeof AbortController&&(t.signal=(a=new AbortController).signal),wonka.onEnd(()=>{a&&a.abort()})(wonka.filter(e=>!!e)(wonka.fromAsyncIterable(fetchOperation(e,r,t))))}exports.CombinedError=CombinedError,exports.createRequest=createRequest,exports.getOperationName=getOperationName,exports.getOperationType=getOperationType,exports.keyDocument=keyDocument,exports.makeErrorResult=makeErrorResult,exports.makeFetchBody=makeFetchBody,exports.makeFetchOptions=makeFetchOptions,exports.makeFetchSource=makeFetchSource,exports.makeFetchURL=makeFetchURL,exports.makeResult=makeResult,exports.mergeResultPatch=mergeResultPatch,exports.stringifyDocument=stringifyDocument,exports.stringifyVariables=stringifyVariables;