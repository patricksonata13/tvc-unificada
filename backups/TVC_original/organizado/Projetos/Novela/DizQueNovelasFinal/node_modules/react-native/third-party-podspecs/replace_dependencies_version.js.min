"use strict";const{spawnSync:spawnSync}=require("child_process"),fs=require("fs"),yargs=require("yargs"),LAST_BUILD_FILENAME="ReactNativeDependencies/.last_build_configuration";function validateBuildConfiguration(e){if(!["Debug","Release"].includes(e))throw new Error(`Invalid configuration ${e}`)}function validateVersion(e){if(null==e||""===e)throw new Error("Version cannot be empty")}function shouldReplaceRnDepsConfiguration(e){const o=fs.existsSync(LAST_BUILD_FILENAME);if(o){console.log(`Found ${LAST_BUILD_FILENAME} file`);if(fs.readFileSync(LAST_BUILD_FILENAME).toString()===e)return console.log("Same config of the previous build. No need to replace RNDeps"),!1}return!(!o&&"Debug"===e)||(console.log("No previous build detected, but Debug Configuration. No need to replace RNDeps"),!1)}function replaceRNDepsConfiguration(e,o,n){const i=`${n}/ReactNativeDependencies-artifacts/reactnative-dependencies-${o.toLowerCase()}-${e.toLowerCase()}.tar.gz`,t="ReactNativeDependencies/framework";console.log("Preparing the final location",t),fs.rmSync(t,{force:!0,recursive:!0}),fs.mkdirSync(t,{recursive:!0}),console.log("Extracting the tarball",i),spawnSync("tar",["-xf",i,"-C",t],{stdio:"inherit"}),console.log("Resolving ReactNativeDependencies.xcframework folder structure");const a=`${t}/packages/react-native/third-party`,r=`${a}/ReactNativeDependencies.xcframework`,s=`${t}/packages/react-native/ReactNativeDependencies.xcframework`;if(!fs.existsSync(r))throw new Error(`Expected ReactNativeDependencies.xcframework to be at ${r}, but it was not found.`);fs.renameSync(r,s),fs.existsSync(a)&&fs.rmSync(a,{force:!0,recursive:!0})}function updateLastBuildConfiguration(e){console.log(`Updating ${LAST_BUILD_FILENAME} with ${e}`),fs.writeFileSync(LAST_BUILD_FILENAME,e)}function main(e,o,n){validateBuildConfiguration(e),validateVersion(o),shouldReplaceRnDepsConfiguration(e)&&(replaceRNDepsConfiguration(e,o,n),updateLastBuildConfiguration(e),console.log("Done replacing React Native Dependencies"))}const argv=yargs.option("c",{alias:"configuration",description:'Configuration to use to download the right React Native Dependencies version. Allowed values are "Debug" and "Release".'}).option("r",{alias:"reactNativeVersion",description:"The Version of React Native associated with the React Native Dependencies tarball."}).option("p",{alias:"podsRoot",description:"The path to the Pods root folder"}).usage("Usage: $0 -c Debug -r <version> -p <path/to/react-native>").argv,configuration=argv.configuration,version=argv.reactNativeVersion,podsRoot=argv.podsRoot;main(configuration,version,podsRoot);