"use strict";const{spawnSync:spawnSync}=require("child_process"),fs=require("fs"),yargs=require("yargs"),LAST_BUILD_FILENAME="React-Core-prebuilt/.last_build_configuration";function validateBuildConfiguration(e){if(!["Debug","Release"].includes(e))throw new Error(`Invalid configuration ${e}`)}function validateVersion(e){if(null==e||""===e)throw new Error("Version cannot be empty")}function shouldReplaceRnCoreConfiguration(e){const o=fs.existsSync(LAST_BUILD_FILENAME);if(o){console.log(`Found ${LAST_BUILD_FILENAME} file`);if(fs.readFileSync(LAST_BUILD_FILENAME).toString()===e)return console.log("Same config of the previous build. No need to replace React-Core-prebuilt"),!1}return!(!o&&"Debug"===e)||(console.log("No previous build detected, but Debug Configuration. No need to replace React-Core-prebuilt"),!1)}function replaceRNCoreConfiguration(e,o,i){const t=`${i}/ReactNativeCore-artifacts/reactnative-core-${o.toLowerCase()}-${e.toLowerCase()}.tar.gz`,r="React-Core-prebuilt";console.log("Preparing the final location",r),fs.rmSync(r,{force:!0,recursive:!0}),fs.mkdirSync(r,{recursive:!0}),console.log("Extracting the tarball",t),spawnSync("tar",["-xf",t,"-C",r],{stdio:"inherit"})}function updateLastBuildConfiguration(e){console.log(`Updating ${LAST_BUILD_FILENAME} with ${e}`),fs.writeFileSync(LAST_BUILD_FILENAME,e)}function main(e,o,i){validateBuildConfiguration(e),validateVersion(o),shouldReplaceRnCoreConfiguration(e)&&(replaceRNCoreConfiguration(e,o,i),updateLastBuildConfiguration(e),console.log("Done replacing React Native prebuilt"))}const argv=yargs.option("c",{alias:"configuration",description:'Configuration to use to download the right React-Core prebuilt version. Allowed values are "Debug" and "Release".'}).option("r",{alias:"reactNativeVersion",description:"The Version of React Native associated with the React-Core prebuilt tarball."}).option("p",{alias:"podsRoot",description:"The path to the Pods root folder"}).usage("Usage: $0 -c Debug -r <version> -p <path/to/react-native>").argv,configuration=argv.configuration,version=argv.reactNativeVersion,podsRoot=argv.podsRoot;main(configuration,version,podsRoot);