"use strict";const{REACT_NATIVE_PACKAGE_ROOT_FOLDER:REACT_NATIVE_PACKAGE_ROOT_FOLDER,TEMPLATES_FOLDER_PATH:TEMPLATES_FOLDER_PATH,packageJson:packageJson}=require("./constants"),{codegenLog:codegenLog}=require("./utils"),{execSync:execSync}=require("child_process"),fs=require("fs"),path=require("path"),REACT_CODEGEN_PODSPEC_TEMPLATE_PATH=path.join(TEMPLATES_FOLDER_PATH,"ReactCodegen.podspec.template");function generateReactCodegenPodspec(e,n,t,_){const T=getInputFiles(e,n),o=codegenScripts(e,_),c=fs.readFileSync(REACT_CODEGEN_PODSPEC_TEMPLATE_PATH,"utf8").replace(/{react-native-version}/,packageJson.version).replace(/{input-files}/,T).replace(/{codegen-script}/,o),s=path.join(t,"ReactCodegen.podspec");fs.writeFileSync(s,c),codegenLog(`Generated podspec: ${s}`)}function getInputFiles(e,n){const t=n.codegenConfig?.jsSrcsDir;if(!t)return"[]";const _=String(execSync(`find ${e} -type d -name "*.xcodeproj"`)).trim().split("\n").filter(e=>!e.includes("/Pods/")&&!e.includes("/node_modules/"))[0],T=`find ${path.join(e,t)} -type f -not -path "*/__mocks__/*" -and \\( -name "Native*.js" -or -name "*NativeComponent.js" -or -name "Native*.ts" -or -name "*NativeComponent.ts" \\)`;return`[${String(execSync(T)).trim().split("\n").sort().map(e=>`"\${PODS_ROOT}/${path.relative(_,e)}"`).join(",\n")}]`}function codegenScripts(e,n){const t=path.relative(n,e);return`<<-SCRIPT\npushd "$PODS_ROOT/../" > /dev/null\nRCT_SCRIPT_POD_INSTALLATION_ROOT=$(pwd)\npopd >/dev/null\n\nexport RCT_SCRIPT_RN_DIR="$RCT_SCRIPT_POD_INSTALLATION_ROOT/${path.relative(n,REACT_NATIVE_PACKAGE_ROOT_FOLDER)}"\nexport RCT_SCRIPT_APP_PATH="$RCT_SCRIPT_POD_INSTALLATION_ROOT/${0===t.length?".":t}"\nexport RCT_SCRIPT_OUTPUT_DIR="$RCT_SCRIPT_POD_INSTALLATION_ROOT"\nexport RCT_SCRIPT_TYPE="withCodegenDiscovery"\n\nexport SCRIPT_PHASES_SCRIPT="$RCT_SCRIPT_RN_DIR/scripts/react_native_pods_utils/script_phases.sh"\nexport WITH_ENVIRONMENT="$RCT_SCRIPT_RN_DIR/scripts/xcode/with-environment.sh"\n/bin/sh -c '"$WITH_ENVIRONMENT" "$SCRIPT_PHASES_SCRIPT"'\nSCRIPT`}module.exports={generateReactCodegenPodspec:generateReactCodegenPodspec};