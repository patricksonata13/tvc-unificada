#!/usr/bin/env node
"use strict";const{name:name,version:currentVersion}=require("./package.json"),{spawn:spawn}=require("child_process"),{get:get}=require("https"),semver=require("semver"),{URL:URL}=require("url"),{styleText:styleText}=require("util"),deprecated=()=>{throw new Error("react-native/cli is deprecated, please use @react-native-community/cli instead")};function findCommunityCli(e=process.cwd()){const t={paths:[e]},n=require.resolve("@react-native-community/cli",t);return require(n)}function isMissingCliDependency(e){return"MODULE_NOT_FOUND"===e.code&&/@react-native-community\/cli/.test(e.message)}let cli={bin:"/dev/null",loadConfig:deprecated,run:deprecated};const isNpxRuntime="npx"===process.env.npm_lifecycle_event,isInitCommand="init"===process.argv[2],DEFAULT_REGISTRY_HOST=process.env.npm_config_registry??"https://registry.npmjs.org/",HEAD="1000.0.0",CLI_DEPRECATION_DATE=new Date("2024-12-31");function getLatestVersion(e=DEFAULT_REGISTRY_HOST){return new Promise((t,n)=>{const i=new URL(e);i.pathname="react-native/latest",get(i.toString(),e=>{const i=[];e.on("data",e=>i.push(e)),e.on("end",()=>{try{t(JSON.parse(Buffer.concat(i).toString("utf8")).version)}catch(e){n(e)}})}).on("error",e=>n(e))})}function warnWhenRunningInit(){isInitCommand&&console.warn(`\nRunning: ${styleText(["grey","bold"],"npx @react-native-community/cli init")}\n`)}function warnWithDeprecationSchedule(){if(!isInitCommand)return;const e=Math.ceil((CLI_DEPRECATION_DATE.getTime()-(new Date).getTime())/864e5);var t;console.warn(`\n${styleText("yellow","âš ï¸")} The \`init\` command is deprecated.\nThe behavior will be changed on ${styleText(["white","bold"],CLI_DEPRECATION_DATE.toLocaleDateString())} ${t=`(${e} day${e>1?"s":""})`,styleText(e<10?["bgRed","white","bold"]:e<30?["red","bold"]:e<60?["green","bold"]:["blueBright","bold"],t)}.\n\n- Switch to ${styleText(["grey","bold"],"npx @react-native-community/cli init")} for the identical behavior.\n- Refer to the documentation for information about alternative tools: ${styleText("dim","https://reactnative.dev/docs/getting-started")}`)}function warnWithDeprecated(){isInitCommand&&console.warn(`\nðŸš¨ï¸ The \`init\` command is deprecated.\n\n- Switch to ${styleText(["grey","bold"],"npx @react-native-community/cli init")} for the identical behavior.\n- Refer to the documentation for information about alternative tools: ${styleText("dim","https://reactnative.dev/docs/getting-started")}`)}function warnWithExplicitDependency(e="*"){console.warn(`\n${styleText("yellow","âš ")}ï¸ ${styleText(["dim"],"react-native")} depends on ${styleText("dim","@react-native-community/cli")} for cli commands. To fix update your ${styleText(["dim"],"package.json")} to include:\n\n${styleText(["white","bold"],'\n  "devDependencies": {\n    "@react-native-community/cli": "latest",\n  }\n')}\n\n`)}async function main(){if(isNpxRuntime&&!Boolean(process.env.SKIP)&&currentVersion!==HEAD&&isInitCommand)try{const e=await getLatestVersion();if(semver.lt(currentVersion,e)){const t=`\n  ${styleText(["bold","yellow"],"WARNING:")} You should run ${styleText(["white","bold"],"npx react-native@latest")} to ensure you're always using the most current version of the CLI. NPX has cached version (${styleText(["bold","yellow"],currentVersion)}) != current release (${styleText(["bold","green"],e)})\n  `;console.warn(t)}}catch(e){}const e=CLI_DEPRECATION_DATE.getTime()<=(new Date).getTime()||currentVersion.startsWith("0.77");if(isInitCommand){currentVersion!==HEAD&&e?(warnWithDeprecated(),console.warn(`${styleText("green","Exiting...")}`),process.exit(1)):(currentVersion.startsWith("0.75")||currentVersion.startsWith("0.76"))&&warnWithDeprecationSchedule(),warnWhenRunningInit();const t=spawn("npx",["@react-native-community/cli",...process.argv.slice(2)],{stdio:"inherit"}),n=await new Promise(e=>{t.on("exit",e)});process.exit(n)}try{return findCommunityCli().run(name)}catch(e){throw isMissingCliDependency(e)&&(warnWithExplicitDependency(),process.exit(1)),e}}if(require.main===module)main();else try{cli=findCommunityCli()}catch(e){if(!isMissingCliDependency(e))throw e}module.exports=cli;