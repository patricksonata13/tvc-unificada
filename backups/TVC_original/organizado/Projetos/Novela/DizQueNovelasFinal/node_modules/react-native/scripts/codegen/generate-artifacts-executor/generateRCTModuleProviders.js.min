"use strict";const{TEMPLATES_FOLDER_PATH:TEMPLATES_FOLDER_PATH}=require("./constants"),{codegenLog:codegenLog,isReactNativeCoreLibrary:isReactNativeCoreLibrary,parseiOSAnnotations:parseiOSAnnotations}=require("./utils"),fs=require("fs"),path=require("path"),MODULE_PROVIDERS_H_TEMPLATE_PATH=path.join(TEMPLATES_FOLDER_PATH,"RCTModuleProvidersH.template"),MODULE_PROVIDERS_MM_TEMPLATE_PATH=path.join(TEMPLATES_FOLDER_PATH,"RCTModuleProvidersMM.template");function generateRCTModuleProviders(e,o,r,a){fs.mkdirSync(a,{recursive:!0}),codegenLog("Generating RCTModulesProvider.h");const t=fs.readFileSync(MODULE_PROVIDERS_H_TEMPLATE_PATH,"utf8"),i=path.join(a,"RCTModuleProviders.h");fs.writeFileSync(i,t),codegenLog(`Generated artifact: ${i}`),codegenLog("Generating RCTModuleProviders.mm");let n={},s=o.codegenConfig?{config:o.codegenConfig,libraryPath:e}:null;const c=r.concat(s).filter(Boolean).filter(({config:e,libraryPath:o})=>!isReactNativeCoreLibrary(e.name)&&"components"!==e.type);c.forEach(({config:e,libraryPath:o})=>{const r=JSON.parse(fs.readFileSync(path.join(o,"package.json"),"utf8")).name;e.ios?.modulesProvider&&(n[r]=Object.keys(e.ios?.modulesProvider).map(o=>({moduleName:o,className:e.ios?.modulesProvider[o]})))});const d=parseiOSAnnotations(c);for(const[e,{modules:o}]of Object.entries(d))for(const[r,a]of Object.entries(o))a.className&&(n[e]=n[e]||[],n[e].push({moduleName:r,className:a.className}));const l=Object.keys(n).flatMap(e=>n[e].map(({moduleName:o,className:r})=>`\t\t@"${o}": @"${r}", // ${e}`)).join("\n"),P=fs.readFileSync(MODULE_PROVIDERS_MM_TEMPLATE_PATH,"utf8").replace(/{moduleMapping}/,l),T=path.join(a,"RCTModuleProviders.mm");fs.writeFileSync(T,P),codegenLog(`Generated artifact: ${T}`)}module.exports={generateRCTModuleProviders:generateRCTModuleProviders};