"use strict";const{generateAppDependencyProvider:generateAppDependencyProvider}=require("./generateAppDependencyProvider"),{generateCustomURLHandlers:generateCustomURLHandlers}=require("./generateCustomURLHandlers"),{generateNativeCode:generateNativeCode}=require("./generateNativeCode"),{generateRCTModuleProviders:generateRCTModuleProviders}=require("./generateRCTModuleProviders"),{generateRCTThirdPartyComponents:generateRCTThirdPartyComponents}=require("./generateRCTThirdPartyComponents"),{generateReactCodegenPodspec:generateReactCodegenPodspec}=require("./generateReactCodegenPodspec"),{generateSchemaInfos:generateSchemaInfos}=require("./generateSchemaInfos"),{generateUnstableModulesRequiringMainQueueSetupProvider:generateUnstableModulesRequiringMainQueueSetupProvider}=require("./generateUnstableModulesRequiringMainQueueSetupProvider"),{buildCodegenIfNeeded:buildCodegenIfNeeded,cleanupEmptyFilesAndFolders:cleanupEmptyFilesAndFolders,codegenLog:codegenLog,findCodegenEnabledLibraries:findCodegenEnabledLibraries,findDisabledLibrariesByPlatform:findDisabledLibrariesByPlatform,pkgJsonIncludesGeneratedCode:pkgJsonIncludesGeneratedCode,readPkgJsonInDirectory:readPkgJsonInDirectory,readReactNativeConfig:readReactNativeConfig}=require("./utils"),path=require("path");function execute(e,n,r,t,o=!0){try{codegenLog(`Analyzing ${path.join(e,"package.json")}`);const a=["android","ios"];if("all"!==n&&!a.includes(n))throw new Error(`Invalid target platform: ${n}. Supported values are: ${a.join(", ")}, all`);const d=readPkgJsonInDirectory(e);o&&buildCodegenIfNeeded();const i=readReactNativeConfig(e,r),u=findCodegenEnabledLibraries(d,e,r,i);0===u.length&&codegenLog("No codegen-enabled libraries found.",!0);let s="all"===n?a:[n];for(const n of s){const a=findDisabledLibrariesByPlatform(i,n),s=u.filter(({name:e})=>!a.includes(e)),l=computeOutputPath(e,r,d,n);if(o){const r=generateSchemaInfos(s);generateNativeCode(l,r.filter(n=>mustGenerateNativeCode(e,n)),pkgJsonIncludesGeneratedCode(d),n)}"app"===t&&"android"!==n&&(generateRCTThirdPartyComponents(s,l),generateRCTModuleProviders(e,d,s,l),generateCustomURLHandlers(s,l),generateUnstableModulesRequiringMainQueueSetupProvider(s,l),generateAppDependencyProvider(l),generateReactCodegenPodspec(e,d,l,r)),cleanupEmptyFilesAndFolders(l)}}catch(e){codegenLog(e),process.exitCode=1}codegenLog("Done.",!0)}function readOutputDirFromPkgJson(e,n){const r=e.codegenConfig;if(null==r||"object"!=typeof r)return null;const t=r.outputDir;return null==t?null:"string"==typeof t?t:"object"==typeof t?t[n]:null}function computeOutputPath(e,n,r,t){if(null==n){const o=readOutputDirFromPkgJson(r,t);n=null!=o?path.join(e,o):e}return pkgJsonIncludesGeneratedCode(r)?n:"android"===t?defaultOutputPathForAndroid(n):"ios"===t?defaultOutputPathForIOS(n):n}function defaultOutputPathForAndroid(e){return path.join(e,"android","app","build","generated","source","codegen")}function defaultOutputPathForIOS(e){return path.join(e,"build","generated","ios")}function mustGenerateNativeCode(e,n){return n.library.libraryPath===e||!n.library.config.includesGeneratedCode}module.exports={execute:execute};