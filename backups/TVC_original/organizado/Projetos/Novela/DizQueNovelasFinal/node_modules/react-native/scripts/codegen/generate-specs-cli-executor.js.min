"use strict";const utils=require("./codegen-utils"),fs=require("fs"),path=require("path"),GENERATORS={all:{android:["componentsAndroid","modulesAndroid","modulesCxx"],ios:["componentsIOS","modulesIOS","modulesCxx"]},components:{android:["componentsAndroid"],ios:["componentsIOS"]},modules:{android:["modulesAndroid","modulesCxx"],ios:["modulesIOS","modulesCxx"]}};function createOutputDirectoryIfNeeded(e,r){e||(e=path.resolve(__dirname,"..","Libraries",r)),fs.mkdirSync(e,{recursive:!0})}function readAndParseSchema(e){const r=fs.readFileSync(e,"utf-8");if(null==r)throw new Error(`Can't find schema at ${e}`);try{return JSON.parse(r)}catch(r){throw new Error(`Can't parse schema to JSON. ${e}`)}}function validateLibraryType(e){if(null==GENERATORS[e])throw new Error(`Invalid library type. ${e}`)}function generateSpecFromInMemorySchema(e,r,n,o,t,a,s){if(validateLibraryType(a),createOutputDirectoryIfNeeded(n,o),utils.getCodegen().generate({libraryName:o,schema:r,outputDirectory:n,packageName:t,assumeNonnull:"ios"===e,useLocalIncludePaths:s},{generators:GENERATORS[a][e]}),"android"===e){const e=fs.readdirSync(n),r=`${n}/jni/react/renderer/components/${o}`;fs.mkdirSync(r,{recursive:!0}),e.filter(e=>e.endsWith(".h")||e.endsWith(".cpp")).forEach(e=>{fs.renameSync(`${n}/${e}`,`${r}/${e}`)})}}function generateSpec(e,r,n,o,t,a){generateSpecFromInMemorySchema(e,readAndParseSchema(r),n,o,t,a)}module.exports={execute:generateSpec,generateSpecFromInMemorySchema:generateSpecFromInMemorySchema};