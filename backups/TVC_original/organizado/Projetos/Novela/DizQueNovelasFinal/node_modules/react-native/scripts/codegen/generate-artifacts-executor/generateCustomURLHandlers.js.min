"use strict";const{TEMPLATES_FOLDER_PATH:TEMPLATES_FOLDER_PATH}=require("./constants"),{parseiOSAnnotations:parseiOSAnnotations}=require("./utils"),fs=require("fs"),path=require("path"),MODULES_PROTOCOLS_H_TEMPLATE_PATH=path.join(TEMPLATES_FOLDER_PATH,"RCTModulesConformingToProtocolsProviderH.template"),MODULES_PROTOCOLS_MM_TEMPLATE_PATH=path.join(TEMPLATES_FOLDER_PATH,"RCTModulesConformingToProtocolsProviderMM.template");function generateCustomURLHandlers(e,o){const r=parseiOSAnnotations(e),a=new Set,n=new Set,s=new Set,t=e=>Array.isArray(e)||null==e?e:[e];for(const o of e){const e=o?.config?.ios?.modulesConformingToProtocol;null!=e&&(t(e.RCTImageURLLoader)?.forEach(e=>{a.add(e)}),t(e.RCTImageDataDecoder)?.forEach(e=>{n.add(e)}),t(e.RCTURLRequestHandler)?.forEach(e=>{s.add(e)}))}for(const{modules:e}of Object.values(r))for(const[o,r]of Object.entries(e)){const e=r.conformsToProtocols;e&&(e.includes("RCTImageURLLoader")&&a.add(o),e.includes("RCTImageDataDecoder")&&n.add(o),e.includes("RCTURLRequestHandler")&&s.add(o))}const i=Array.from(a).map(e=>`@"${e}"`).join(",\n\t\t"),T=Array.from(n).map(e=>`@"${e}"`).join(",\n\t\t"),d=Array.from(s).map(e=>`@"${e}"`).join(",\n\t\t"),c=fs.readFileSync(MODULES_PROTOCOLS_MM_TEMPLATE_PATH,"utf8").replace(/{imageURLLoaderClassNames}/,i).replace(/{imageDataDecoderClassNames}/,T).replace(/{requestHandlersClassNames}/,d);fs.mkdirSync(o,{recursive:!0}),fs.writeFileSync(path.join(o,"RCTModulesConformingToProtocolsProvider.mm"),c);const l=fs.readFileSync(MODULES_PROTOCOLS_H_TEMPLATE_PATH,"utf8");fs.writeFileSync(path.join(o,"RCTModulesConformingToProtocolsProvider.h"),l)}module.exports={generateCustomURLHandlers:generateCustomURLHandlers};