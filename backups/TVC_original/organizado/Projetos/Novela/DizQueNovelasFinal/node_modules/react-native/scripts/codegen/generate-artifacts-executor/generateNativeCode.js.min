"use strict";const generateSpecsCLIExecutor=require("../generate-specs-cli-executor"),{CORE_LIBRARIES_WITH_OUTPUT_FOLDER:CORE_LIBRARIES_WITH_OUTPUT_FOLDER}=require("./constants"),{codegenLog:codegenLog}=require("./utils"),fs=require("fs"),os=require("os"),path=require("path");function generateNativeCode(e,t,r,n){return t.map(t=>{generateCode(e,t,r,n)})}function generateCode(e,t,r,n){if(shouldSkipGenerationForFBReactNativeSpec(t,n))return void codegenLog("[Codegen - FBReactNativeSpec] Skipping iOS code generation for FBReactNativeSpec as it has been generated already.",!0);const o=t.library.config.name,a=fs.mkdtempSync(path.join(os.tmpdir(),o)),c=path.join(a,"out");fs.mkdirSync(c,{recursive:!0}),codegenLog(`Generating Native Code for ${o} - ${n}`);const i=r;generateSpecsCLIExecutor.generateSpecFromInMemorySchema(n,t.schema,c,o,"com.facebook.fbreact.specs",t.library.config.type,i);const s=reactNativeCoreLibraryOutputPath(o,n)??e;fs.mkdirSync(s,{recursive:!0}),fs.cpSync(c,s,{recursive:!0}),codegenLog(`Generated artifacts: ${s}`)}function reactNativeCoreLibraryOutputPath(e,t){return CORE_LIBRARIES_WITH_OUTPUT_FOLDER[e]?CORE_LIBRARIES_WITH_OUTPUT_FOLDER[e][t]:null}function shouldSkipGenerationForFBReactNativeSpec(e,t){if("ios"!==t||"FBReactNativeSpec"!==e.library.config.name)return!1;const r=CORE_LIBRARIES_WITH_OUTPUT_FOLDER.FBReactNativeSpec.ios,n=path.resolve(r);return n.includes("node_modules")&&fs.existsSync(n)&&fs.readdirSync(n).length>0}module.exports={generateNativeCode:generateNativeCode,generateCode:generateCode};