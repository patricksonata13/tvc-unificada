"use strict";var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var ANSI_COLORS=[[{color:"0, 0, 0",class:"ansi-black"},{color:"187, 0, 0",class:"ansi-red"},{color:"0, 187, 0",class:"ansi-green"},{color:"187, 187, 0",class:"ansi-yellow"},{color:"0, 0, 187",class:"ansi-blue"},{color:"187, 0, 187",class:"ansi-magenta"},{color:"0, 187, 187",class:"ansi-cyan"},{color:"255,255,255",class:"ansi-white"}],[{color:"85, 85, 85",class:"ansi-bright-black"},{color:"255, 85, 85",class:"ansi-bright-red"},{color:"0, 255, 0",class:"ansi-bright-green"},{color:"255, 255, 85",class:"ansi-bright-yellow"},{color:"85, 85, 255",class:"ansi-bright-blue"},{color:"255, 85, 255",class:"ansi-bright-magenta"},{color:"85, 255, 255",class:"ansi-bright-cyan"},{color:"255, 255, 255",class:"ansi-bright-white"}]],Anser=function(){function e(){_classCallCheck(this,e),this.fg=this.bg=this.fg_truecolor=this.bg_truecolor=null,this.bright=0}return _createClass(e,null,[{key:"escapeForHtml",value:function(r){return(new e).escapeForHtml(r)}},{key:"linkify",value:function(r){return(new e).linkify(r)}},{key:"ansiToHtml",value:function(r,n){return(new e).ansiToHtml(r,n)}},{key:"ansiToJson",value:function(r,n){return(new e).ansiToJson(r,n)}},{key:"ansiToText",value:function(r){return(new e).ansiToText(r)}}]),_createClass(e,[{key:"setupPalette",value:function(){this.PALETTE_COLORS=[];for(var e=0;e<2;++e)for(var r=0;r<8;++r)this.PALETTE_COLORS.push(ANSI_COLORS[e][r].color);for(var n=[0,95,135,175,215,255],t=function(e,r,t){return n[e]+", "+n[r]+", "+n[t]},o=0;o<6;++o)for(var s=0;s<6;++s)for(var i=0;i<6;++i)this.PALETTE_COLORS.push(t(o,s,i));for(var l=8,a=0;a<24;++a,l+=10)this.PALETTE_COLORS.push(t(l,l,l))}},{key:"escapeForHtml",value:function(e){return e.replace(/[&<>]/gm,function(e){return"&"==e?"&amp;":"<"==e?"&lt;":">"==e?"&gt;":""})}},{key:"linkify",value:function(e){return e.replace(/(https?:\/\/[^\s]+)/gm,function(e){return'<a href="'+e+'">'+e+"</a>"})}},{key:"ansiToHtml",value:function(e,r){return this.process(e,r,!0)}},{key:"ansiToJson",value:function(e,r){return(r=r||{}).json=!0,r.clearLine=!1,this.process(e,r,!0)}},{key:"ansiToText",value:function(e){return this.process(e,{},!1)}},{key:"process",value:function(e,r,n){var t=this,o=e.split(/\033\[/),s=o.shift();null==r&&(r={}),r.clearLine=/\r/.test(e);var i=o.map(function(e){return t.processChunk(e,r,n)});if(r&&r.json){var l=this.processChunkJson("");return l.content=s,l.clearLine=r.clearLine,i.unshift(l),r.remove_empty&&(i=i.filter(function(e){return!e.isEmpty()})),i}return i.unshift(s),i.join("")}},{key:"processChunkJson",value:function(e,r,n){var t=(r=void 0===r?{}:r).use_classes=void 0!==r.use_classes&&r.use_classes,o=r.key=t?"class":"color",s={content:e,fg:null,bg:null,fg_truecolor:null,bg_truecolor:null,clearLine:r.clearLine,decoration:null,was_processed:!1,isEmpty:function(){return!s.content}},i=e.match(/^([!\x3c-\x3f]*)([\d;]*)([\x20-\x2c]*[\x40-\x7e])([\s\S]*)/m);if(!i)return s;s.content=i[4];var l=i[2].split(";");if(""!==i[1]||"m"!==i[3])return s;if(!n)return s;var a=this;for(a.decoration=null;l.length>0;){var c=l.shift(),u=parseInt(c);if(isNaN(u)||0===u)a.fg=a.bg=a.decoration=null;else if(1===u)a.decoration="bold";else if(2===u)a.decoration="dim";else if(3==u)a.decoration="italic";else if(4==u)a.decoration="underline";else if(5==u)a.decoration="blink";else if(7===u)a.decoration="reverse";else if(8===u)a.decoration="hidden";else if(9===u)a.decoration="strikethrough";else if(39==u)a.fg=null;else if(49==u)a.bg=null;else if(u>=30&&u<38)a.fg=ANSI_COLORS[0][u%10][o];else if(u>=90&&u<98)a.fg=ANSI_COLORS[1][u%10][o];else if(u>=40&&u<48)a.bg=ANSI_COLORS[0][u%10][o];else if(u>=100&&u<108)a.bg=ANSI_COLORS[1][u%10][o];else if(38===u||48===u){var f=38===u;if(l.length>=1){var h=l.shift();if("5"===h&&l.length>=1){var g=parseInt(l.shift());if(g>=0&&g<=255)if(t){var p=g>=16?"ansi-palette-"+g:ANSI_COLORS[g>7?1:0][g%8].class;f?a.fg=p:a.bg=p}else this.PALETTE_COLORS||a.setupPalette(),f?a.fg=this.PALETTE_COLORS[g]:a.bg=this.PALETTE_COLORS[g]}else if("2"===h&&l.length>=3){var b=parseInt(l.shift()),d=parseInt(l.shift()),v=parseInt(l.shift());if(b>=0&&b<=255&&d>=0&&d<=255&&v>=0&&v<=255){var _=b+", "+d+", "+v;t?f?(a.fg="ansi-truecolor",a.fg_truecolor=_):(a.bg="ansi-truecolor",a.bg_truecolor=_):f?a.fg=_:a.bg=_}}}}}if(null===a.fg&&null===a.bg&&null===a.decoration)return s;return s.fg=a.fg,s.bg=a.bg,s.fg_truecolor=a.fg_truecolor,s.bg_truecolor=a.bg_truecolor,s.decoration=a.decoration,s.was_processed=!0,s}},{key:"processChunk",value:function(e,r,n){var t=this;r=r||{};var o=this.processChunkJson(e,r,n);if(r.json)return o;if(o.isEmpty())return"";if(!o.was_processed)return o.content;var s=r.use_classes,i=[],l=[],a={},c=function(e){var r=[],n=void 0;for(n in e)e.hasOwnProperty(n)&&r.push("data-"+n+'="'+t.escapeForHtml(e[n])+'"');return r.length>0?" "+r.join(" "):""};return o.fg&&(s?(l.push(o.fg+"-fg"),null!==o.fg_truecolor&&(a["ansi-truecolor-fg"]=o.fg_truecolor,o.fg_truecolor=null)):i.push("color:rgb("+o.fg+")")),o.bg&&(s?(l.push(o.bg+"-bg"),null!==o.bg_truecolor&&(a["ansi-truecolor-bg"]=o.bg_truecolor,o.bg_truecolor=null)):i.push("background-color:rgb("+o.bg+")")),o.decoration&&(s?l.push("ansi-"+o.decoration):"bold"===o.decoration?i.push("font-weight:bold"):"dim"===o.decoration?i.push("opacity:0.5"):"italic"===o.decoration?i.push("font-style:italic"):"reverse"===o.decoration?i.push("filter:invert(100%)"):"hidden"===o.decoration?i.push("visibility:hidden"):"strikethrough"===o.decoration?i.push("text-decoration:line-through"):i.push("text-decoration:"+o.decoration)),s?'<span class="'+l.join(" ")+'"'+c(a)+">"+o.content+"</span>":'<span style="'+i.join(";")+'"'+c(a)+">"+o.content+"</span>"}}]),e}();module.exports=Anser;