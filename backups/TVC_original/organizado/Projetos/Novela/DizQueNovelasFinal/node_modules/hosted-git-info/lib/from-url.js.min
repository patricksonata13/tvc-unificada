"use strict";const parseUrl=require("./parse-url"),isGitHubShorthand=e=>{const t=e.indexOf("#"),o=e.indexOf("/"),n=e.indexOf("/",o+1),s=e.indexOf(":"),r=/\s/.exec(e),c=e.indexOf("@"),i=!r||t>-1&&r.index>t,l=-1===c||t>-1&&c>t,a=-1===s||t>-1&&s>t,d=-1===n||t>-1&&n>t,u=o>0,h=t>-1?"/"!==e[t-1]:!e.endsWith("/"),p=!e.startsWith(".");return i&&u&&h&&p&&l&&a&&d};module.exports=(e,t,{gitHosts:o,protocols:n})=>{if(!e)return;const s=isGitHubShorthand(e)?`github:${e}`:e,r=parseUrl(s,n);if(!r)return;const c=o.byShortcut[r.protocol],i=o.byDomain[r.hostname.startsWith("www.")?r.hostname.slice(4):r.hostname],l=c||i;if(!l)return;const a=o[c||i];let d=null;n[r.protocol]?.auth&&(r.username||r.password)&&(d=`${r.username}${r.password?":"+r.password:""}`);let u=null,h=null,p=null,m=null;try{if(c){let e=r.pathname.startsWith("/")?r.pathname.slice(1):r.pathname;const t=e.indexOf("@");t>-1&&(e=e.slice(t+1));const o=e.lastIndexOf("/");o>-1?(h=decodeURIComponent(e.slice(0,o)),h||(h=null),p=decodeURIComponent(e.slice(o+1))):p=decodeURIComponent(e),p.endsWith(".git")&&(p=p.slice(0,-4)),r.hash&&(u=decodeURIComponent(r.hash.slice(1))),m="shortcut"}else{if(!a.protocols.includes(r.protocol))return;const e=a.extract(r);if(!e)return;h=e.user&&decodeURIComponent(e.user),p=decodeURIComponent(e.project),u=decodeURIComponent(e.committish),m=n[r.protocol]?.name||r.protocol.slice(0,-1)}}catch(e){if(e instanceof URIError)return;throw e}return[l,h,d,p,u,m,t]};