const url=require("url"),lastIndexOfBefore=(e,r,t)=>{const c=e.indexOf(t);return e.lastIndexOf(r,c>-1?c:1/0)},safeUrl=e=>{try{return new url.URL(e)}catch{}},correctProtocol=(e,r)=>{const t=e.indexOf(":"),c=e.slice(0,t+1);if(Object.prototype.hasOwnProperty.call(r,c))return e;const n=e.indexOf("@");if(n>-1)return n>t?`git+ssh://${e}`:e;return e.indexOf("//")===t+1?e:`${e.slice(0,t+1)}//${e.slice(t+1)}`},correctUrl=e=>{const r=lastIndexOfBefore(e,"@","#"),t=lastIndexOfBefore(e,":","#");return t>r&&(e=e.slice(0,t)+"/"+e.slice(t+1)),-1===lastIndexOfBefore(e,":","#")&&-1===e.indexOf("//")&&(e=`git+ssh://${e}`),e};module.exports=(e,r)=>{const t=r?correctProtocol(e,r):e;return safeUrl(t)||safeUrl(correctUrl(t))};