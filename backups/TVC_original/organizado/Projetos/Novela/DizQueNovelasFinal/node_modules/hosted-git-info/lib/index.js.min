"use strict";const{LRUCache:LRUCache}=require("lru-cache"),hosts=require("./hosts.js"),fromUrl=require("./from-url.js"),parseUrl=require("./parse-url.js"),cache=new LRUCache({max:1e3});class GitHost{constructor(t,s,i,e,r,h,l={}){Object.assign(this,GitHost.#t[t],{type:t,user:s,auth:i,project:e,committish:r,default:h,opts:l})}static#t={byShortcut:{},byDomain:{}};static#s={"git+ssh:":{name:"sshurl"},"ssh:":{name:"sshurl"},"git+https:":{name:"https",auth:!0},"git:":{auth:!0},"http:":{auth:!0},"https:":{auth:!0},"git+http:":{auth:!0}};static addHost(t,s){GitHost.#t[t]=s,GitHost.#t.byDomain[s.domain]=t,GitHost.#t.byShortcut[`${t}:`]=t,GitHost.#s[`${t}:`]={name:t}}static fromUrl(t,s){if("string"!=typeof t)return;const i=t+JSON.stringify(s||{});if(!cache.has(i)){const e=fromUrl(t,s,{gitHosts:GitHost.#t,protocols:GitHost.#s});cache.set(i,e?new GitHost(...e):void 0)}return cache.get(i)}static parseUrl(t){return parseUrl(t)}#i(t,s){if("function"!=typeof t)return null;const i={...this,...this.opts,...s};i.path||(i.path=""),i.path.startsWith("/")&&(i.path=i.path.slice(1)),i.noCommittish&&(i.committish=null);const e=t(i);return i.noGitPlus&&e.startsWith("git+")?e.slice(4):e}hash(){return this.committish?`#${this.committish}`:""}ssh(t){return this.#i(this.sshtemplate,t)}sshurl(t){return this.#i(this.sshurltemplate,t)}browse(t,...s){return"string"!=typeof t?this.#i(this.browsetemplate,t):"string"!=typeof s[0]?this.#i(this.browsetreetemplate,{...s[0],path:t}):this.#i(this.browsetreetemplate,{...s[1],fragment:s[0],path:t})}browseFile(t,...s){return"string"!=typeof s[0]?this.#i(this.browseblobtemplate,{...s[0],path:t}):this.#i(this.browseblobtemplate,{...s[1],fragment:s[0],path:t})}docs(t){return this.#i(this.docstemplate,t)}bugs(t){return this.#i(this.bugstemplate,t)}https(t){return this.#i(this.httpstemplate,t)}git(t){return this.#i(this.gittemplate,t)}shortcut(t){return this.#i(this.shortcuttemplate,t)}path(t){return this.#i(this.pathtemplate,t)}tarball(t){return this.#i(this.tarballtemplate,{...t,noCommittish:!1})}file(t,s){return this.#i(this.filetemplate,{...s,path:t})}edit(t,s){return this.#i(this.edittemplate,{...s,path:t})}getDefaultRepresentation(){return this.default}toString(t){return this.default&&"function"==typeof this[this.default]?this[this.default](t):this.sshurl(t)}}for(const[t,s]of Object.entries(hosts))GitHost.addHost(t,s);module.exports=GitHost;