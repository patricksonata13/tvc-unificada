"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.discoverExpoModuleConfigAsync=exports.ExpoModuleConfig=exports.ExpoAndroidProjectConfig=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),utils_1=require("./utils");function arrayize(e){return Array.isArray(e)?e:null!=e?[e]:[]}class ExpoAndroidProjectConfig{name;path;modules;publication;gradleAarProjects;shouldUsePublicationScriptPath;isDefault;constructor(e,r,o,t,i,a,n=!1){this.name=e,this.path=r,this.modules=o,this.publication=t,this.gradleAarProjects=i,this.shouldUsePublicationScriptPath=a,this.isDefault=n}}exports.ExpoAndroidProjectConfig=ExpoAndroidProjectConfig;class ExpoModuleConfig{rawConfig;constructor(e){this.rawConfig=e}supportsPlatform(e){const r=this.rawConfig.platforms??[];if("web"===e)return!0;if("apple"===e)return r.some(e=>["apple","ios","macos","tvos"].includes(e));switch(e){case"ios":case"macos":case"tvos":return r.includes(e)||r.includes("apple");default:return r.includes(e)}}getAppleConfig(){return this.rawConfig.apple??this.rawConfig.ios??null}appleModules(){const e=this.getAppleConfig();return e?.modules??[]}appleAppDelegateSubscribers(){return this.getAppleConfig()?.appDelegateSubscribers??[]}appleReactDelegateHandlers(){return this.getAppleConfig()?.reactDelegateHandlers??[]}applePodspecPaths(){return arrayize(this.getAppleConfig()?.podspecPath)}appleSwiftModuleNames(){return arrayize(this.getAppleConfig()?.swiftModuleName)}appleDebugOnly(){return this.getAppleConfig()?.debugOnly??!1}androidProjects(e){const r=[];return r.push(new ExpoAndroidProjectConfig(this.rawConfig.android?.name??e,this.rawConfig.android?.path??"android",this.rawConfig.android?.modules,this.rawConfig.android?.publication,this.rawConfig.android?.gradleAarProjects,this.rawConfig.android?.shouldUsePublicationScriptPath,!this.rawConfig.android?.path)),this.rawConfig.android?.projects?.forEach(e=>{r.push(new ExpoAndroidProjectConfig(e.name,e.path,e.modules,e.publication,e.gradleAarProjects,e.shouldUsePublicationScriptPath))}),r}androidGradlePlugins(){return arrayize(this.rawConfig.android?.gradlePlugins??[])}androidGradleAarProjects(){return arrayize(this.rawConfig.android?.gradleAarProjects??[])}androidPublication(){return this.rawConfig.android?.publication}coreFeatures(){return arrayize(this.rawConfig.coreFeatures??[])}toJSON(){return this.rawConfig}}exports.ExpoModuleConfig=ExpoModuleConfig;const EXPO_MODULE_CONFIG_FILENAMES=["expo-module.config.json","unimodule.json"];exports.discoverExpoModuleConfigAsync=(0,utils_1.memoize)(async function(e){for(let r=0;r<EXPO_MODULE_CONFIG_FILENAMES.length;r++){const o=path_1.default.join(e,EXPO_MODULE_CONFIG_FILENAMES[r]);let t;try{t=await fs_1.default.promises.readFile(o,"utf8")}catch{continue}return new ExpoModuleConfig(JSON.parse(t))}return null});