"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.fileExistsAsync=void 0,exports.memoize=memoize,exports.listFilesSorted=listFilesSorted,exports.listFilesInDirectories=listFilesInDirectories,exports.scanFilesRecursively=scanFilesRecursively;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),MAX_SIZE=5e3;function memoize(e){const t=new Map;return async(s,...i)=>{if(t.has(s))return t.get(s);{const a=await e(s,...i);return t.size>MAX_SIZE&&t.clear(),t.set(s,a),a}}}async function listFilesSorted(e,t){try{return(await fs_1.default.promises.readdir(e,{withFileTypes:!0})).filter(e=>e.isFile()&&t(e.name)).sort((e,t)=>e.name.localeCompare(t.name)).map(t=>path_1.default.join(e,t.name))}catch{return[]}}async function listFilesInDirectories(e,t){return(await Promise.all((await fs_1.default.promises.readdir(e,{withFileTypes:!0})).filter(e=>e.isDirectory()&&"node_modules"!==e.name).sort((e,t)=>e.name.localeCompare(t.name)).map(async s=>(await fs_1.default.promises.readdir(path_1.default.join(e,s.name),{withFileTypes:!0})).filter(e=>e.isFile()&&t(e.name)).sort((e,t)=>e.name.localeCompare(t.name)).map(e=>path_1.default.join(s.name,e.name))))).flat(1)}async function*scanFilesRecursively(e,t,s=!fs_1.default.opendir){const i=[e];let a;for(;i.length>0&&null!=(a=i.shift());)try{const e=s?(await fs_1.default.promises.readdir(a,{withFileTypes:!0})).sort((e,t)=>e.name.localeCompare(t.name)):await fs_1.default.promises.opendir(a);for await(const s of e)s.isDirectory()&&"node_modules"!==s.name?t&&!t(a,s.name)||i.push(path_1.default.join(a,s.name)):s.isFile()&&(yield{path:path_1.default.join(a,s.name),parentPath:a,name:s.name})}catch{continue}}const fileExistsAsync=async e=>{const t=await fs_1.default.promises.stat(e).catch(()=>null);return t?.isFile()?e:null};exports.fileExistsAsync=fileExistsAsync;