"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _FileStore=_interopRequireDefault(require("./FileStore")),_fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class AutoCleanFileStore extends _FileStore.default{#e;#t;#r;constructor(e){super({root:e.root}),this.#r=e.root,this.#e=e.intervalMs??6e5,this.#t=e.cleanupThresholdMs??2592e5,this.#s()}#s(){setTimeout(()=>this.#l(),this.#e)}#l(){const e=_fs.default.readdirSync(this.#r,{recursive:!0,withFileTypes:!0});let t=!1;const r=Date.now()-this.#t;e.filter(e=>e.isFile()).forEach(e=>{const s=_path.default.join(e.parentPath,e.name.toString());try{_fs.default.statSync(s).mtimeMs<r&&_fs.default.unlinkSync(s)}catch(e){t||(console.warn("Problem cleaning up cache for "+s+": "+e.message),t=!0)}}),this.#s()}}exports.default=AutoCleanFileStore;