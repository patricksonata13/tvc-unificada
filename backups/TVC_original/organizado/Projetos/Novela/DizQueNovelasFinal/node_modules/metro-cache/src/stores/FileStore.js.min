"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}const NULL_BYTE=0,NULL_BYTE_BUFFER=Buffer.from([0]);class FileStore{#t;constructor(t){this.#t=t.root}async get(t){try{const e=await _fs.default.promises.readFile(this.#e(t));return 0===e[0]?e.slice(1):JSON.parse(e.toString("utf8"))}catch(t){if("ENOENT"===t.code||t instanceof SyntaxError)return null;throw t}}async set(t,e){const r=this.#e(t);try{await this.#r(r,e)}catch(t){if("ENOENT"!==t.code)throw t;_fs.default.mkdirSync(_path.default.dirname(r),{recursive:!0}),await this.#r(r,e)}}async#r(t,e){let r;r=e instanceof Buffer?Buffer.concat([NULL_BYTE_BUFFER,e]):JSON.stringify(e)??JSON.stringify(null),await _fs.default.promises.writeFile(t,r)}clear(){this.#i()}#e(t){return _path.default.join(this.#t,t.slice(0,1).toString("hex"),t.slice(1).toString("hex"))}#i(){for(let t=0;t<256;t++)_fs.default.rmSync(_path.default.join(this.#t,("0"+t.toString(16)).slice(-2)),{force:!0,recursive:!0})}}exports.default=FileStore;