import fs from"node:fs";import path from"node:path";const lchownSync=(n,o,c)=>{try{return fs.lchownSync(n,o,c)}catch(n){if("ENOENT"!==n?.code)throw n}},chown=(n,o,c,r)=>{fs.lchown(n,o,c,n=>{r(n&&"ENOENT"!==n?.code?n:null)})},chownrKid=(n,o,c,r,e)=>{if(o.isDirectory())chownr(path.resolve(n,o.name),c,r,t=>{if(t)return e(t);const h=path.resolve(n,o.name);chown(h,c,r,e)});else{const t=path.resolve(n,o.name);chown(t,c,r,e)}};export const chownr=(n,o,c,r)=>{fs.readdir(n,{withFileTypes:!0},(e,t)=>{if(e){if("ENOENT"===e.code)return r();if("ENOTDIR"!==e.code&&"ENOTSUP"!==e.code)return r(e)}if(e||!t.length)return chown(n,o,c,r);let h=t.length,i=null;const s=e=>{if(!i)return e?r(i=e):0===--h?chown(n,o,c,r):void 0};for(const r of t)chownrKid(n,r,o,c,s)})};const chownrKidSync=(n,o,c,r)=>{o.isDirectory()&&chownrSync(path.resolve(n,o.name),c,r),lchownSync(path.resolve(n,o.name),c,r)};export const chownrSync=(n,o,c)=>{let r;try{r=fs.readdirSync(n,{withFileTypes:!0})}catch(r){const e=r;if("ENOENT"===e?.code)return;if("ENOTDIR"===e?.code||"ENOTSUP"===e?.code)return lchownSync(n,o,c);throw e}for(const e of r)chownrKidSync(n,e,o,c);return lchownSync(n,o,c)};