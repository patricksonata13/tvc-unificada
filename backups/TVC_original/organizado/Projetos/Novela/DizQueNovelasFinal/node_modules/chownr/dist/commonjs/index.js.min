"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.chownrSync=exports.chownr=void 0;const node_fs_1=__importDefault(require("node:fs")),node_path_1=__importDefault(require("node:path")),lchownSync=(e,o,n)=>{try{return node_fs_1.default.lchownSync(e,o,n)}catch(e){if("ENOENT"!==e?.code)throw e}},chown=(e,o,n,r)=>{node_fs_1.default.lchown(e,o,n,e=>{r(e&&"ENOENT"!==e?.code?e:null)})},chownrKid=(e,o,n,r,t)=>{if(o.isDirectory())(0,exports.chownr)(node_path_1.default.resolve(e,o.name),n,r,c=>{if(c)return t(c);const d=node_path_1.default.resolve(e,o.name);chown(d,n,r,t)});else{const c=node_path_1.default.resolve(e,o.name);chown(c,n,r,t)}},chownr=(e,o,n,r)=>{node_fs_1.default.readdir(e,{withFileTypes:!0},(t,c)=>{if(t){if("ENOENT"===t.code)return r();if("ENOTDIR"!==t.code&&"ENOTSUP"!==t.code)return r(t)}if(t||!c.length)return chown(e,o,n,r);let d=c.length,h=null;const l=t=>{if(!h)return t?r(h=t):0===--d?chown(e,o,n,r):void 0};for(const r of c)chownrKid(e,r,o,n,l)})};exports.chownr=chownr;const chownrKidSync=(e,o,n,r)=>{o.isDirectory()&&(0,exports.chownrSync)(node_path_1.default.resolve(e,o.name),n,r),lchownSync(node_path_1.default.resolve(e,o.name),n,r)},chownrSync=(e,o,n)=>{let r;try{r=node_fs_1.default.readdirSync(e,{withFileTypes:!0})}catch(r){const t=r;if("ENOENT"===t?.code)return;if("ENOTDIR"===t?.code||"ENOTSUP"===t?.code)return lchownSync(e,o,n);throw t}for(const t of r)chownrKidSync(e,t,o,n);return lchownSync(e,o,n)};exports.chownrSync=chownrSync;