import{INPUT_START,INPUT_MOVE,INPUT_END,INPUT_CANCEL,INPUT_TYPE_TOUCH}from"../inputjs/input-consts";import Input from"../inputjs/input-constructor";import toArray from"../utils/to-array";import hasParent from"../utils/has-parent";import uniqueArray from"../utils/unique-array";const TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL},TOUCH_TARGET_EVENTS="touchstart touchmove touchend touchcancel";export default class TouchInput extends Input{constructor(){TouchInput.prototype.evTarget=TOUCH_TARGET_EVENTS,super(...arguments),this.targetIds={}}handler(t){let e=TOUCH_INPUT_MAP[t.type],r=getTouches.call(this,t,e);r&&this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:t})}}function getTouches(t,e){let r,o,T=toArray(t.touches),{targetIds:n}=this;if(e&(INPUT_START|INPUT_MOVE)&&1===T.length)return n[T[0].identifier]=!0,[T,T];let i=toArray(t.changedTouches),u=[],{target:a}=this;if(o=T.filter(t=>hasParent(t.target,a)),e===INPUT_START)for(r=0;r<o.length;)n[o[r].identifier]=!0,r++;for(r=0;r<i.length;)n[i[r].identifier]&&u.push(i[r]),e&(INPUT_END|INPUT_CANCEL)&&delete n[i[r].identifier],r++;return u.length?[uniqueArray(o.concat(u),"identifier",!0),u]:void 0}