import Recognizer from"../recognizerjs/recognizer-constructor";import{TOUCH_ACTION_MANIPULATION}from"../touchactionjs/touchaction-Consts";import{INPUT_START,INPUT_END}from"../inputjs/input-consts";import{STATE_RECOGNIZED,STATE_BEGAN,STATE_FAILED}from"../recognizerjs/recognizer-consts";import getDistance from"../inputjs/get-distance";export default class TapRecognizer extends Recognizer{constructor(t={}){super({event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[TOUCH_ACTION_MANIPULATION]}process(t){let{options:e}=this,i=t.pointers.length===e.pointers,s=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&INPUT_START&&0===this.count)return this.failTimeout();if(s&&r&&i){if(t.eventType!==INPUT_END)return this.failTimeout();let i=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||getDistance(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&i?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=STATE_RECOGNIZED,this.tryEmit()},e.interval),STATE_BEGAN):STATE_RECOGNIZED}return STATE_FAILED}failTimeout(){return this._timer=setTimeout(()=>{this.state=STATE_FAILED},this.options.interval),STATE_FAILED}reset(){clearTimeout(this._timer)}emit(){this.state===STATE_RECOGNIZED&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}