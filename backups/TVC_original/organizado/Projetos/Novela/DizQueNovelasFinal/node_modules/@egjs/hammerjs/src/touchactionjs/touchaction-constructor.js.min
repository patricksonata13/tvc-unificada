import{TOUCH_ACTION_COMPUTE,TOUCH_ACTION_MAP,TOUCH_ACTION_NONE,TOUCH_ACTION_PAN_X,TOUCH_ACTION_PAN_Y}from"./touchaction-Consts";import{NATIVE_TOUCH_ACTION,PREFIXED_TOUCH_ACTION}from"./get-touchaction-props";import{DIRECTION_VERTICAL,DIRECTION_HORIZONTAL}from"../inputjs/input-consts";import each from"../utils/each";import boolOrFn from"../utils/bool-or-fn";import inStr from"../utils/in-str";import cleanTouchActions from"./clean-touch-actions";export default class TouchAction{constructor(t,e){this.manager=t,this.set(e)}set(t){t===TOUCH_ACTION_COMPUTE&&(t=this.compute()),NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[t]&&(this.manager.element.style[PREFIXED_TOUCH_ACTION]=t),this.actions=t.toLowerCase().trim()}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];return each(this.manager.recognizers,e=>{boolOrFn(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),cleanTouchActions(t.join(" "))}preventDefaults(t){let{srcEvent:e}=t,o=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();let{actions:n}=this,i=inStr(n,TOUCH_ACTION_NONE)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_NONE],r=inStr(n,TOUCH_ACTION_PAN_Y)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y],T=inStr(n,TOUCH_ACTION_PAN_X)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];if(i){let e=1===t.pointers.length,o=t.distance<2,n=t.deltaTime<250;if(e&&o&&n)return}return T&&r?void 0:i||r&&o&DIRECTION_HORIZONTAL||T&&o&DIRECTION_VERTICAL?this.preventSrc(e):void 0}preventSrc(t){this.manager.session.prevented=!0,t.preventDefault()}}