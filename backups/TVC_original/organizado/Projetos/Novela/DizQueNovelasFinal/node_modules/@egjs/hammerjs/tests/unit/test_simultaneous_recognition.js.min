var el,hammer;QUnit.module("Simultaenous recognition",{beforeEach:function(){el=utils.createHitArea()},afterEach:function(){hammer&&hammer.destroy()}}),QUnit.test("should pinch and pan simultaneously be recognized when enabled",function(e){var t=e.async();e.expect(4);var n=0,a=0;(hammer=new Hammer.Manager(el,{touchAction:"none"})).add(new Hammer.Pan({threshold:5,pointers:2}));var i=new Hammer.Pinch({threshold:0,pointers:2});hammer.add(i),i.recognizeWith(hammer.get("pan")),hammer.on("panend",function(){n++}),hammer.on("pinchend",function(){a++});var o=function(e){var t,n;n=[{clientX:0,clientY:10,identifier:0,target:el},{clientX:10,clientY:10,identifier:1,target:el}],(t=document.createEvent("Event")).initEvent("touchstart",!0,!0),t.touches=n,t.targetTouches=n,t.changedTouches=n,el.dispatchEvent(t),setTimeout(function(){n=[{clientX:10,clientY:20,identifier:0,target:el},{clientX:20,clientY:20,identifier:1,target:el}],(t=document.createEvent("Event")).initEvent("touchmove",!0,!0),t.touches=n,t.targetTouches=n,t.changedTouches=n,el.dispatchEvent(t)},100),setTimeout(function(){n=[{clientX:20,clientY:30,identifier:0,target:el},{clientX:40,clientY:30,identifier:1,target:el}],(t=document.createEvent("Event")).initEvent("touchmove",!0,!0),t.touches=n,t.targetTouches=n,t.changedTouches=n,el.dispatchEvent(t),(t=document.createEvent("Event")).initEvent("touchend",!0,!0),t.touches=n,t.targetTouches=n,t.changedTouches=n,el.dispatchEvent(t),e()},200)};o(function(){e.equal(n,1,"1 pan event recognized"),e.equal(a,1,"1 pinch event recognized"),i.dropRecognizeWith(hammer.get("pan")),o(function(){e.equal(n,2,"2 pan events recognized"),e.equal(a,1,"One pinch event recognized"),t()})})}),QUnit.test("the first gesture should block the following gestures (Tap & DoubleTap)",function(e){e.expect(4);var t=0,n=0;hammer=new Hammer.Manager(el,{touchAction:"none"});var a=new Hammer.Tap,i=new Hammer.Tap({event:"doubletap",taps:2});hammer.add(a),hammer.add(i),hammer.on("tap",function(){t++}),hammer.on("doubletap",function(){n++}),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),e.equal(t,2,"on a double tap gesture, the tap gesture is recognized twice"),e.equal(n,0,"double tap gesture is not recognized because the prior tap gesture does not recognize it simultaneously"),i.recognizeWith(hammer.get("tap")),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),e.equal(t,4,"4 tap events recognized"),e.equal(n,1,"when the tap gesture is configured to work simultaneously, tap & doubleTap can be recognized simultaneously")}),QUnit.test("when disabled, the first gesture should not block gestures  (Tap & DoubleTap )",function(e){e.expect(4);var t=0,n=0;hammer=new Hammer.Manager(el,{touchAction:"none"});var a=new Hammer.Tap,i=new Hammer.Tap({event:"doubletap",taps:2});hammer.add(a),hammer.add(i),hammer.on("tap",function(){t++}),hammer.on("doubletap",function(){n++}),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),e.equal(t,2,"on a double tap gesture, the tap gesture is recognized twice"),e.equal(n,0,"double tap gesture is not recognized because the prior tap gesture does not recognize it simultaneously"),hammer.get("tap").set({enable:!1}),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),e.equal(t,2,"tap gesture should not be recognized when the recognizer is disabled"),e.equal(n,1,"when the tap gesture is disabled, doubleTap can be recognized")}),QUnit.test("the first gesture should block the following gestures (DoubleTap & Tap)",function(e){e.expect(4);var t=0,n=0;hammer=new Hammer.Manager(el,{touchAction:"none"});var a=new Hammer.Tap,i=new Hammer.Tap({event:"doubletap",taps:2});hammer.add(i),hammer.add(a),hammer.on("tap",function(){t++}),hammer.on("doubletap",function(){n++}),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),e.equal(n,1,"double tap is recognized"),e.equal(t,1,"tap is detected, the doubletap is only catched by the doubletap recognizer"),i.recognizeWith(hammer.get("tap")),n=0,t=0,utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),utils.dispatchTouchEvent(el,"start",0,10),utils.dispatchTouchEvent(el,"end",0,10),e.equal(n,1,"1 double tap recognized"),e.equal(t,2,"when the tap gesture is configured to work simultaneously, tap & doubleTap can be recognized simultaneously")});