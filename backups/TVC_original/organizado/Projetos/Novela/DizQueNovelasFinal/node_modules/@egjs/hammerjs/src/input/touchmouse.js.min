import Input from"../inputjs/input-constructor";import TouchInput from"./touch";import MouseInput from"./mouse";import{INPUT_START,INPUT_END,INPUT_CANCEL,INPUT_TYPE_TOUCH,INPUT_TYPE_MOUSE}from"../inputjs/input-consts";const DEDUP_TIMEOUT=2500,DEDUP_DISTANCE=25;function setLastTouch(t){const{changedPointers:[s]}=t;if(s.identifier===this.primaryTouch){const t={x:s.clientX,y:s.clientY},e=this.lastTouches;this.lastTouches.push(t);setTimeout(function(){const s=e.indexOf(t);s>-1&&e.splice(s,1)},2500)}}function recordTouches(t,s){t&INPUT_START?(this.primaryTouch=s.changedPointers[0].identifier,setLastTouch.call(this,s)):t&(INPUT_END|INPUT_CANCEL)&&setLastTouch.call(this,s)}function isSyntheticEvent(t){const s=t.srcEvent.clientX,e=t.srcEvent.clientY;for(let t=0;t<this.lastTouches.length;t++){const i=this.lastTouches[t],o=Math.abs(s-i.x),n=Math.abs(e-i.y);if(o<=25&&n<=25)return!0}return!1}export default class TouchMouseInput extends Input{constructor(t,s){super(t,s),this.touch=new TouchInput(this.manager,this.handler),this.mouse=new MouseInput(this.manager,this.handler),this.primaryTouch=null,this.lastTouches=[]}handler=(t,s,e)=>{const i=e.pointerType===INPUT_TYPE_TOUCH,o=e.pointerType===INPUT_TYPE_MOUSE;if(!(o&&e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents)){if(i)recordTouches.call(this,s,e);else if(o&&isSyntheticEvent.call(this,e))return;this.callback(t,s,e)}};destroy(){this.touch.destroy(),this.mouse.destroy()}}