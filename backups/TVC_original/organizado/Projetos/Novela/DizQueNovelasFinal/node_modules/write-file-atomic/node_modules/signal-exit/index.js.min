var process=global.process;const processOk=function(e){return e&&"object"==typeof e&&"function"==typeof e.removeListener&&"function"==typeof e.emit&&"function"==typeof e.reallyExit&&"function"==typeof e.listeners&&"function"==typeof e.kill&&"number"==typeof e.pid&&"function"==typeof e.on};if(processOk(process)){var emitter,assert=require("assert"),signals=require("./signals.js"),isWin=/^win/i.test(process.platform),EE=require("events");"function"!=typeof EE&&(EE=EE.EventEmitter),process.__signal_exit_emitter__?emitter=process.__signal_exit_emitter__:((emitter=process.__signal_exit_emitter__=new EE).count=0,emitter.emitted={}),emitter.infinite||(emitter.setMaxListeners(1/0),emitter.infinite=!0),module.exports=function(e,t){if(!processOk(global.process))return function(){};assert.equal(typeof e,"function","a callback must be provided for exit handler"),!1===loaded&&load();var s="exit";t&&t.alwaysLast&&(s="afterexit");return emitter.on(s,e),function(){emitter.removeListener(s,e),0===emitter.listeners("exit").length&&0===emitter.listeners("afterexit").length&&unload()}};var unload=function(){loaded&&processOk(global.process)&&(loaded=!1,signals.forEach(function(e){try{process.removeListener(e,sigListeners[e])}catch(e){}}),process.emit=originalProcessEmit,process.reallyExit=originalProcessReallyExit,emitter.count-=1)};module.exports.unload=unload;var emit=function(e,t,s){emitter.emitted[e]||(emitter.emitted[e]=!0,emitter.emit(e,t,s))},sigListeners={};signals.forEach(function(e){sigListeners[e]=function(){processOk(global.process)&&(process.listeners(e).length===emitter.count&&(unload(),emit("exit",null,e),emit("afterexit",null,e),isWin&&"SIGHUP"===e&&(e="SIGINT"),process.kill(process.pid,e)))}}),module.exports.signals=function(){return signals};var loaded=!1,load=function(){!loaded&&processOk(global.process)&&(loaded=!0,emitter.count+=1,signals=signals.filter(function(e){try{return process.on(e,sigListeners[e]),!0}catch(e){return!1}}),process.emit=processEmit,process.reallyExit=processReallyExit)};module.exports.load=load;var originalProcessReallyExit=process.reallyExit,processReallyExit=function(e){processOk(global.process)&&(process.exitCode=e||0,emit("exit",process.exitCode,null),emit("afterexit",process.exitCode,null),originalProcessReallyExit.call(process,process.exitCode))},originalProcessEmit=process.emit,processEmit=function(e,t){if("exit"===e&&processOk(global.process)){void 0!==t&&(process.exitCode=t);var s=originalProcessEmit.apply(this,arguments);return emit("exit",process.exitCode,null),emit("afterexit",process.exitCode,null),s}return originalProcessEmit.apply(this,arguments)}}else module.exports=function(){return function(){}};