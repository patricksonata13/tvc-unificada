var path=require("path"),util=require("util"),DEFAULT_SOURCETREE='"<group>"',DEFAULT_PRODUCT_SOURCETREE="BUILT_PRODUCTS_DIR",DEFAULT_FILEENCODING=4,DEFAULT_GROUP="Resources",DEFAULT_FILETYPE="unknown",FILETYPE_BY_EXTENSION={a:"archive.ar",app:"wrapper.application",appex:"wrapper.app-extension",bundle:"wrapper.plug-in",dylib:"compiled.mach-o.dylib",framework:"wrapper.framework",h:"sourcecode.c.h",m:"sourcecode.c.objc",markdown:"text",mdimporter:"wrapper.cfbundle",octest:"wrapper.cfbundle",pch:"sourcecode.c.h",plist:"text.plist.xml",sh:"text.script.sh",swift:"sourcecode.swift",tbd:"sourcecode.text-based-dylib-definition",xcassets:"folder.assetcatalog",xcconfig:"text.xcconfig",xcdatamodel:"wrapper.xcdatamodel",xcodeproj:"wrapper.pb-project",xctest:"wrapper.cfbundle",xib:"file.xib",strings:"text.plist.strings"},GROUP_BY_FILETYPE={"archive.ar":"Frameworks","compiled.mach-o.dylib":"Frameworks","sourcecode.text-based-dylib-definition":"Frameworks","wrapper.framework":"Frameworks","embedded.framework":"Embed Frameworks","sourcecode.c.h":"Resources","sourcecode.c.objc":"Sources","sourcecode.swift":"Sources"},PATH_BY_FILETYPE={"compiled.mach-o.dylib":"usr/lib/","sourcecode.text-based-dylib-definition":"usr/lib/","wrapper.framework":"System/Library/Frameworks/"},SOURCETREE_BY_FILETYPE={"compiled.mach-o.dylib":"SDKROOT","sourcecode.text-based-dylib-definition":"SDKROOT","wrapper.framework":"SDKROOT"},ENCODING_BY_FILETYPE={"sourcecode.c.h":4,"sourcecode.c.h":4,"sourcecode.c.objc":4,"sourcecode.swift":4,text:4,"text.plist.xml":4,"text.script.sh":4,"text.xcconfig":4,"text.plist.strings":4};function unquoted(e){return null==e?"":e.replace(/(^")|("$)/g,"")}function detectType(e){var t=path.extname(e).substring(1),i=FILETYPE_BY_EXTENSION[unquoted(t)];return i||DEFAULT_FILETYPE}function defaultExtension(e){var t=e.lastKnownFileType&&e.lastKnownFileType!=DEFAULT_FILETYPE?e.lastKnownFileType:e.explicitFileType;for(var i in FILETYPE_BY_EXTENSION)if(FILETYPE_BY_EXTENSION.hasOwnProperty(unquoted(i))&&FILETYPE_BY_EXTENSION[unquoted(i)]===unquoted(t))return i}function defaultEncoding(e){var t=e.lastKnownFileType||e.explicitFileType,i=ENCODING_BY_FILETYPE[unquoted(t)];if(i)return i}function detectGroup(e,t){var i=path.extname(e.basename).substring(1),r=e.lastKnownFileType||e.explicitFileType,s=GROUP_BY_FILETYPE[unquoted(r)];return"xcdatamodeld"===i?"Sources":t.customFramework&&t.embed?GROUP_BY_FILETYPE["embedded.framework"]:s||DEFAULT_GROUP}function detectSourcetree(e){var t=e.lastKnownFileType||e.explicitFileType,i=SOURCETREE_BY_FILETYPE[unquoted(t)];return e.explicitFileType?DEFAULT_PRODUCT_SOURCETREE:e.customFramework?DEFAULT_SOURCETREE:i||DEFAULT_SOURCETREE}function defaultPath(e,t){var i=e.lastKnownFileType||e.explicitFileType,r=PATH_BY_FILETYPE[unquoted(i)];return e.customFramework?t:r?path.join(r,path.basename(t)):t}function defaultGroup(e){return GROUP_BY_FILETYPE[e.lastKnownFileType]?defaultGroup:DEFAULT_GROUP}function pbxFile(e,t){t=t||{};this.basename=path.basename(e),this.lastKnownFileType=t.lastKnownFileType||detectType(e),this.group=detectGroup(this,t),1==t.customFramework&&(this.customFramework=!0,this.dirname=path.dirname(e).replace(/\\/g,"/")),this.path=defaultPath(this,e).replace(/\\/g,"/"),this.fileEncoding=this.defaultEncoding=t.defaultEncoding||defaultEncoding(this),t.explicitFileType&&(this.explicitFileType=t.explicitFileType,this.basename=this.basename+"."+defaultExtension(this),delete this.path,delete this.lastKnownFileType,delete this.group,delete this.defaultEncoding),this.sourceTree=t.sourceTree||detectSourcetree(this),this.includeInIndex=0,t.weak&&!0===t.weak&&(this.settings={ATTRIBUTES:["Weak"]}),t.compilerFlags&&(this.settings||(this.settings={}),this.settings.COMPILER_FLAGS=util.format('"%s"',t.compilerFlags)),t.embed&&t.sign&&(this.settings||(this.settings={}),this.settings.ATTRIBUTES||(this.settings.ATTRIBUTES=[]),this.settings.ATTRIBUTES.push("CodeSignOnCopy"))}module.exports=pbxFile;