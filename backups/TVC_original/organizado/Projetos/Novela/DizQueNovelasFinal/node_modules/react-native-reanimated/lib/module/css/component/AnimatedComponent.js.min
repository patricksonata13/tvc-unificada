"use strict";import{Component}from"react";import{Platform,StyleSheet}from"react-native";import{IS_JEST,ReanimatedError,SHOULD_BE_USE_WEB}from"../../common";import{getViewInfo}from"../../createAnimatedComponent/getViewInfo";import{getShadowNodeWrapperFromRef}from"../../fabricUtils";import{findHostInstance}from"../../platform-specific/findHostInstance";import{markNodeAsRemovable,unmarkNodeAsRemovable}from"../native";import{CSSManager}from"../platform";import{filterNonCSSStyleProps}from"./utils";import{jsx as _jsx}from"react/jsx-runtime";export default class AnimatedComponent extends Component{_cssStyle={};_componentRef=null;_hasAnimatedRef=!1;_componentDOMRef=null;_willUnmount=!1;constructor(e,t){super(t),this.ChildComponent=e}getComponentViewTag(){return this._getViewInfo().viewTag}_onSetLocalRef(){}_getViewInfo(){if(void 0!==this._viewInfo)return this._viewInfo;let e,t,o=null,n=null;if(SHOULD_BE_USE_WEB)e=this._componentRef,n=this._componentDOMRef;else{const n=findHostInstance(this);if(!n)throw new ReanimatedError("Cannot find host instance for this component. Maybe it renders nothing?");const i=getViewInfo(n);e=i.viewTag??-1,t=i.viewName,o=getShadowNodeWrapperFromRef(this,n)}return this._viewInfo={viewTag:e,shadowNodeWrapper:o,viewName:t},n&&(this._viewInfo.DOMElement=n),this._viewInfo}_setComponentRef=e=>{const t=this.props.forwardedRef;"function"==typeof t?t(e):"object"==typeof t&&t&&(t.current=e),e&&(e!==this._componentRef&&(this._componentRef=this._resolveComponentRef(e),this._viewInfo=void 0),this._onSetLocalRef())};_resolveComponentRef=e=>{const t=e;return t&&t.getAnimatableRef?(this._hasAnimatedRef=!0,t.getAnimatableRef()):(SHOULD_BE_USE_WEB&&(t&&t.elementRef?this._componentDOMRef=t.elementRef.current:this._componentDOMRef=e),t)};_updateStyles(e){this._cssStyle=StyleSheet.flatten(e.style)??{}}componentDidMount(){this._updateStyles(this.props);const e=this._viewInfo?.viewTag;!SHOULD_BE_USE_WEB&&this._willUnmount&&"number"==typeof e&&unmarkNodeAsRemovable(e),IS_JEST||(this._CSSManager??=new CSSManager(this._getViewInfo()),this._CSSManager?.update(this._cssStyle)),this._willUnmount=!1}componentWillUnmount(){!IS_JEST&&this._CSSManager&&this._CSSManager.unmountCleanup();const e=this._viewInfo?.shadowNodeWrapper;!SHOULD_BE_USE_WEB&&e&&markNodeAsRemovable(e),this._willUnmount=!0}shouldComponentUpdate(e){return this._updateStyles(e),this._CSSManager&&this._CSSManager.update(this._cssStyle),!0}render(e){const{ChildComponent:t}=this,o=Platform.select({web:{},default:{collapsable:!1}});return _jsx(t,{...e??this.props,...o,style:filterNonCSSStyleProps(e?.style??this.props.style),ref:this._setComponentRef})}}