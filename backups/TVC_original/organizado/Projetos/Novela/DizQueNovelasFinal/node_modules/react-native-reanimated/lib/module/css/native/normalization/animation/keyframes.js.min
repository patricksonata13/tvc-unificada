"use strict";import{ReanimatedError}from"../../../../common";import{PERCENTAGE_REGEX}from"../../../constants";import{isDefined,isNumber}from"../../../utils";import{normalizeTimingFunction}from"../common";export const ERROR_MESSAGES={invalidOffsetType:e=>`Invalid keyframe selector "${e}". Only numbers, percentages, "from", and "to" are supported.`,invalidOffsetRange:e=>`Invalid keyframe selector "${e}". Expected a number between 0 and 1 or a percentage between 0% and 100%.`};function normalizeKeyframeSelector(e){return("string"==typeof e?e.split(",").map(e=>e.trim()):[e]).map(e=>{if("from"===e)return 0;if("to"===e)return 1;let r;if("number"!=typeof e&&isNaN(+e)?PERCENTAGE_REGEX.test(e)&&(r=parseFloat(e)/100):r=+e,!isNumber(r))throw new ReanimatedError(ERROR_MESSAGES.invalidOffsetType(e));if(r<0||r>1)throw new ReanimatedError(ERROR_MESSAGES.invalidOffsetRange(e));return r})}function processKeyframes(e,r){return Object.entries(e).flatMap(([e,{animationTimingFunction:t,...n}={}])=>{const i=r.buildFrom(n);return i?normalizeKeyframeSelector(e).map(e=>({offset:e,style:i,timingFunction:t})):[]}).sort((e,r)=>e.offset-r.offset).reduce((e,r)=>{const t=e[e.length-1];return t&&t.offset===r.offset?(t.style={...t.style,...r.style},t.timingFunction=r.timingFunction):e.push(r),e},[])}function processStyleProperties(e,r,t,n){Object.entries(r).forEach(([r,i])=>{if(isDefined(i)){if("object"==typeof i&&(!Array.isArray(i)||n.isSeparatelyInterpolatedArrayProperty(r)))return t[r]||(t[r]=Array.isArray(i)?[]:{}),void processStyleProperties(e,i,t[r],n);t[r]||(t[r]=[]),t[r].push({offset:e,value:i})}})}export function normalizeAnimationKeyframes(e,r){const t={},n={};return processKeyframes(e,r).forEach(({offset:e,style:i,timingFunction:o})=>{processStyleProperties(e,i,t,r),o&&e<1&&(n[e]=normalizeTimingFunction(o))}),{keyframesStyle:t,keyframeTimingFunctions:n}}