"use strict";import{IS_WINDOW_AVAILABLE,logger,ReanimatedError}from"../../common";import{setElementPosition,snapshots}from"./componentStyle";import{Animations}from"./config";const PREDEFINED_WEB_ANIMATIONS_ID="ReanimatedPredefinedWebAnimationsStyle",CUSTOM_WEB_ANIMATIONS_ID="ReanimatedCustomWebAnimationsStyle",animationNameToIndex=new Map,animationNameList=[];let isObserverSet=!1;export function configureWebLayoutAnimations(){if(!IS_WINDOW_AVAILABLE||null!==document.getElementById(PREDEFINED_WEB_ANIMATIONS_ID))return;const e=document.createElement("style");e.id=PREDEFINED_WEB_ANIMATIONS_ID,e.onload=()=>{if(e.sheet)for(const t in Animations)e.sheet.insertRule(Animations[t].style);else logger.error("Failed to create layout animations stylesheet.")};const t=document.createElement("style");t.id=CUSTOM_WEB_ANIMATIONS_ID,document.head.appendChild(e),document.head.appendChild(t)}export function insertWebAnimation(e,t){if(!IS_WINDOW_AVAILABLE)return;const n=document.getElementById(CUSTOM_WEB_ANIMATIONS_ID);if(n.sheet){n.sheet.insertRule(t,0),animationNameList.unshift(e),animationNameToIndex.set(e,0);for(let e=1;e<animationNameList.length;++e){const t=animationNameList[e],n=animationNameToIndex.get(t);if(void 0===n)throw new ReanimatedError("Failed to obtain animation index.");animationNameToIndex.set(animationNameList[e],n+1)}}else logger.error("Failed to create layout animations stylesheet.")}function removeWebAnimation(e,t){if(!IS_WINDOW_AVAILABLE)return;const n=document.getElementById(CUSTOM_WEB_ANIMATIONS_ID),i=animationNameToIndex.get(e);if(void 0===i)throw new ReanimatedError("Failed to obtain animation index.");t(),n.sheet?.deleteRule(i),animationNameList.splice(i,1),animationNameToIndex.delete(e);for(let e=i;e<animationNameList.length;++e){const t=animationNameList[e],n=animationNameToIndex.get(t);if(void 0===n)throw new ReanimatedError("Failed to obtain animation index.");animationNameToIndex.set(animationNameList[e],n-1)}}const timeoutScale=5,frameDurationMs=16,minimumFrames=10;export function scheduleAnimationCleanup(e,t,n){const i=Math.max(5*t*1e3,t+160);setTimeout(()=>removeWebAnimation(e,n),i)}function reattachElementToAncestor(e,t){const n=snapshots.get(e);if(!n)return void logger.error("Failed to obtain snapshot.");e.removedAfterAnimation=!0,t.appendChild(e),setElementPosition(e,n);const i=e.onanimationend;e.onanimationend=function(n){t.removeChild(e),i?.call(this,n)}}function findDescendantWithExitingAnimation(e,t){if(!(e instanceof HTMLElement))return;e.reanimatedDummy&&void 0===e.removedAfterAnimation&&reattachElementToAncestor(e,t);const n=Array.from(e.children);for(let e=0;e<n.length;++e)findDescendantWithExitingAnimation(n[e],t)}function checkIfScreenWasChanged(e){let t="__reactFiber";for(const n of Object.keys(e))if(n.startsWith("__reactFiber")){t=n;break}return void 0!==e[t]?.child?.memoizedProps?.navigation}export function addHTMLMutationObserver(){if(isObserverSet||!IS_WINDOW_AVAILABLE)return;isObserverSet=!0;new MutationObserver(e=>{const t=e[e.length-1];if(!checkIfScreenWasChanged(t.target))for(let e=0;e<t.removedNodes.length;++e)findDescendantWithExitingAnimation(t.removedNodes[e],t.target)}).observe(document.body,{childList:!0,subtree:!0})}export function areDOMRectsEqual(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}