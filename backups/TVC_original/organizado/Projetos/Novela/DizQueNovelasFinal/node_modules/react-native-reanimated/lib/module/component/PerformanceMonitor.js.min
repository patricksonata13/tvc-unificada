"use strict";import{useEffect,useRef}from"react";import{StyleSheet,TextInput,View}from"react-native";import{createAnimatedComponent}from"../createAnimatedComponent";import{useAnimatedProps,useFrameCallback,useSharedValue}from"../hook";import{jsx as _jsx,jsxs as _jsxs}from"react/jsx-runtime";function createCircularDoublesBuffer(e){return{next:0,buffer:new Float32Array(e),size:e,count:0,push(e){const t=this.buffer[this.next],n=this.count;return this.buffer[this.next]=e,this.next=(this.next+1)%this.size,this.count=Math.min(this.size,this.count+1),n===this.size?t:null},front(){if(this.count>0){const e=this.next-1,t=e<0?this.size-1:e;return this.buffer[t]}return null},back(){return this.count>0?this.buffer[this.next]:null}}}const DEFAULT_BUFFER_SIZE=20,AnimatedTextInput=createAnimatedComponent(TextInput);function loopAnimationFrame(e){let t=0;!function n(){requestAnimationFrame(r=>{t>0&&e(t,r),t=r,requestAnimationFrame(n)})}()}function getFps(e){return 1e3/e}function completeBufferRoutine(e,t){return getFps(((t=Math.round(t))-(e.push(t)??t))/e.count)}function JsPerformance({smoothingFrames:e}){const t=useSharedValue(null),n=useSharedValue(0),r=useRef(createCircularDoublesBuffer(e));useEffect(()=>{loopAnimationFrame((e,n)=>{n=Math.round(n);const o=completeBufferRoutine(r.current,n);t.value=(2*o).toFixed(0)})},[t,n]);const o=useAnimatedProps(()=>{const e="JS: "+(t.value??"N/A")+" ";return{text:e,defaultValue:e}});return _jsx(View,{style:styles.container,children:_jsx(AnimatedTextInput,{style:styles.text,animatedProps:o,editable:!1})})}function UiPerformance({smoothingFrames:e}){const t=useSharedValue(null),n=useSharedValue(null);useFrameCallback(({timestamp:r})=>{null===n.value&&(n.value=createCircularDoublesBuffer(e)),r=Math.round(r);const o=completeBufferRoutine(n.value,r);t.value=o.toFixed(0)});const r=useAnimatedProps(()=>{const e="UI: "+(t.value??"N/A")+" ";return{text:e,defaultValue:e}});return _jsx(View,{style:styles.container,children:_jsx(AnimatedTextInput,{style:styles.text,animatedProps:r,editable:!1})})}export function PerformanceMonitor({smoothingFrames:e=20}){return _jsxs(View,{style:styles.monitor,children:[_jsx(JsPerformance,{smoothingFrames:e}),_jsx(UiPerformance,{smoothingFrames:e})]})}const styles=StyleSheet.create({monitor:{flexDirection:"row",position:"absolute",backgroundColor:"#0006",zIndex:1e3},header:{fontSize:14,color:"#ffff",paddingHorizontal:5},text:{fontSize:13,fontVariant:["tabular-nums"],color:"#ffff",fontFamily:"monospace",paddingHorizontal:3},container:{alignItems:"center",justifyContent:"center",flexDirection:"row",flexWrap:"wrap"}});