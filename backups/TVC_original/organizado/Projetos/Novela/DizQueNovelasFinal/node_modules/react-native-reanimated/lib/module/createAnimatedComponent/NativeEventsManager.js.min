"use strict";import{findNodeHandle}from"../platformFunctions/findNodeHandle";import{WorkletEventHandler}from"../WorkletEventHandler";import{has}from"./utils";export class NativeEventsManager{#e;#t;#n=-1;constructor(e,t){this.#e=e,this.#t=t,this.#n=this.getEventViewTag()}attachEvents(){executeForEachEventHandler(this.#e.props,(e,t)=>{t.registerForEvents(this.#n,e)})}detachEvents(){executeForEachEventHandler(this.#e.props,(e,t)=>{t.unregisterFromEvents(this.#n)})}updateEvents(e){const t=this.getEventViewTag(!0);if(this.#n!==t)return executeForEachEventHandler(e,(e,t)=>{t.unregisterFromEvents(this.#n)}),this.#n=t,void this.attachEvents();executeForEachEventHandler(e,(e,t)=>{const n=this.#e.props[e];n?isWorkletEventHandler(n)&&n.workletEventHandler!==t&&(t.unregisterFromEvents(this.#n),n.workletEventHandler.registerForEvents(this.#n)):t.unregisterFromEvents(this.#n)}),executeForEachEventHandler(this.#e.props,(t,n)=>{e[t]||n.registerForEvents(this.#n)})}getEventViewTag(e=!1){const t=this.#e._componentRef;if(t?.getScrollableNode){const e=t.getScrollableNode();return"number"==typeof e?e:findNodeHandle(e)??-1}return this.#t?.setNativeProps?findNodeHandle(this.#e)??-1:e?t?.__nativeTag?t.__nativeTag??-1:findNodeHandle(t)??-1:this.#e.getComponentViewTag()}}function isWorkletEventHandler(e){return has("workletEventHandler",e)&&e.workletEventHandler instanceof WorkletEventHandler}function executeForEachEventHandler(e,t){for(const n in e){const o=e[n];isWorkletEventHandler(o)&&t(n,o.workletEventHandler)}}