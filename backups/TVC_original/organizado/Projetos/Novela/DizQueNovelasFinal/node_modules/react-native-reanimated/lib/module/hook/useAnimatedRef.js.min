"use strict";import{useRef,useState}from"react";import{createSerializable,serializableMappingCache}from"react-native-worklets";import{SHOULD_BE_USE_WEB}from"../common/constants";import{getShadowNodeWrapperFromRef}from"../fabricUtils";import{makeMutable}from"../mutables";import{findNodeHandle}from"../platformFunctions/findNodeHandle";function getComponentOrScrollable(e){return e.getNativeScrollRef?.()??e.getScrollableNode?.()??e}function useAnimatedRefBase(e){const t=useRef(new Map).current,r=useRef(null),n=useRef(null);if(!n.current){const a=n=>{if(n&&(r.current=e(n),a.getTag=()=>findNodeHandle(getComponentOrScrollable(n)),a.current=n,t.size)){const e=a?.getTag?.()??null;t.forEach((r,n)=>{r?.(),t.set(n,n(e))})}return r.current};a.observe=e=>{const r=e(a?.getTag?.()??null);return t.set(e,r),()=>{t.get(e)?.(),t.delete(e)}},a.current=null,n.current=a}return n.current}function useAnimatedRefNative(){const[e]=useState(()=>makeMutable(null)),t=useAnimatedRefBase(t=>{const r=getShadowNodeWrapperFromRef(getComponentOrScrollable(t));return e.value=r,r});if(!serializableMappingCache.get(t)){const r=createSerializable({__init:()=>()=>e.value});serializableMappingCache.set(t,r)}return t}function useAnimatedRefWeb(){return useAnimatedRefBase(e=>getComponentOrScrollable(e))}export const useAnimatedRef=SHOULD_BE_USE_WEB?useAnimatedRefWeb:useAnimatedRefNative;