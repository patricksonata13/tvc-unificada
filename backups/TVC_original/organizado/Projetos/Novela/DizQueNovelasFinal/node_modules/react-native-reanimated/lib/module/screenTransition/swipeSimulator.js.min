"use strict";import{RNScreensTurboModule}from"./RNScreensTurboModule";import{applyStyle,applyStyleForBelowTopScreen}from"./styleUpdater";const BASE_VELOCITY=400,ADDITIONAL_VELOCITY_FACTOR_X=400,ADDITIONAL_VELOCITY_FACTOR_Y=500,ADDITIONAL_VELOCITY_FACTOR_XY=600;function computeEasingProgress(t,n,a){if(Math.abs(n)<1)return 1;return a*((globalThis._getAnimationTimestamp()-t)/1e3)/n}function easing(t){return 1-Math.pow(1-t,5)}function computeProgress(t,n,a){const s=t.screenDimensions,e=Math.abs(n.translationX/s.width),i=Math.abs(n.translationY/s.height),o=Math.max(e,i);return a?o/2:o}function maybeScheduleNextFrame(t,n,a,s,e){if(n)a.onFinishAnimation?.();else{const n=a.stackTag,i=computeProgress(a,s,e);RNScreensTurboModule.updateTransition(n,i),requestAnimationFrame(t)}}export function getSwipeSimulator(t,n,a){const s=n.screenDimensions,e=globalThis._getAnimationTimestamp(),{isTransitionCanceled:i}=n,o={x:t.translationX,y:t.translationY},r=Math.sign(t.translationX),l=Math.sign(t.translationY),y=i?{x:0,y:0}:{x:r*s.width,y:l*s.height},h={x:Math.abs(y.x-o.x),y:Math.abs(y.y-o.y)},x={x:!1,y:!1},c={x:400,y:400};if("x"===a)c.y=0,c.x+=400*h.x/s.width;else if("y"===a)c.x=0,c.y+=500*h.y/s.height;else{const t=400+600*Math.sqrt(h.x**2+h.y**2)/Math.sqrt(s.width**2+s.height**2);Math.abs(o.x)>Math.abs(o.y)?(c.x=t,c.y=t*Math.abs(o.y/o.x)):(c.x=t*Math.abs(o.x/o.y),c.y=t)}if(i){const y=()=>{const g={x:computeEasingProgress(e,h.x,c.x),y:computeEasingProgress(e,h.y,c.y)};t.translationX=o.x-r*h.x*easing(g.x),t.translationY=o.y-l*h.y*easing(g.y),r>0?t.translationX<=0&&(x.x=!0,t.translationX=0):t.translationX>=0&&(x.x=!0,t.translationX=0),l>0?t.translationY<=0&&(x.y=!0,t.translationY=0):t.translationY>=0&&(x.y=!0,t.translationY=0),applyStyle(n,t);const u="x"===a?x.x:("y"===a||x.x)&&x.y;u&&(t.translationX=r*s.width,t.translationY=l*s.height,applyStyleForBelowTopScreen(n,t)),maybeScheduleNextFrame(y,u,n,t,i)};return y}{const a=()=>{const y={x:computeEasingProgress(e,h.x,c.x),y:computeEasingProgress(e,h.y,c.y)};t.translationX=o.x+r*h.x*easing(y.x),t.translationY=o.y+l*h.y*easing(y.y),r>0?t.translationX>=s.width&&(x.x=!0,t.translationX=s.width):t.translationX<=-s.width&&(x.x=!0,t.translationX=-s.width),l>0?t.translationY>=s.height&&(x.y=!0,t.translationY=s.height):t.translationY<=-s.height&&(x.y=!0,t.translationY=-s.height),applyStyle(n,t),maybeScheduleNextFrame(a,x.x||x.y,n,t,i)};return a}}