"use strict";import{executeOnUIRuntimeSync}from"react-native-worklets";import{withStyleAnimation}from"../animation";import{SHOULD_BE_USE_WEB}from"../common";import{LayoutAnimationType}from"../commonTypes";import{legacy_makeMutableUI as makeMutableUI}from"../mutables";const TAG_OFFSET=1e9;function startObservingProgress(t,e){e.addListener(t+1e9,()=>{global._notifyAboutProgress(t,e.value)})}function stopObservingProgress(t,e,o=!1){e.removeListener(t+1e9),global._notifyAboutEnd(t,o)}function createLayoutAnimationManager(){const t=new Map,e=new Map;return{start(o,n,a,i){const s=i(a);let r=s.animations;const l=t.get(o);l&&(r={...l,...s.animations}),t.set(o,r);let m=e.get(o);void 0===m?(m=makeMutableUI(s.initialValues),e.set(o,m)):(stopObservingProgress(o,m),m._value=s.initialValues);const c=withStyleAnimation(r);c.callback=a=>{if(a){t.delete(o),e.delete(o);const a=n===LayoutAnimationType.EXITING;stopObservingProgress(o,m,a)}s.callback&&s.callback(void 0!==a&&a)},startObservingProgress(o,m),m.value=c},stop(t){const o=e.get(t);o&&stopObservingProgress(t,o)}}}SHOULD_BE_USE_WEB||executeOnUIRuntimeSync(()=>{global.LayoutAnimationsManager=createLayoutAnimationManager()})();