"use strict";import{defineAnimation,getReduceMotionForAnimation}from"../util";import{GentleSpringConfig,GentleSpringConfigWithDuration}from"./springConfigs";import{calculateNewStiffnessToMatchDuration,checkIfConfigIsValid,criticallyDampedSpringCalculations,getEnergy,initialCalculations,isAnimationTerminatingCalculation,scaleZetaToMatchClamps,underDampedSpringCalculations}from"./springUtils";export const withSpring=(t,i,a)=>defineAnimation(t,()=>{const e={...{...GentleSpringConfig,...GentleSpringConfigWithDuration,overshootClamping:!1,energyThreshold:6e-9,velocity:0,reduceMotion:void 0,clamp:void 0},...i,useDuration:!(!i?.duration&&!i?.dampingRatio),skipAnimation:!1};return e.skipAnimation=!checkIfConfigIsValid(e),0===e.duration&&(e.skipAnimation=!0),{onFrame:function(t,i){const{toValue:a,current:n}=t;if(e.skipAnimation)return t.current=a,t.lastTimestamp=0,!0;const{lastTimestamp:o,velocity:s}=t,l=Math.min(i-o,64);t.lastTimestamp=i;const r=l/1e3,m=s,c=n-a,{zeta:u,omega0:g,omega1:p}=t,{position:f,velocity:d}=u<1?underDampedSpringCalculations(t,{zeta:u,v0:m,x0:c,omega0:g,omega1:p,t:r}):criticallyDampedSpringCalculations(t,{v0:m,x0:c,omega0:g,t:r});return t.current=f,t.velocity=d,!!isAnimationTerminatingCalculation(t,e)&&(t.velocity=0,t.current=a,t.lastTimestamp=0,!0)},onStart:function(t,i,a,n){t.current=i;let o=e.stiffness;const s=function(t,i){return t?.lastTimestamp&&t?.startTimestamp&&t?.toValue===i.toValue&&t?.duration===i.duration&&t?.dampingRatio===i.dampingRatio}(n,t),l=e.duration,r=s?n?.startValue:i-t.toValue;if(t.startValue=r,t.velocity=n?(s?n?.velocity:n?.velocity+e.velocity)||0:e.velocity||0,s)t.zeta=n?.zeta||0,t.omega0=n?.omega0||0,t.omega1=n?.omega1||0;else{if(e.useDuration){const i=s?l-((n?.lastTimestamp||0)-(n?.startTimestamp||0)):l;e.duration=i,o=calculateNewStiffnessToMatchDuration(r,e,t.velocity),e.stiffness=o}const{zeta:i,omega0:a,omega1:m}=initialCalculations(o,e);t.zeta=i,t.omega0=a,t.omega1=m,void 0!==e.clamp&&(t.zeta=scaleZetaToMatchClamps(t,e.clamp))}const m=getEnergy(r,e.velocity,e.stiffness,e.mass);t.initialEnergy=m,t.lastTimestamp=n?.lastTimestamp||a,t.startTimestamp=s&&n?.startTimestamp||a},toValue:t,velocity:e.velocity||0,current:t,startValue:0,callback:a,lastTimestamp:0,startTimestamp:0,zeta:0,omega0:0,omega1:0,initialEnergy:0,reduceMotion:getReduceMotionForAnimation(e.reduceMotion)}});