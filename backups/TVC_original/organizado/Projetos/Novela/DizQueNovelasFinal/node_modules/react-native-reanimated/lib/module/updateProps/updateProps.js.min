"use strict";import{runOnJS,runOnUI}from"react-native-worklets";import{IS_JEST,processBoxShadowNative,processBoxShadowWeb,processColorsInProps,processTransformOrigin,ReanimatedError,SHOULD_BE_USE_WEB}from"../common";import jsPropsUpdater from"../createAnimatedComponent/JSPropsUpdater";import{_updatePropsJS}from"../ReanimatedModule/js-reanimated";let updateProps;updateProps=SHOULD_BE_USE_WEB?(o,r,e)=>{o.value?.forEach(o=>{const a=o.tag;"boxShadow"in r&&(r.boxShadow=processBoxShadowWeb(r.boxShadow)),_updatePropsJS(r,a,e)})}:(o,r)=>{processColorsInProps(r),"transformOrigin"in r&&(r.transformOrigin=processTransformOrigin(r.transformOrigin)),"boxShadow"in r&&(r.boxShadow=processBoxShadowNative(r.boxShadow)),global.UpdatePropsManager.update(o,r)};export const updatePropsJestWrapper=(o,r,e,a)=>{a.forEach(o=>{o(r)}),e.current.value={...e.current.value,...r},updateProps(o,r)};export default updateProps;function updateJSProps(o){jsPropsUpdater.updateProps(o)}function createUpdatePropsManager(){const o=[],r=[];let e=!1;return{update(a,t){a.value.forEach(({tag:a,shadowNodeWrapper:p})=>{const s=a,{nativePropUpdates:n,jsPropUpdates:d}=((o,r)=>Object.entries(r).reduce((r,[e,a])=>(global._tagToJSPropNamesMapping[o]?.[e]?(r.jsPropUpdates??={},r.jsPropUpdates[e]=a):(r.nativePropUpdates??={},r.nativePropUpdates[e]=a),r),{}))(s,t);n&&o.push({shadowNodeWrapper:p,updates:n}),d&&r.push({tag:s,updates:d}),e||!n&&!d||(queueMicrotask(this.flush),e=!0)})},flush(){o.length&&(global._updateProps(o),o.length=0),r.length&&(runOnJS(updateJSProps)(r),r.length=0),e=!1}}}if(SHOULD_BE_USE_WEB){const o=()=>{if(!IS_JEST)throw new ReanimatedError("`UpdatePropsManager` is not available on non-native platform.")};global.UpdatePropsManager=new Proxy({},{get:o,set:()=>(o(),!1)})}else runOnUI(()=>{global.UpdatePropsManager=createUpdatePropsManager()})();