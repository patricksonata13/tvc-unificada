"use strict";import{logger}from"../../common";import{LayoutAnimationType}from"../../commonTypes";import{EasingNameSymbol}from"../../Easing";import{Keyframe}from"../animationBuilder";import{makeElementVisible}from"./componentStyle";import{getProcessedConfig,handleExitingAnimation,handleLayoutTransition,maybeModifyStyleForKeyframe,setElementAnimation}from"./componentUtils";import{Animations}from"./config";import{createAnimationWithInitialValues,createCustomKeyFrameAnimation}from"./createAnimation";import{areDOMRectsEqual}from"./domUtils";function chooseConfig(e,t){return e===LayoutAnimationType.ENTERING?t.entering:e===LayoutAnimationType.EXITING?t.exiting:e===LayoutAnimationType.LAYOUT?t.layout:null}function checkUndefinedAnimationFail(e,t){return!(e in Animations)&&!t&&(logger.warn("Couldn't load entering/exiting animation. Current version supports only predefined animations with modifiers: duration, delay, easing, randomizeDelay, withCallback, reducedMotion."),!0)}function maybeReportOverwrittenProperties(e,t){const i=/([a-zA-Z-]+)(?=:)/g,n=new Set;for(const t of e.matchAll(i))n.add(t[1]);const o=Array.from(t).filter(e=>n.has(e));0!==o.length&&logger.warn(`${1===o.length?"Property":"Properties"} [${o.join(", ")}] may be overwritten by a layout animation. Please wrap your component with an animated view and apply the layout animation on the wrapper.`)}function chooseAction(e,t,i,n){switch(e){case LayoutAnimationType.ENTERING:setElementAnimation(i,t,!0);break;case LayoutAnimationType.LAYOUT:n.reversed=t.reversed,handleLayoutTransition(i,t,n);break;case LayoutAnimationType.EXITING:handleExitingAnimation(i,t)}}function tryGetAnimationConfig(e,t){const i=chooseConfig(t,e);if(!i)return null;const n=t===LayoutAnimationType.LAYOUT,o=i instanceof Keyframe,a=void 0!==i.initialValues;let r;r=o?createCustomKeyFrameAnimation(i.definitions):"function"==typeof i?i.presetName:i.constructor.presetName,a&&(r=createAnimationWithInitialValues(r,i.initialValues));if(checkUndefinedAnimationFail(r,n||o||a))return null;if(o){const e=Object.keys(i.definitions);e.includes("100")||e.includes("to")||logger.warn("Neither '100' nor 'to' was specified in Keyframe definition. This may result in wrong final position of your component. One possible solution is to duplicate last timestamp in definition as '100' (or 'to')")}return getProcessedConfig(r,t,i)}export function startWebLayoutAnimation(e,t,i,n){const o=tryGetAnimationConfig(e,i);maybeModifyStyleForKeyframe(t,e.entering),o?.animationName in Animations&&maybeReportOverwrittenProperties(Animations[o?.animationName].style,t.style),o?chooseAction(i,o,t,n):makeElementVisible(t,0)}export function tryActivateLayoutTransition(e,t,i){if(!e.layout)return;const n=t.getBoundingClientRect();if(areDOMRectsEqual(n,i))return;const o=e.layout.enteringV?.presetName,a=e.layout.exitingV?.presetName,r=(i.width-n.width)/2,m=(i.height-n.height)/2,s={translateX:i.x-n.x+r,translateY:i.y-n.y+m,scaleX:i.width/n.width,scaleY:i.height/n.height,reversed:!1,easingX:e.layout.easingXV?.[EasingNameSymbol]??"ease",easingY:e.layout.easingYV?.[EasingNameSymbol]??"ease",entering:o,exiting:a};startWebLayoutAnimation(e,t,LayoutAnimationType.LAYOUT,s)}