"use strict";import{hasSuffix}from"../../../common";import{hasProp,isConfigPropertyAlias,isDefined,isRecord,kebabizeCamelCase}from"../../utils";const hasValueProcessor=s=>"object"==typeof s&&null!==s&&"process"in s;class BuilderBase{processedProps={};constructor(s){this.config=s}add(s,e){const i=this.config[s];i&&isDefined(e)&&!1!==i&&(!0===i?this.maybeAssignProp(s,String(e)):"string"==typeof i?this.maybeAssignProp(s,hasSuffix(e)?e:`${String(e)}${i}`):isConfigPropertyAlias(i)?this.add(i.as,e):this.customProcess(s,e))}maybeAssignProp(s,e){this.processedProps[s]??=e}maybeAssignProps(s){Object.entries(s).forEach(([s,e])=>this.maybeAssignProp(s,e))}handleProcess(s,e,i){const r=i?i(e):String(e);isDefined(r)&&(isRecord(r)?this.maybeAssignProps(r):this.maybeAssignProp(s,r))}}class StyleBuilderImpl extends BuilderBase{ruleBuildersSet=new Set;nameAliases={};constructor(s,e){super(s),this.buildHandler=e}buildFrom(s){return Object.entries(s).forEach(([s,e])=>this.add(s,e)),this.build()}build(){this.buildRuleBuilders();const s=this.buildHandler(this.processedProps,this.nameAliases);return this.cleanup(),s}customProcess(s,e){const i=this.config[s];"object"==typeof i&&(isRuleBuilder(i)?(this.ruleBuildersSet.add(i),i.add(s,e)):(hasValueProcessor(i)?this.handleProcess(s,e,i.process):this.maybeAssignProp(s,String(e)),hasProp(i,"name")&&(this.nameAliases[s]=i.name)))}buildRuleBuilders(){this.ruleBuildersSet.forEach(s=>this.maybeAssignProps(s.build())),this.ruleBuildersSet.clear()}cleanup(){this.processedProps={},this.nameAliases={}}}class RuleBuilderImpl extends BuilderBase{constructor(s,e){super(s),this.buildHandler=e}build(){const s=this.buildHandler(this.processedProps);return this.cleanup(),s}customProcess(s,e){const i=this.config[s];hasValueProcessor(i)&&this.handleProcess(s,e,i.process)}cleanup(){this.processedProps={}}}const isRuleBuilder=s=>s instanceof RuleBuilderImpl,defaultStyleBuildHandler=(s,e)=>{const i=Object.entries(s);return 0===i.length?null:i.map(([s,i])=>`${e[s]??kebabizeCamelCase(s)}: ${i}`).join("; ")};export function createStyleBuilder(s,e=defaultStyleBuildHandler){return new StyleBuilderImpl(s,e)}export function createRuleBuilder(s,e){return new RuleBuilderImpl(s,e)}