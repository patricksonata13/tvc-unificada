"use strict";import{WorkletsModule}from"react-native-worklets";import{IS_JEST,IS_WEB,IS_WINDOW_AVAILABLE,logger,ReanimatedError}from"../../common";import{SensorType}from"../../commonTypes";import{assertWorkletsVersion}from"../../platform-specific/workletsVersion";export function createJSReanimatedModule(){return new JSReanimated}class JSReanimated{#e=WorkletsModule;nextSensorId=0;sensors=new Map;platform=void 0;constructor(){__DEV__&&assertWorkletsVersion()}registerEventHandler(e,r,t){throw new ReanimatedError("registerEventHandler is not available in JSReanimated.")}unregisterEventHandler(e){throw new ReanimatedError("unregisterEventHandler is not available in JSReanimated.")}configureLayoutAnimationBatch(){}setShouldAnimateExitingForTag(){}registerSensor(e,r,t,n){if(!IS_WINDOW_AVAILABLE)return-1;if(void 0===this.platform&&this.detectPlatform(),!(this.getSensorName(e)in window))return logger.warn("Sensor is not available."+(IS_WEB&&"https:"!==location.protocol?" Make sure you use secure origin with `npx expo start --web --https`.":"")+(this.platform===Platform.WEB_IOS?" For iOS web, you will also have to also grant permission in the browser: https://dev.to/li/how-to-requestpermission-for-devicemotion-and-deviceorientation-events-in-ios-13-46g2.":"")),-1;void 0===this.platform&&this.detectPlatform();const a=this.initializeSensor(e,r);return a.addEventListener("reading",this.getSensorCallback(a,e,n)),a.start(),this.sensors.set(this.nextSensorId,a),this.nextSensorId++}getSensorCallback=(e,r,t)=>{switch(r){case SensorType.ACCELEROMETER:case SensorType.GRAVITY:return()=>{let{x:r,y:n,z:a}=e;this.platform===Platform.WEB_ANDROID&&([r,n,a]=[-r,-n,-a]),t({x:r,y:n,z:a,interfaceOrientation:0})};case SensorType.GYROSCOPE:case SensorType.MAGNETIC_FIELD:return()=>{const{x:r,y:n,z:a}=e;t({x:r,y:n,z:a,interfaceOrientation:0})};case SensorType.ROTATION:return()=>{const[r,n]=e.quaternion;let[,,a,o]=e.quaternion;this.platform===Platform.WEB_ANDROID&&([a,o]=[o,-a]);const i=-Math.atan2(2*(a*o+r*n),r*r-n*n-a*a+o*o),s=Math.sin(-2*(n*o-r*a)),l=-Math.atan2(2*(n*a+r*o),r*r+n*n-a*a-o*o);t({qw:r,qx:n,qy:a,qz:o,yaw:i,pitch:s,roll:l,interfaceOrientation:0})}}};unregisterSensor(e){const r=this.sensors.get(e);void 0!==r&&(r.stop(),this.sensors.delete(e))}subscribeForKeyboardEvents(e){return IS_WEB?logger.warn("useAnimatedKeyboard is not available on web yet."):IS_JEST?logger.warn("useAnimatedKeyboard is not available when using Jest."):logger.warn("useAnimatedKeyboard is not available on this configuration."),-1}unsubscribeFromKeyboardEvents(e){}initializeSensor(e,r){const t=r<=0?{referenceFrame:"device"}:{frequency:1e3/r};switch(e){case SensorType.ACCELEROMETER:return new window.Accelerometer(t);case SensorType.GYROSCOPE:return new window.Gyroscope(t);case SensorType.GRAVITY:return new window.GravitySensor(t);case SensorType.MAGNETIC_FIELD:return new window.Magnetometer(t);case SensorType.ROTATION:return new window.AbsoluteOrientationSensor(t)}}getSensorName(e){switch(e){case SensorType.ACCELEROMETER:return"Accelerometer";case SensorType.GRAVITY:return"GravitySensor";case SensorType.GYROSCOPE:return"Gyroscope";case SensorType.MAGNETIC_FIELD:return"Magnetometer";case SensorType.ROTATION:return"AbsoluteOrientationSensor"}}detectPlatform(){const e=navigator.userAgent||navigator.vendor||window.opera;void 0===e?this.platform=Platform.UNKNOWN:/iPad|iPhone|iPod/.test(e)?this.platform=Platform.WEB_IOS:/android/i.test(e)?this.platform=Platform.WEB_ANDROID:this.platform=Platform.WEB}getViewProp(e,r,t,n){throw new ReanimatedError("getViewProp is not available in JSReanimated.")}getStaticFeatureFlag(){return!1}setDynamicFeatureFlag(){}setViewStyle(e,r){throw new ReanimatedError("setViewStyle is not available in JSReanimated.")}markNodeAsRemovable(e){throw new ReanimatedError("markNodeAsRemovable is not available in JSReanimated.")}unmarkNodeAsRemovable(e){throw new ReanimatedError("unmarkNodeAsRemovable is not available in JSReanimated.")}registerCSSKeyframes(e,r,t){throw new ReanimatedError("`registerCSSKeyframes` is not available in JSReanimated.")}unregisterCSSKeyframes(e,r){throw new ReanimatedError("`unregisterCSSKeyframes` is not available in JSReanimated.")}applyCSSAnimations(e,r){throw new ReanimatedError("`applyCSSAnimations` is not available in JSReanimated.")}unregisterCSSAnimations(e){throw new ReanimatedError("`unregisterCSSAnimations` is not available in JSReanimated.")}registerCSSTransition(e,r){throw new ReanimatedError("`registerCSSTransition` is not available in JSReanimated.")}updateCSSTransition(e,r){throw new ReanimatedError("`updateCSSTransition` is not available in JSReanimated.")}unregisterCSSTransition(e){throw new ReanimatedError("`unregisterCSSTransition` is not available in JSReanimated.")}}export let Platform=function(e){return e.WEB_IOS="web iOS",e.WEB_ANDROID="web Android",e.WEB="web",e.UNKNOWN="unknown",e}({});