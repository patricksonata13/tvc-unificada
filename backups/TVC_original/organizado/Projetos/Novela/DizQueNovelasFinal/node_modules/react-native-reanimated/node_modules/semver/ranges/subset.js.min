"use strict";const Range=require("../classes/range.js"),Comparator=require("../classes/comparator.js"),{ANY:ANY}=Comparator,satisfies=require("../functions/satisfies.js"),compare=require("../functions/compare.js"),subset=(e,r,s={})=>{if(e===r)return!0;e=new Range(e,s),r=new Range(r,s);let o=!1;e:for(const t of e.set){for(const e of r.set){const r=simpleSubset(t,e,s);if(o=o||null!==r,r)continue e}if(o)return!1}return!0},minimumVersionWithPreRelease=[new Comparator(">=0.0.0-0")],minimumVersion=[new Comparator(">=0.0.0")],simpleSubset=(e,r,s)=>{if(e===r)return!0;if(1===e.length&&e[0].semver===ANY){if(1===r.length&&r[0].semver===ANY)return!0;e=s.includePrerelease?minimumVersionWithPreRelease:minimumVersion}if(1===r.length&&r[0].semver===ANY){if(s.includePrerelease)return!0;r=minimumVersion}const o=new Set;let t,n,i,a,m,l,u;for(const r of e)">"===r.operator||">="===r.operator?t=higherGT(t,r,s):"<"===r.operator||"<="===r.operator?n=lowerLT(n,r,s):o.add(r.semver);if(o.size>1)return null;if(t&&n){if(i=compare(t.semver,n.semver,s),i>0)return null;if(0===i&&(">="!==t.operator||"<="!==n.operator))return null}for(const e of o){if(t&&!satisfies(e,String(t),s))return null;if(n&&!satisfies(e,String(n),s))return null;for(const o of r)if(!satisfies(e,String(o),s))return!1;return!0}let f=!(!n||s.includePrerelease||!n.semver.prerelease.length)&&n.semver,p=!(!t||s.includePrerelease||!t.semver.prerelease.length)&&t.semver;f&&1===f.prerelease.length&&"<"===n.operator&&0===f.prerelease[0]&&(f=!1);for(const e of r){if(u=u||">"===e.operator||">="===e.operator,l=l||"<"===e.operator||"<="===e.operator,t)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),">"===e.operator||">="===e.operator){if(a=higherGT(t,e,s),a===e&&a!==t)return!1}else if(">="===t.operator&&!satisfies(t.semver,String(e),s))return!1;if(n)if(f&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===f.major&&e.semver.minor===f.minor&&e.semver.patch===f.patch&&(f=!1),"<"===e.operator||"<="===e.operator){if(m=lowerLT(n,e,s),m===e&&m!==n)return!1}else if("<="===n.operator&&!satisfies(n.semver,String(e),s))return!1;if(!e.operator&&(n||t)&&0!==i)return!1}return!(t&&l&&!n&&0!==i)&&(!(n&&u&&!t&&0!==i)&&(!p&&!f))},higherGT=(e,r,s)=>{if(!e)return r;const o=compare(e.semver,r.semver,s);return o>0?e:o<0||">"===r.operator&&">="===e.operator?r:e},lowerLT=(e,r,s)=>{if(!e)return r;const o=compare(e.semver,r.semver,s);return o<0?e:o>0||"<"===r.operator&&"<="===e.operator?r:e};module.exports=subset;