"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPackageEntryPoint=getPackageEntryPoint,exports.redirectModulePath=redirectModulePath;var _toPosixPath=_interopRequireDefault(require("./utils/toPosixPath")),_path=_interopRequireDefault(require("path"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function getPackageEntryPoint(t,e,a){const{mainFields:n}=t,r=e.packageJson;let i="index";for(const t of n)if("string"==typeof r[t]&&r[t].length){i=r[t];break}const o=matchSubpathFromMainFields([i,"./"===i.slice(0,2)?i.slice(2):"./"+i].flatMap(t=>[t,t+".js",t+".json",t.replace(/(\.js|\.json)$/,"")]),r,n);return"string"==typeof o?o:i}function redirectModulePath(t,e){const{getPackageForModule:a,mainFields:n,originModulePath:r}=t,i=_path.default.isAbsolute(e),o=a(i?e:r);if(null==o)return e;let s;if(e.startsWith(".")||i){const t=i?o.packageRelativePath:_path.default.join(_path.default.dirname(o.packageRelativePath),e);s=matchSubpathFromMainFields("./"+(0,_toPosixPath.default)(t),o.packageJson,n),"string"==typeof s&&(s=_path.default.isAbsolute(s)?_path.default.normalize(s):_path.default.join(o.rootPath,s))}else s=matchSubpathFromMainFields(e,o.packageJson,n);return null!=s?s:e}function matchSubpathFromMainFields(t,e,a){const n=a.map(t=>e[t]).filter(t=>null!=t&&"string"!=typeof t);if(!n.length)return null;const r=Object.assign({},...n.reverse()),i=Array.isArray(t)?t:expandSubpathVariants(t);for(const t of i){const e=r[t];if(null!=e)return e}return null}function expandSubpathVariants(t){return[t,t+".js",t+".json"]}