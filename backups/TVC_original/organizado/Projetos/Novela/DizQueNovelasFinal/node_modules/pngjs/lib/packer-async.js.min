"use strict";var util=require("util"),Stream=require("stream"),constants=require("./constants"),Packer=require("./packer"),PackerAsync=module.exports=function(t){Stream.call(this);var e=t||{};this._packer=new Packer(e),this._deflate=this._packer.createDeflate(),this.readable=!0};util.inherits(PackerAsync,Stream),PackerAsync.prototype.pack=function(t,e,a,i){this.emit("data",new Buffer(constants.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(e,a)),i&&this.emit("data",this._packer.packGAMA(i));var r=this._packer.filterData(t,e,a);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(t){this.emit("data",this._packer.packIDAT(t))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(r)};