"use strict";var assert=require("assert").ok,zlib=require("zlib"),util=require("util"),kMaxLength=require("buffer").kMaxLength;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);e&&e.chunkSize<zlib.Z_MIN_CHUNK&&(e.chunkSize=zlib.Z_MIN_CHUNK),zlib.Inflate.call(this,e),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,e&&null!=e.maxLength&&(this._maxLength=e.maxLength)}function createInflate(e){return new Inflate(e)}function _close(e,t){t&&process.nextTick(t),e._handle&&(e._handle.close(),e._handle=null)}function zlibBufferSync(e,t){if("string"==typeof t&&(t=Buffer.from(t)),!(t instanceof Buffer))throw new TypeError("Not a string or buffer");var n=e._finishFlushFlag;return null==n&&(n=zlib.Z_FINISH),e._processChunk(t,n)}function inflateSync(e,t){return zlibBufferSync(new Inflate(t),e)}Inflate.prototype._processChunk=function(e,t,n){if("function"==typeof n)return zlib.Inflate._processChunk.call(this,e,t,n);var f,r=this,i=e&&e.length,s=this._chunkSize-this._offset,l=this._maxLength,o=0,a=[],h=0;function u(e,t){if(!r._hadError){var n=s-t;if(assert(n>=0,"have should not go down"),n>0){var f=r._buffer.slice(r._offset,r._offset+n);if(r._offset+=n,f.length>l&&(f=f.slice(0,l)),a.push(f),h+=f.length,0===(l-=f.length))return!1}return(0===t||r._offset>=r._chunkSize)&&(s=r._chunkSize,r._offset=0,r._buffer=Buffer.allocUnsafe(r._chunkSize)),0===t&&(o+=i-e,i=e,!0)}}this.on("error",function(e){f=e}),assert(this._handle,"zlib binding closed");do{var c=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,s);c=c||this._writeState}while(!this._hadError&&u(c[0],c[1]));if(this._hadError)throw f;if(h>=kMaxLength)throw _close(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+kMaxLength.toString(16)+" bytes");var _=Buffer.concat(a,h);return _close(this),_},util.inherits(Inflate,zlib.Inflate),module.exports=exports=inflateSync,exports.Inflate=Inflate,exports.createInflate=createInflate,exports.inflateSync=inflateSync;