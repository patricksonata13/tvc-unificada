"use strict";var hasSyncZlib=!0,zlib=require("zlib");zlib.deflateSync||(hasSyncZlib=!1);var constants=require("./constants"),Packer=require("./packer");module.exports=function(e,a){if(!hasSyncZlib)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var r=new Packer(a||{}),t=[];t.push(new Buffer(constants.PNG_SIGNATURE)),t.push(r.packIHDR(e.width,e.height)),e.gamma&&t.push(r.packGAMA(e.gamma));var n=r.filterData(e.data,e.width,e.height),i=zlib.deflateSync(n,r.getDeflateOptions());if(n=null,!i||!i.length)throw new Error("bad png - invalid compressed data response");return t.push(r.packIDAT(i)),t.push(r.packIEND()),Buffer.concat(t)};