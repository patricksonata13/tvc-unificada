"use strict";function dePalette(r,e,o,t,a){for(var n=0,f=0;f<t;f++)for(var l=0;l<o;l++){var p=a[r[n]];if(!p)throw new Error("index "+r[n]+" not in palette");for(var v=0;v<4;v++)e[n+v]=p[v];n+=4}}function replaceTransparentColor(r,e,o,t,a){for(var n=0,f=0;f<t;f++)for(var l=0;l<o;l++){var p=!1;if(1===a.length?a[0]===r[n]&&(p=!0):a[0]===r[n]&&a[1]===r[n+1]&&a[2]===r[n+2]&&(p=!0),p)for(var v=0;v<4;v++)e[n+v]=0;n+=4}}function scaleDepth(r,e,o,t,a){for(var n=Math.pow(2,a)-1,f=0,l=0;l<t;l++)for(var p=0;p<o;p++){for(var v=0;v<4;v++)e[f+v]=Math.floor(255*r[f+v]/n+.5);f+=4}}module.exports=function(r,e){var o=e.depth,t=e.width,a=e.height,n=e.colorType,f=e.transColor,l=e.palette,p=r;return 3===n?dePalette(r,p,t,a,l):(f&&replaceTransparentColor(r,p,t,a,f),8!==o&&(16===o&&(p=new Buffer(t*a*4)),scaleDepth(r,p,t,a,o))),p};