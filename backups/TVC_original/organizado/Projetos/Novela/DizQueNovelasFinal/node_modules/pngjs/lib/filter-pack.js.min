"use strict";var paethPredictor=require("./paeth-predictor");function filterNone(r,e,t,f,i){for(var a=0;a<t;a++)f[i+a]=r[e+a]}function filterSumNone(r,e,t){for(var f=0,i=e+t,a=e;a<i;a++)f+=Math.abs(r[a]);return f}function filterSub(r,e,t,f,i,a){for(var n=0;n<t;n++){var u=n>=a?r[e+n-a]:0,o=r[e+n]-u;f[i+n]=o}}function filterSumSub(r,e,t,f){for(var i=0,a=0;a<t;a++){var n=a>=f?r[e+a-f]:0,u=r[e+a]-n;i+=Math.abs(u)}return i}function filterUp(r,e,t,f,i){for(var a=0;a<t;a++){var n=e>0?r[e+a-t]:0,u=r[e+a]-n;f[i+a]=u}}function filterSumUp(r,e,t){for(var f=0,i=e+t,a=e;a<i;a++){var n=e>0?r[a-t]:0,u=r[a]-n;f+=Math.abs(u)}return f}function filterAvg(r,e,t,f,i,a){for(var n=0;n<t;n++){var u=n>=a?r[e+n-a]:0,o=e>0?r[e+n-t]:0,l=r[e+n]-(u+o>>1);f[i+n]=l}}function filterSumAvg(r,e,t,f){for(var i=0,a=0;a<t;a++){var n=a>=f?r[e+a-f]:0,u=e>0?r[e+a-t]:0,o=r[e+a]-(n+u>>1);i+=Math.abs(o)}return i}function filterPaeth(r,e,t,f,i,a){for(var n=0;n<t;n++){var u=n>=a?r[e+n-a]:0,o=e>0?r[e+n-t]:0,l=e>0&&n>=a?r[e+n-(t+a)]:0,v=r[e+n]-paethPredictor(u,o,l);f[i+n]=v}}function filterSumPaeth(r,e,t,f){for(var i=0,a=0;a<t;a++){var n=a>=f?r[e+a-f]:0,u=e>0?r[e+a-t]:0,o=e>0&&a>=f?r[e+a-(t+f)]:0,l=r[e+a]-paethPredictor(n,u,o);i+=Math.abs(l)}return i}var filters={0:filterNone,1:filterSub,2:filterUp,3:filterAvg,4:filterPaeth},filterSums={0:filterSumNone,1:filterSumSub,2:filterSumUp,3:filterSumAvg,4:filterSumPaeth};module.exports=function(r,e,t,f,i){var a;if("filterType"in f&&-1!==f.filterType){if("number"!=typeof f.filterType)throw new Error("unrecognised filter types");a=[f.filterType]}else a=[0,1,2,3,4];16===f.bitDepth&&(i*=2);for(var n=e*i,u=0,o=0,l=new Buffer((n+1)*t),v=a[0],c=0;c<t;c++){if(a.length>1)for(var h=1/0,p=0;p<a.length;p++){var S=filterSums[a[p]](r,o,n,i);S<h&&(v=a[p],h=S)}l[u]=v,u++,filters[v](r,o,n,l,u,i),u+=n,o+=n}return l};