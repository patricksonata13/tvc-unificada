"use strict";var hasSyncZlib=!0,zlib=require("zlib"),inflateSync=require("./sync-inflate");zlib.deflateSync||(hasSyncZlib=!1);var SyncReader=require("./sync-reader"),FilterSync=require("./filter-parse-sync"),Parser=require("./parser"),bitmapper=require("./bitmapper"),formatNormaliser=require("./format-normaliser");module.exports=function(r,e){if(!hasSyncZlib)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var a,n,i;var t=[];var l=new SyncReader(r),o=new Parser(e,{read:l.read.bind(l),error:function(r){a=r},metadata:function(r){n=r},gamma:function(r){i=r},palette:function(r){n.palette=r},transColor:function(r){n.transColor=r},inflateData:function(r){t.push(r)},simpleTransparency:function(){n.alpha=!0}});if(o.start(),l.process(),a)throw a;var s,c=Buffer.concat(t);if(t.length=0,n.interlace)s=zlib.inflateSync(c);else{var p=(1+(n.width*n.bpp*n.depth+7>>3))*n.height;s=inflateSync(c,{chunkSize:p,maxLength:p})}if(c=null,!s||!s.length)throw new Error("bad png - invalid inflate data response");var f=FilterSync.process(s,n);c=null;var u=bitmapper.dataToBitMap(f,n);f=null;var d=formatNormaliser(u,n);return n.data=d,n.gamma=i||0,n};