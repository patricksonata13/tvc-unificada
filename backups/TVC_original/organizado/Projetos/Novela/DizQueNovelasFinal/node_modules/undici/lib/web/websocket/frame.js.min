"use strict";const{maxUnsigned16Bit:maxUnsigned16Bit}=require("./constants"),BUFFER_SIZE=16386;let crypto,buffer=null,bufIdx=16386;try{crypto=require("node:crypto")}catch{crypto={randomFillSync:function(e,t,r){for(let t=0;t<e.length;++t)e[t]=255*Math.random()|0;return e}}}function generateMask(){return 16386===bufIdx&&(bufIdx=0,crypto.randomFillSync(buffer??=Buffer.allocUnsafe(16386),0,16386)),[buffer[bufIdx++],buffer[bufIdx++],buffer[bufIdx++],buffer[bufIdx++]]}class WebsocketFrameSend{constructor(e){this.frameData=e}createFrame(e){const t=this.frameData,r=generateMask(),n=t?.byteLength??0;let f=n,a=6;n>maxUnsigned16Bit?(a+=8,f=127):n>125&&(a+=2,f=126);const o=Buffer.allocUnsafe(n+a);o[0]=o[1]=0,o[0]|=128,o[0]=(240&o[0])+e,
/*! ws. MIT License. Einar Otto Stangvik <einaros@gmail.com> */
o[a-4]=r[0],o[a-3]=r[1],o[a-2]=r[2],o[a-1]=r[3],o[1]=f,126===f?o.writeUInt16BE(n,2):127===f&&(o[2]=o[3]=0,o.writeUIntBE(n,4,6)),o[1]|=128;for(let e=0;e<n;++e)o[a+e]=t[e]^r[3&e];return o}}module.exports={WebsocketFrameSend:WebsocketFrameSend};