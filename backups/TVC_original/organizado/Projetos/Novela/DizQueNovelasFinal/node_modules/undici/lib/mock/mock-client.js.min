"use strict";const{promisify:promisify}=require("node:util"),Client=require("../dispatcher/client"),{buildMockDispatch:buildMockDispatch}=require("./mock-utils"),{kDispatches:kDispatches,kMockAgent:kMockAgent,kClose:kClose,kOriginalClose:kOriginalClose,kOrigin:kOrigin,kOriginalDispatch:kOriginalDispatch,kConnected:kConnected}=require("./mock-symbols"),{MockInterceptor:MockInterceptor}=require("./mock-interceptor"),Symbols=require("../core/symbols"),{InvalidArgumentError:InvalidArgumentError}=require("../core/errors");class MockClient extends Client{constructor(e,i){if(super(e,i),!i||!i.agent||"function"!=typeof i.agent.dispatch)throw new InvalidArgumentError("Argument opts.agent must implement Agent");this[kMockAgent]=i.agent,this[kOrigin]=e,this[kDispatches]=[],this[kConnected]=1,this[kOriginalDispatch]=this.dispatch,this[kOriginalClose]=this.close.bind(this),this.dispatch=buildMockDispatch.call(this),this.close=this[kClose]}get[Symbols.kConnected](){return this[kConnected]}intercept(e){return new MockInterceptor(e,this[kDispatches])}async[kClose](){await promisify(this[kOriginalClose])(),this[kConnected]=0,this[kMockAgent][Symbols.kClients].delete(this[kOrigin])}}module.exports=MockClient;