"use strict";const util=require("../core/util"),{InvalidArgumentError:InvalidArgumentError,RequestAbortedError:RequestAbortedError}=require("../core/errors"),DecoratorHandler=require("../handler/decorator-handler");class DumpHandler extends DecoratorHandler{#e=1048576;#r=null;#t=!1;#n=!1;#o=0;#i=null;#s=null;constructor({maxSize:e},r){if(super(r),null!=e&&(!Number.isFinite(e)||e<1))throw new InvalidArgumentError("maxSize must be a number greater than 0");this.#e=e??this.#e,this.#s=r}onConnect(e){this.#r=e,this.#s.onConnect(this.#a.bind(this))}#a(e){this.#n=!0,this.#i=e}onHeaders(e,r,t,n){const o=util.parseHeaders(r)["content-length"];if(null!=o&&o>this.#e)throw new RequestAbortedError(`Response size (${o}) larger than maxSize (${this.#e})`);return!!this.#n||this.#s.onHeaders(e,r,t,n)}onError(e){this.#t||(e=this.#i??e,this.#s.onError(e))}onData(e){return this.#o=this.#o+e.length,this.#o>=this.#e&&(this.#t=!0,this.#n?this.#s.onError(this.#i):this.#s.onComplete([])),!0}onComplete(e){this.#t||(this.#n?this.#s.onError(this.reason):this.#s.onComplete(e))}}function createDumpInterceptor({maxSize:e}={maxSize:1048576}){return r=>function(t,n){const{dumpMaxSize:o=e}=t,i=new DumpHandler({maxSize:o},n);return r(t,i)}}module.exports=createDumpInterceptor;