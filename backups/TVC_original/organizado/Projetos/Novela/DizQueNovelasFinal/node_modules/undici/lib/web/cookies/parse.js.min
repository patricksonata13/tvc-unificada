"use strict";const{maxNameValuePairSize:maxNameValuePairSize,maxAttributeValueSize:maxAttributeValueSize}=require("./constants"),{isCTLExcludingHtab:isCTLExcludingHtab}=require("./util"),{collectASequenceOfCodePointsFast:collectASequenceOfCodePointsFast}=require("../fetch/data-url"),assert=require("node:assert");function parseSetCookie(e){if(isCTLExcludingHtab(e))return null;let t="",s="",i="",n="";if(e.includes(";")){const i={position:0};t=collectASequenceOfCodePointsFast(";",e,i),s=e.slice(i.position)}else t=e;if(t.includes("=")){const e={position:0};i=collectASequenceOfCodePointsFast("=",t,e),n=t.slice(e.position+1)}else n=t;return i=i.trim(),n=n.trim(),i.length+n.length>maxNameValuePairSize?null:{name:i,value:n,...parseUnparsedAttributes(s)}}function parseUnparsedAttributes(e,t={}){if(0===e.length)return t;assert(";"===e[0]);let s="";(e=e.slice(1)).includes(";")?(s=collectASequenceOfCodePointsFast(";",e,{position:0}),e=e.slice(s.length)):(s=e,e="");let i="",n="";if(s.includes("=")){const e={position:0};i=collectASequenceOfCodePointsFast("=",s,e),n=s.slice(e.position+1)}else i=s;if(i=i.trim(),n=n.trim(),n.length>maxAttributeValueSize)return parseUnparsedAttributes(e,t);const r=i.toLowerCase();if("expires"===r){const e=new Date(n);t.expires=e}else if("max-age"===r){const s=n.charCodeAt(0);if((s<48||s>57)&&"-"!==n[0])return parseUnparsedAttributes(e,t);if(!/^\d+$/.test(n))return parseUnparsedAttributes(e,t);const i=Number(n);t.maxAge=i}else if("domain"===r){let e=n;"."===e[0]&&(e=e.slice(1)),e=e.toLowerCase(),t.domain=e}else if("path"===r){let e="";e=0===n.length||"/"!==n[0]?"/":n,t.path=e}else if("secure"===r)t.secure=!0;else if("httponly"===r)t.httpOnly=!0;else if("samesite"===r){let e="Default";const s=n.toLowerCase();s.includes("none")&&(e="None"),s.includes("strict")&&(e="Strict"),s.includes("lax")&&(e="Lax"),t.sameSite=e}else t.unparsed??=[],t.unparsed.push(`${i}=${n}`);return parseUnparsedAttributes(e,t)}module.exports={parseSetCookie:parseSetCookie,parseUnparsedAttributes:parseUnparsedAttributes};