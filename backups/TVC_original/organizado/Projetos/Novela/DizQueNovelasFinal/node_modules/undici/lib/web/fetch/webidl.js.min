"use strict";const{types:types,inspect:inspect}=require("node:util"),{markAsUncloneable:markAsUncloneable}=require("node:worker_threads"),{toUSVString:toUSVString}=require("../../core/util"),webidl={converters:{},util:{},errors:{}};webidl.errors.exception=function(e){return new TypeError(`${e.header}: ${e.message}`)},webidl.errors.conversionFailed=function(e){const r=1===e.types.length?"":" one of",t=`${e.argument} could not be converted to${r}: ${e.types.join(", ")}.`;return webidl.errors.exception({header:e.prefix,message:t})},webidl.errors.invalidArgument=function(e){return webidl.errors.exception({header:e.prefix,message:`"${e.value}" is an invalid ${e.type}.`})},webidl.brandCheck=function(e,r,t){if(!1!==t?.strict){if(!(e instanceof r)){const e=new TypeError("Illegal invocation");throw e.code="ERR_INVALID_THIS",e}}else if(e?.[Symbol.toStringTag]!==r.prototype[Symbol.toStringTag]){const e=new TypeError("Illegal invocation");throw e.code="ERR_INVALID_THIS",e}},webidl.argumentLengthCheck=function({length:e},r,t){if(e<r)throw webidl.errors.exception({message:`${r} argument${1!==r?"s":""} required, but${e?" only":""} ${e} found.`,header:t})},webidl.illegalConstructor=function(){throw webidl.errors.exception({header:"TypeError",message:"Illegal constructor"})},webidl.util.Type=function(e){switch(typeof e){case"undefined":return"Undefined";case"boolean":return"Boolean";case"string":return"String";case"symbol":return"Symbol";case"number":return"Number";case"bigint":return"BigInt";case"function":case"object":return null===e?"Null":"Object"}},webidl.util.markAsUncloneable=markAsUncloneable||(()=>{}),webidl.util.ConvertToInt=function(e,r,t,n){let i,o;64===r?(i=Math.pow(2,53)-1,o="unsigned"===t?0:Math.pow(-2,53)+1):"unsigned"===t?(o=0,i=Math.pow(2,r)-1):(o=Math.pow(-2,r)-1,i=Math.pow(2,r-1)-1);let l=Number(e);if(0===l&&(l=0),!0===n?.enforceRange){if(Number.isNaN(l)||l===Number.POSITIVE_INFINITY||l===Number.NEGATIVE_INFINITY)throw webidl.errors.exception({header:"Integer conversion",message:`Could not convert ${webidl.util.Stringify(e)} to an integer.`});if(l=webidl.util.IntegerPart(l),l<o||l>i)throw webidl.errors.exception({header:"Integer conversion",message:`Value must be between ${o}-${i}, got ${l}.`});return l}return Number.isNaN(l)||!0!==n?.clamp?Number.isNaN(l)||0===l&&Object.is(0,l)||l===Number.POSITIVE_INFINITY||l===Number.NEGATIVE_INFINITY?0:(l=webidl.util.IntegerPart(l),l%=Math.pow(2,r),"signed"===t&&l>=Math.pow(2,r)-1?l-Math.pow(2,r):l):(l=Math.min(Math.max(l,o),i),l=Math.floor(l)%2==0?Math.floor(l):Math.ceil(l),l)},webidl.util.IntegerPart=function(e){const r=Math.floor(Math.abs(e));return e<0?-1*r:r},webidl.util.Stringify=function(e){switch(webidl.util.Type(e)){case"Symbol":return`Symbol(${e.description})`;case"Object":return inspect(e);case"String":return`"${e}"`;default:return`${e}`}},webidl.sequenceConverter=function(e){return(r,t,n,i)=>{if("Object"!==webidl.util.Type(r))throw webidl.errors.exception({header:t,message:`${n} (${webidl.util.Stringify(r)}) is not iterable.`});const o="function"==typeof i?i():r?.[Symbol.iterator]?.(),l=[];let s=0;if(void 0===o||"function"!=typeof o.next)throw webidl.errors.exception({header:t,message:`${n} is not iterable.`});for(;;){const{done:r,value:i}=o.next();if(r)break;l.push(e(i,t,`${n}[${s++}]`))}return l}},webidl.recordConverter=function(e,r){return(t,n,i)=>{if("Object"!==webidl.util.Type(t))throw webidl.errors.exception({header:n,message:`${i} ("${webidl.util.Type(t)}") is not an Object.`});const o={};if(!types.isProxy(t)){const l=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const s of l){const l=e(s,n,i),a=r(t[s],n,i);o[l]=a}return o}const l=Reflect.ownKeys(t);for(const s of l){const l=Reflect.getOwnPropertyDescriptor(t,s);if(l?.enumerable){const l=e(s,n,i),a=r(t[s],n,i);o[l]=a}}return o}},webidl.interfaceConverter=function(e){return(r,t,n,i)=>{if(!1!==i?.strict&&!(r instanceof e))throw webidl.errors.exception({header:t,message:`Expected ${n} ("${webidl.util.Stringify(r)}") to be an instance of ${e.name}.`});return r}},webidl.dictionaryConverter=function(e){return(r,t,n)=>{const i=webidl.util.Type(r),o={};if("Null"===i||"Undefined"===i)return o;if("Object"!==i)throw webidl.errors.exception({header:t,message:`Expected ${r} to be one of: Null, Undefined, Object.`});for(const i of e){const{key:e,defaultValue:l,required:s,converter:a}=i;if(!0===s&&!Object.hasOwn(r,e))throw webidl.errors.exception({header:t,message:`Missing required key "${e}".`});let u=r[e];const c=Object.hasOwn(i,"defaultValue");if(c&&null!==u&&(u??=l()),s||c||void 0!==u){if(u=a(u,t,`${n}.${e}`),i.allowedValues&&!i.allowedValues.includes(u))throw webidl.errors.exception({header:t,message:`${u} is not an accepted type. Expected one of ${i.allowedValues.join(", ")}.`});o[e]=u}}return o}},webidl.nullableConverter=function(e){return(r,t,n)=>null===r?r:e(r,t,n)},webidl.converters.DOMString=function(e,r,t,n){if(null===e&&n?.legacyNullToEmptyString)return"";if("symbol"==typeof e)throw webidl.errors.exception({header:r,message:`${t} is a symbol, which cannot be converted to a DOMString.`});return String(e)},webidl.converters.ByteString=function(e,r,t){const n=webidl.converters.DOMString(e,r,t);for(let e=0;e<n.length;e++)if(n.charCodeAt(e)>255)throw new TypeError(`Cannot convert argument to a ByteString because the character at index ${e} has a value of ${n.charCodeAt(e)} which is greater than 255.`);return n},webidl.converters.USVString=toUSVString,webidl.converters.boolean=function(e){return Boolean(e)},webidl.converters.any=function(e){return e},webidl.converters["long long"]=function(e,r,t){return webidl.util.ConvertToInt(e,64,"signed",void 0,r,t)},webidl.converters["unsigned long long"]=function(e,r,t){return webidl.util.ConvertToInt(e,64,"unsigned",void 0,r,t)},webidl.converters["unsigned long"]=function(e,r,t){return webidl.util.ConvertToInt(e,32,"unsigned",void 0,r,t)},webidl.converters["unsigned short"]=function(e,r,t,n){return webidl.util.ConvertToInt(e,16,"unsigned",n,r,t)},webidl.converters.ArrayBuffer=function(e,r,t,n){if("Object"!==webidl.util.Type(e)||!types.isAnyArrayBuffer(e))throw webidl.errors.conversionFailed({prefix:r,argument:`${t} ("${webidl.util.Stringify(e)}")`,types:["ArrayBuffer"]});if(!1===n?.allowShared&&types.isSharedArrayBuffer(e))throw webidl.errors.exception({header:"ArrayBuffer",message:"SharedArrayBuffer is not allowed."});if(e.resizable||e.growable)throw webidl.errors.exception({header:"ArrayBuffer",message:"Received a resizable ArrayBuffer."});return e},webidl.converters.TypedArray=function(e,r,t,n,i){if("Object"!==webidl.util.Type(e)||!types.isTypedArray(e)||e.constructor.name!==r.name)throw webidl.errors.conversionFailed({prefix:t,argument:`${n} ("${webidl.util.Stringify(e)}")`,types:[r.name]});if(!1===i?.allowShared&&types.isSharedArrayBuffer(e.buffer))throw webidl.errors.exception({header:"ArrayBuffer",message:"SharedArrayBuffer is not allowed."});if(e.buffer.resizable||e.buffer.growable)throw webidl.errors.exception({header:"ArrayBuffer",message:"Received a resizable ArrayBuffer."});return e},webidl.converters.DataView=function(e,r,t,n){if("Object"!==webidl.util.Type(e)||!types.isDataView(e))throw webidl.errors.exception({header:r,message:`${t} is not a DataView.`});if(!1===n?.allowShared&&types.isSharedArrayBuffer(e.buffer))throw webidl.errors.exception({header:"ArrayBuffer",message:"SharedArrayBuffer is not allowed."});if(e.buffer.resizable||e.buffer.growable)throw webidl.errors.exception({header:"ArrayBuffer",message:"Received a resizable ArrayBuffer."});return e},webidl.converters.BufferSource=function(e,r,t,n){if(types.isAnyArrayBuffer(e))return webidl.converters.ArrayBuffer(e,r,t,{...n,allowShared:!1});if(types.isTypedArray(e))return webidl.converters.TypedArray(e,e.constructor,r,t,{...n,allowShared:!1});if(types.isDataView(e))return webidl.converters.DataView(e,r,t,{...n,allowShared:!1});throw webidl.errors.conversionFailed({prefix:r,argument:`${t} ("${webidl.util.Stringify(e)}")`,types:["BufferSource"]})},webidl.converters["sequence<ByteString>"]=webidl.sequenceConverter(webidl.converters.ByteString),webidl.converters["sequence<sequence<ByteString>>"]=webidl.sequenceConverter(webidl.converters["sequence<ByteString>"]),webidl.converters["record<ByteString, ByteString>"]=webidl.recordConverter(webidl.converters.ByteString,webidl.converters.ByteString),module.exports={webidl:webidl};