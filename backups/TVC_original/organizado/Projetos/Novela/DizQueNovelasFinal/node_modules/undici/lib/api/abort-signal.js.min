const{addAbortListener:addAbortListener}=require("../core/util"),{RequestAbortedError:RequestAbortedError}=require("../core/errors"),kListener=Symbol("kListener"),kSignal=Symbol("kSignal");function abort(e){e.abort?e.abort(e[kSignal]?.reason):e.reason=e[kSignal]?.reason??new RequestAbortedError,removeSignal(e)}function addSignal(e,r){e.reason=null,e[kSignal]=null,e[kListener]=null,r&&(r.aborted?abort(e):(e[kSignal]=r,e[kListener]=()=>{abort(e)},addAbortListener(e[kSignal],e[kListener])))}function removeSignal(e){e[kSignal]&&("removeEventListener"in e[kSignal]?e[kSignal].removeEventListener("abort",e[kListener]):e[kSignal].removeListener("abort",e[kListener]),e[kSignal]=null,e[kListener]=null)}module.exports={addSignal:addSignal,removeSignal:removeSignal};