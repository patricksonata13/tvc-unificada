"use strict";let fastNow=0;const RESOLUTION_MS=1e3,TICK_MS=499;let fastNowTimeout;const kFastTimer=Symbol("kFastTimer"),fastTimers=[],NOT_IN_LIST=-2,TO_BE_CLEARED=-1,PENDING=0,ACTIVE=1;function onTick(){fastNow+=499;let t=0,e=fastTimers.length;for(;t<e;){const s=fastTimers[t];0===s._state?(s._idleStart=fastNow-499,s._state=1):1===s._state&&fastNow>=s._idleStart+s._idleTimeout&&(s._state=-1,s._idleStart=-1,s._onTimeout(s._timerArg)),-1===s._state?(s._state=-2,0!==--e&&(fastTimers[t]=fastTimers[e])):++t}fastTimers.length=e,0!==fastTimers.length&&refreshTimeout()}function refreshTimeout(){fastNowTimeout?fastNowTimeout.refresh():(clearTimeout(fastNowTimeout),fastNowTimeout=setTimeout(onTick,499),fastNowTimeout.unref&&fastNowTimeout.unref())}class FastTimer{[kFastTimer]=!0;_state=-2;_idleTimeout=-1;_idleStart=-1;_onTimeout;_timerArg;constructor(t,e,s){this._onTimeout=t,this._idleTimeout=e,this._timerArg=s,this.refresh()}refresh(){-2===this._state&&fastTimers.push(this),fastNowTimeout&&1!==fastTimers.length||refreshTimeout(),this._state=0}clear(){this._state=-1,this._idleStart=-1}}module.exports={setTimeout:(t,e,s)=>e<=1e3?setTimeout(t,e,s):new FastTimer(t,e,s),clearTimeout(t){t[kFastTimer]?t.clear():clearTimeout(t)},setFastTimeout:(t,e,s)=>new FastTimer(t,e,s),clearFastTimeout(t){t.clear()},now:()=>fastNow,tick(t=0){fastNow+=t-1e3+1,onTick(),onTick()},reset(){fastNow=0,fastTimers.length=0,clearTimeout(fastNowTimeout),fastNowTimeout=null},kFastTimer:kFastTimer};