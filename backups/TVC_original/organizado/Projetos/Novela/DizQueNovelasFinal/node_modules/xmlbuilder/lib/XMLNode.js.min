(function(){var t,e,r,n,i,s,o,h,l,u,d,a,c,p,f,m,y={}.hasOwnProperty,g=[].splice;({isObject:m,isFunction:f,isEmpty:p,getValue:c}=require("./Utility")),h=null,r=null,n=null,i=null,s=null,d=null,a=null,u=null,o=null,e=null,l=null,t=null,module.exports=function(){class w{constructor(c){this.parent=c,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,h||(h=require("./XMLElement"),r=require("./XMLCData"),n=require("./XMLComment"),i=require("./XMLDeclaration"),s=require("./XMLDocType"),d=require("./XMLRaw"),a=require("./XMLText"),u=require("./XMLProcessingInstruction"),o=require("./XMLDummy"),e=require("./NodeType"),l=require("./XMLNodeList"),require("./XMLNamedNodeMap"),t=require("./DocumentPosition"))}setParent(t){var e,r,n,i,s;for(this.parent=t,t&&(this.options=t.options,this.stringify=t.stringify),s=[],r=0,n=(i=this.children).length;r<n;r++)e=i[r],s.push(e.setParent(this));return s}element(t,e,r){var n,i,s,o,h,l,u,d,a;if(l=null,null===e&&null==r&&([e,r]=[{},null]),null==e&&(e={}),e=c(e),m(e)||([r,e]=[e,r]),null!=t&&(t=c(t)),Array.isArray(t))for(s=0,u=t.length;s<u;s++)i=t[s],l=this.element(i);else if(f(t))l=this.element(t.apply());else if(m(t)){for(h in t)if(y.call(t,h))if(a=t[h],f(a)&&(a=a.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===h.indexOf(this.stringify.convertAttKey))l=this.attribute(h.substr(this.stringify.convertAttKey.length),a);else if(!this.options.separateArrayItems&&Array.isArray(a)&&p(a))l=this.dummy();else if(m(a)&&p(a))l=this.element(h);else if(this.options.keepNullNodes||null!=a)if(!this.options.separateArrayItems&&Array.isArray(a))for(o=0,d=a.length;o<d;o++)i=a[o],(n={})[h]=i,l=this.element(n);else m(a)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===h.indexOf(this.stringify.convertTextKey)?l=this.element(a):(l=this.element(h)).element(a):l=this.element(h,a);else l=this.dummy()}else l=this.options.keepNullNodes||null!==r?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===t.indexOf(this.stringify.convertTextKey)?this.text(r):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===t.indexOf(this.stringify.convertCDataKey)?this.cdata(r):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===t.indexOf(this.stringify.convertCommentKey)?this.comment(r):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===t.indexOf(this.stringify.convertRawKey)?this.raw(r):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===t.indexOf(this.stringify.convertPIKey)?this.instruction(t.substr(this.stringify.convertPIKey.length),r):this.node(t,e,r):this.dummy();if(null==l)throw new Error("Could not create any elements with: "+t+". "+this.debugInfo());return l}insertBefore(t,e,r){var n,i,s,o,h;if(null!=t?t.type:void 0)return o=e,(s=t).setParent(this),o?(i=children.indexOf(o),h=children.splice(i),children.push(s),Array.prototype.push.apply(children,h)):children.push(s),s;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return i=this.parent.children.indexOf(this),h=this.parent.children.splice(i),n=this.parent.element(t,e,r),Array.prototype.push.apply(this.parent.children,h),n}insertAfter(t,e,r){var n,i,s;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return i=this.parent.children.indexOf(this),s=this.parent.children.splice(i+1),n=this.parent.element(t,e,r),Array.prototype.push.apply(this.parent.children,s),n}remove(){var t;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return t=this.parent.children.indexOf(this),g.apply(this.parent.children,[t,t-t+1].concat([])),this.parent}node(t,e,r){var n;return null!=t&&(t=c(t)),e||(e={}),e=c(e),m(e)||([r,e]=[e,r]),n=new h(this,t,e),null!=r&&n.text(r),this.children.push(n),n}text(t){var e;return m(t)&&this.element(t),e=new a(this,t),this.children.push(e),this}cdata(t){var e;return e=new r(this,t),this.children.push(e),this}comment(t){var e;return e=new n(this,t),this.children.push(e),this}commentBefore(t){var e,r;return e=this.parent.children.indexOf(this),r=this.parent.children.splice(e),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,r),this}commentAfter(t){var e,r;return e=this.parent.children.indexOf(this),r=this.parent.children.splice(e+1),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,r),this}raw(t){var e;return e=new d(this,t),this.children.push(e),this}dummy(){return new o(this)}instruction(t,e){var r,n,i,s,o;if(null!=t&&(t=c(t)),null!=e&&(e=c(e)),Array.isArray(t))for(s=0,o=t.length;s<o;s++)r=t[s],this.instruction(r);else if(m(t))for(r in t)y.call(t,r)&&(n=t[r],this.instruction(r,n));else f(e)&&(e=e.apply()),i=new u(this,t,e),this.children.push(i);return this}instructionBefore(t,e){var r,n;return r=this.parent.children.indexOf(this),n=this.parent.children.splice(r),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,n),this}instructionAfter(t,e){var r,n;return r=this.parent.children.indexOf(this),n=this.parent.children.splice(r+1),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,n),this}declaration(t,r,n){var s,o;return s=this.document(),o=new i(s,t,r,n),0===s.children.length?s.children.unshift(o):s.children[0].type===e.Declaration?s.children[0]=o:s.children.unshift(o),s.root()||s}dtd(t,r){var n,i,o,h,l,u,d,a,c;for(n=this.document(),i=new s(n,t,r),o=h=0,u=(a=n.children).length;h<u;o=++h)if(a[o].type===e.DocType)return n.children[o]=i,i;for(o=l=0,d=(c=n.children).length;l<d;o=++l)if(c[o].isRoot)return n.children.splice(o,0,i),i;return n.children.push(i),i}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var t;for(t=this;t;){if(t.type===e.Document)return t.rootObject;if(t.isRoot)return t;t=t.parent}}document(){var t;for(t=this;t;){if(t.type===e.Document)return t;t=t.parent}}end(t){return this.document().end(t)}prev(){var t;if((t=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[t-1]}next(){var t;if(-1===(t=this.parent.children.indexOf(this))||t===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[t+1]}importDocument(t){var r,n,i,s,o;if((n=t.root().clone()).parent=this,n.isRoot=!1,this.children.push(n),this.type===e.Document&&(n.isRoot=!0,n.documentObject=this,this.rootObject=n,this.children))for(i=0,s=(o=this.children).length;i<s;i++)if((r=o[i]).type===e.DocType){r.name=n.name;break}return this}debugInfo(t){var e,r;return null!=(t=t||this.name)||(null!=(e=this.parent)?e.name:void 0)?null==t?"parent: <"+this.parent.name+">":(null!=(r=this.parent)?r.name:void 0)?"node: <"+t+">, parent: <"+this.parent.name+">":"node: <"+t+">":""}ele(t,e,r){return this.element(t,e,r)}nod(t,e,r){return this.node(t,e,r)}txt(t){return this.text(t)}dat(t){return this.cdata(t)}com(t){return this.comment(t)}ins(t,e){return this.instruction(t,e)}doc(){return this.document()}dec(t,e,r){return this.declaration(t,e,r)}e(t,e,r){return this.element(t,e,r)}n(t,e,r){return this.node(t,e,r)}t(t){return this.text(t)}d(t){return this.cdata(t)}c(t){return this.comment(t)}r(t){return this.raw(t)}i(t,e){return this.instruction(t,e)}u(){return this.up()}importXMLBuilder(t){return this.importDocument(t)}attribute(t,e){throw new Error("attribute() applies to element nodes only.")}att(t,e){return this.attribute(t,e)}a(t,e){return this.attribute(t,e)}removeAttribute(t){throw new Error("attribute() applies to element nodes only.")}replaceChild(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(t,e){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(e){var r,n;return(r=this)===e?0:this.document()!==e.document()?(n=t.Disconnected|t.ImplementationSpecific,Math.random()<.5?n|=t.Preceding:n|=t.Following,n):r.isAncestor(e)?t.Contains|t.Preceding:r.isDescendant(e)?t.Contains|t.Following:r.isPreceding(e)?t.Preceding:t.Following}isSameNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(t){var e,r,n;if(t.nodeType!==this.nodeType)return!1;if(t.children.length!==this.children.length)return!1;for(e=r=0,n=this.children.length-1;0<=n?r<=n:r>=n;e=0<=n?++r:--r)if(!this.children[e].isEqualNode(t.children[e]))return!1;return!0}getFeature(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(t,e,r){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(t){return!!t&&(t===this||this.isDescendant(t))}isDescendant(t){var e,r,n,i;for(r=0,n=(i=this.children).length;r<n;r++){if(t===(e=i[r]))return!0;if(e.isDescendant(t))return!0}return!1}isAncestor(t){return t.isDescendant(this)}isPreceding(t){var e,r;return e=this.treePosition(t),r=this.treePosition(this),-1!==e&&-1!==r&&e<r}isFollowing(t){var e,r;return e=this.treePosition(t),r=this.treePosition(this),-1!==e&&-1!==r&&e>r}treePosition(t){var e,r;return r=0,e=!1,this.foreachTreeNode(this.document(),function(n){if(r++,!e&&n===t)return e=!0}),e?r:-1}foreachTreeNode(t,e){var r,n,i,s,o;for(t||(t=this.document()),n=0,i=(s=t.children).length;n<i;n++){if(o=e(r=s[n]))return o;if(o=this.foreachTreeNode(r,e))return o}}}return Object.defineProperty(w.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(w.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(w.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(w.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(w.prototype,"childNodes",{get:function(){return this.childNodeList&&this.childNodeList.nodes||(this.childNodeList=new l(this.children)),this.childNodeList}}),Object.defineProperty(w.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(w.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(w.prototype,"previousSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t-1]||null}}),Object.defineProperty(w.prototype,"nextSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t+1]||null}}),Object.defineProperty(w.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(w.prototype,"textContent",{get:function(){var t,r,n,i,s;if(this.nodeType===e.Element||this.nodeType===e.DocumentFragment){for(s="",r=0,n=(i=this.children).length;r<n;r++)(t=i[r]).textContent&&(s+=t.textContent);return s}return null},set:function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),w}.call(this)}).call(this);