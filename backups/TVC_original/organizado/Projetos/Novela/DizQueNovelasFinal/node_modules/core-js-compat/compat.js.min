"use strict";const{compare:compare,filterOutStabilizedProposals:filterOutStabilizedProposals,has:has,intersection:intersection}=require("./helpers"),data=require("./data"),entries=require("./entries"),getModulesListForTargetVersion=require("./get-modules-list-for-target-version"),allModules=require("./modules"),targetsParser=require("./targets-parser");function throwInvalidFilter(e){throw new TypeError(`Specified invalid module name or pattern: ${e}`)}function atLeastSomeModules(e,t){return e.length||throwInvalidFilter(t),e}function getModules(e){return"string"==typeof e?has(entries,e)?entries[e]:atLeastSomeModules(allModules.filter(t=>t.startsWith(e)),e):e instanceof RegExp?atLeastSomeModules(allModules.filter(t=>e.test(t)),e):void throwInvalidFilter(e)}function normalizeModules(e){return new Set(Array.isArray(e)?[].concat(...e.map(getModules)):getModules(e))}function checkModule(e,t){const r={required:!t,targets:{}};if(!t)return r;const s=data[e];for(const[e,o]of t)has(s,e)&&!compare(o,"<",s[e])||(r.required=!0,r.targets[e]=o);return r}module.exports=function({filter:e=null,modules:t=null,exclude:r=[],targets:s=null,version:o=null,inverse:l=!1}={}){null==t&&(t=e),l=!!l;const i=s?targetsParser(s):null,n={list:[],targets:{}};r=normalizeModules(r),t=t?[...normalizeModules(t)]:allModules,r.size&&(t=t.filter(e=>!r.has(e))),t=intersection(t,o?getModulesListForTargetVersion(o):allModules),l||(t=filterOutStabilizedProposals(t));for(const e of t){const t=checkModule(e,i);t.required^l&&(n.list.push(e),n.targets[e]=t.targets)}return n};