var forge=require("./forge");require("./util"),require("./jsbn"),require("./random"),function(){if(forge.prime)module.exports=forge.prime;else{var e=module.exports=forge.prime=forge.prime||{},r=forge.jsbn.BigInteger,n=[6,4,2,4,2,4,6,2],t=new r(null);t.fromInt(30);var i=function(e,r){return e|r};e.generateProbablePrime=function(e,n,t){"function"==typeof n&&(t=n,n={});var i=(n=n||{}).algorithm||"PRIMEINC";"string"==typeof i&&(i={name:i}),i.options=i.options||{};var f=n.prng||forge.random,u={nextBytes:function(e){for(var r=f.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=r.charCodeAt(n)}};if("PRIMEINC"===i.name)return function(e,n,t,i){if("workers"in t)return function(e,n,t,i){if("undefined"==typeof Worker)return o(e,n,t,i);var f=a(e,n),u=t.workers,s=t.workLoad||100,m=30*s/8,g=t.workerScript||"forge/prime.worker.js";if(-1===u)return forge.util.estimateCores(function(e,r){e&&(r=2),u=r-1,l()});function l(){u=Math.max(1,u);for(var t=[],o=0;o<u;++o)t[o]=new Worker(g);for(o=0;o<u;++o)t[o].addEventListener("message",d);var l=!1;function d(o){if(!l){0;var u=o.data;if(u.found){for(var g=0;g<t.length;++g)t[g].terminate();return l=!0,i(null,new r(u.prime,16))}f.bitLength()>e&&(f=a(e,n));var d=f.toString(16);o.target.postMessage({hex:d,workLoad:s}),f.dAddOffset(m,0)}}}l()}(e,n,t,i);return o(e,n,t,i)}(e,u,i.options,t);throw new Error("Invalid prime generation algorithm: "+i.name)}}function o(e,r,n,t){var i=a(e,r),o=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(i.bitLength());"millerRabinTests"in n&&(o=n.millerRabinTests);var u=10;"maxBlockTime"in n&&(u=n.maxBlockTime),f(i,e,r,0,o,u,t)}function f(e,r,t,i,o,u,s){var m=+new Date;do{if(e.bitLength()>r&&(e=a(r,t)),e.isProbablePrime(o))return s(null,e);e.dAddOffset(n[i++%8],0)}while(u<0||+new Date-m<u);forge.util.setImmediate(function(){f(e,r,t,i,o,u,s)})}function a(e,n){var o=new r(e,n),f=e-1;return o.testBit(f)||o.bitwiseTo(r.ONE.shiftLeft(f),i,o),o.dAddOffset(31-o.mod(t).byteValue(),0),o}}();