const{DOMParser:DOMParser}=require("@xmldom/xmldom");exports.parse=parse;var TEXT_NODE=3,CDATA_NODE=4,COMMENT_NODE=8;function shouldIgnoreNode(e){return e.nodeType===TEXT_NODE||e.nodeType===COMMENT_NODE||e.nodeType===CDATA_NODE}function isEmptyNode(e){return!e.childNodes||0===e.childNodes.length}function invariant(e,n){if(!e)throw new Error(n)}function parse(e){var n=(new DOMParser).parseFromString(e);invariant("plist"===n.documentElement.nodeName,"malformed document. First element should be <plist>");var o=parsePlistXML(n.documentElement);return 1==o.length&&(o=o[0]),o}function parsePlistXML(e){var n,o,r,d,i,t;if(!e)return null;if("plist"===e.nodeName){if(d=[],isEmptyNode(e))return d;for(n=0;n<e.childNodes.length;n++)shouldIgnoreNode(e.childNodes[n])||d.push(parsePlistXML(e.childNodes[n]));return d}if("dict"===e.nodeName){if(o={},r=null,t=0,isEmptyNode(e))return o;for(n=0;n<e.childNodes.length;n++)shouldIgnoreNode(e.childNodes[n])||(t%2==0?(invariant("key"===e.childNodes[n].nodeName,"Missing key while parsing <dict/>."),r=parsePlistXML(e.childNodes[n])):(invariant("key"!==e.childNodes[n].nodeName,'Unexpected key "'+parsePlistXML(e.childNodes[n])+'" while parsing <dict/>.'),o[r]=parsePlistXML(e.childNodes[n])),t+=1);return t%2==1&&(o[r]=""),o}if("array"===e.nodeName){if(d=[],isEmptyNode(e))return d;for(n=0;n<e.childNodes.length;n++)shouldIgnoreNode(e.childNodes[n])||null!=(i=parsePlistXML(e.childNodes[n]))&&d.push(i);return d}if("#text"!==e.nodeName){if("key"===e.nodeName)return isEmptyNode(e)?"":(invariant("__proto__"!==e.childNodes[0].nodeValue,"__proto__ keys can lead to prototype pollution. More details on CVE-2022-22912"),e.childNodes[0].nodeValue);if("string"===e.nodeName){if(i="",isEmptyNode(e))return i;for(n=0;n<e.childNodes.length;n++){var a;(a=e.childNodes[n].nodeType)!==TEXT_NODE&&a!==CDATA_NODE||(i+=e.childNodes[n].nodeValue)}return i}if("integer"===e.nodeName)return invariant(!isEmptyNode(e),'Cannot parse "" as integer.'),parseInt(e.childNodes[0].nodeValue,10);if("real"===e.nodeName){for(invariant(!isEmptyNode(e),'Cannot parse "" as real.'),i="",n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===TEXT_NODE&&(i+=e.childNodes[n].nodeValue);return parseFloat(i)}if("data"===e.nodeName){if(i="",isEmptyNode(e))return Buffer.from(i,"base64");for(n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===TEXT_NODE&&(i+=e.childNodes[n].nodeValue.replace(/\s+/g,""));return Buffer.from(i,"base64")}if("date"===e.nodeName)return invariant(!isEmptyNode(e),'Cannot parse "" as Date.'),new Date(e.childNodes[0].nodeValue);if("null"===e.nodeName)return null;if("true"===e.nodeName)return!0;if("false"===e.nodeName)return!1;throw new Error("Invalid PLIST tag "+e.nodeName)}}