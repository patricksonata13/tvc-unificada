"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=inlinePlugin;var _createInlinePlatformChecks=_interopRequireDefault(require("./utils/createInlinePlatformChecks"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const env={name:"env"},nodeEnv={name:"NODE_ENV"},processId={name:"process"},dev={name:"__DEV__"};function inlinePlugin({types:e},t){const{isAssignmentExpression:r,isIdentifier:n,isMemberExpression:i,isObjectExpression:o,isObjectMethod:s,isObjectProperty:a,isSpreadElement:l,isStringLiteral:p}=e,{isPlatformNode:c,isPlatformSelectNode:d}=(0,_createInlinePlatformChecks.default)(e,t.requireName??"require");function u(t){return!t||(t=>e.isDeclareVariable(t.path))(t)}function f(t,r,i){let o=null;for(const i of t.properties)if((a(i)||s(i))&&(n(i.key)&&i.key.name===r||p(i.key)&&i.key.value===r)){if(a(i)){o=i.value;break}if(s(i)){o=e.toExpression(i);break}}return o??i()}return{visitor:{ReferencedIdentifier(t,r){var i,o;!r.opts.dev&&(i=t.node,t.parent,o=t.scope,n(i,dev)&&u(o.getBinding(dev.name)))&&t.replaceWith(e.booleanLiteral(r.opts.dev))},MemberExpression(t,o){const s=t.node,a=t.scope,l=o.opts;((e,t)=>r(t)&&t.left===e)(s,t.parent)||(l.inlinePlatform&&c(s,a,!!l.isWrapped)?t.replaceWith(e.stringLiteral(l.platform)):!l.dev&&((e,t)=>n(e.property,nodeEnv)&&i(e.object)&&n(e.object.property,env)&&n(e.object.object,processId)&&!t.getBinding(processId.name))(s,a)&&t.replaceWith(e.stringLiteral(l.dev?"development":"production")))},CallExpression(t,r){const i=t.node,a=t.scope,c=i.arguments[0],u=r.opts;if(u.inlinePlatform&&d(i,a,!!u.isWrapped)&&o(c)&&c.properties.every(e=>!0!==e.computed&&!l(e)&&(!s(e)||"method"===e.kind)&&(n(e.key)||p(e.key)))){const r=()=>f(c,"native",()=>f(c,"default",()=>e.identifier("undefined")));t.replaceWith(f(c,u.platform,r))}}}}}