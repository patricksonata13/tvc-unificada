"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=normalizePseudoglobals;var _traverse=_interopRequireDefault(require("@babel/traverse")),_nullthrows=_interopRequireDefault(require("nullthrows"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function normalizePseudoglobals(e,r){const t=new Set(r?.reservedNames??[]),o=[];return(0,_traverse.default)(e,{Program(e){const r=e.get("body.0.expression.arguments.0.params"),n=e.get("body.0.expression.arguments.0.body");if(!n||Array.isArray(n)||!Array.isArray(r))return void e.stop();const a=r.map(e=>e.node.name).filter(e=>!t.has(e)),s=new Set,i=a.map(e=>[e,getShortName(e,s)]);for(const[e,r]of i){if(t.has(r))throw new ReferenceError("Could not reserve the identifier "+r+" because it is the short name for "+e);o.push(rename(e,r,n.scope))}e.stop()}}),o}function getShortName(e,r){const t=/^[^A-Za-z]*([A-Za-z])|([A-Z])[a-z]|([A-Z])[A-Z]+$/g;let o;for(;o=t.exec(e);){const t=(o[1]||o[2]||o[3]||"").toLowerCase();if(!t)throw new ReferenceError("Could not identify any valid name for "+e);if(!r.has(t))return r.add(t),t}throw new ReferenceError(`Unable to determine short name for ${e}. The variables are not unique: ${Array.from(r).join(", ")}`)}function rename(e,r,t){let o=r;if(t.hasLabel(r)||t.hasBinding(r)||t.hasGlobal(r)||t.hasReference(r)){o=t.generateUid(r);const e=t.getProgramParent();(0,_nullthrows.default)(e.references)[r]=!0,(0,_nullthrows.default)(e.uids)[r]=!0}return t.rename(e,o),o}