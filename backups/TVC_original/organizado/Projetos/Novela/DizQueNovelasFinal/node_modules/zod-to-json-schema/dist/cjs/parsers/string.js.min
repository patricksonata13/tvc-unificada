"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseStringDef=exports.zodPatterns=void 0;const errorMessages_js_1=require("../errorMessages.js");let emojiRegex;function parseStringDef(e,a){const r={type:"string"};if(e.checks)for(const s of e.checks)switch(s.kind){case"min":(0,errorMessages_js_1.setResponseValueAndErrors)(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,a);break;case"max":(0,errorMessages_js_1.setResponseValueAndErrors)(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,a);break;case"email":switch(a.emailStrategy){case"format:email":addFormat(r,"email",s.message,a);break;case"format:idn-email":addFormat(r,"idn-email",s.message,a);break;case"pattern:zod":addPattern(r,exports.zodPatterns.email,s.message,a)}break;case"url":addFormat(r,"uri",s.message,a);break;case"uuid":addFormat(r,"uuid",s.message,a);break;case"regex":addPattern(r,s.regex,s.message,a);break;case"cuid":addPattern(r,exports.zodPatterns.cuid,s.message,a);break;case"cuid2":addPattern(r,exports.zodPatterns.cuid2,s.message,a);break;case"startsWith":addPattern(r,RegExp(`^${escapeLiteralCheckValue(s.value,a)}`),s.message,a);break;case"endsWith":addPattern(r,RegExp(`${escapeLiteralCheckValue(s.value,a)}$`),s.message,a);break;case"datetime":addFormat(r,"date-time",s.message,a);break;case"date":addFormat(r,"date",s.message,a);break;case"time":addFormat(r,"time",s.message,a);break;case"duration":addFormat(r,"duration",s.message,a);break;case"length":(0,errorMessages_js_1.setResponseValueAndErrors)(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,a),(0,errorMessages_js_1.setResponseValueAndErrors)(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,a);break;case"includes":addPattern(r,RegExp(escapeLiteralCheckValue(s.value,a)),s.message,a);break;case"ip":"v6"!==s.version&&addFormat(r,"ipv4",s.message,a),"v4"!==s.version&&addFormat(r,"ipv6",s.message,a);break;case"base64url":addPattern(r,exports.zodPatterns.base64url,s.message,a);break;case"jwt":addPattern(r,exports.zodPatterns.jwt,s.message,a);break;case"cidr":"v6"!==s.version&&addPattern(r,exports.zodPatterns.ipv4Cidr,s.message,a),"v4"!==s.version&&addPattern(r,exports.zodPatterns.ipv6Cidr,s.message,a);break;case"emoji":addPattern(r,exports.zodPatterns.emoji(),s.message,a);break;case"ulid":addPattern(r,exports.zodPatterns.ulid,s.message,a);break;case"base64":switch(a.base64Strategy){case"format:binary":addFormat(r,"binary",s.message,a);break;case"contentEncoding:base64":(0,errorMessages_js_1.setResponseValueAndErrors)(r,"contentEncoding","base64",s.message,a);break;case"pattern:zod":addPattern(r,exports.zodPatterns.base64,s.message,a)}break;case"nanoid":addPattern(r,exports.zodPatterns.nanoid,s.message,a);case"toLowerCase":case"toUpperCase":case"trim":break;default:(()=>{})()}return r}function escapeLiteralCheckValue(e,a){return"escape"===a.patternStrategy?escapeNonAlphaNumeric(e):e}exports.zodPatterns={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===emojiRegex&&(emojiRegex=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),emojiRegex),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/},exports.parseStringDef=parseStringDef;const ALPHA_NUMERIC=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function escapeNonAlphaNumeric(e){let a="";for(let r=0;r<e.length;r++)ALPHA_NUMERIC.has(e[r])||(a+="\\"),a+=e[r];return a}function addFormat(e,a,r,s){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&s.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:a,...r&&s.errorMessages&&{errorMessage:{format:r}}})):(0,errorMessages_js_1.setResponseValueAndErrors)(e,"format",a,r,s)}function addPattern(e,a,r,s){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&s.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:stringifyRegExpWithFlags(a,s),...r&&s.errorMessages&&{errorMessage:{pattern:r}}})):(0,errorMessages_js_1.setResponseValueAndErrors)(e,"pattern",stringifyRegExpWithFlags(a,s),r,s)}function stringifyRegExpWithFlags(e,a){if(!a.applyRegexFlags||!e.flags)return e.source;const r=e.flags.includes("i"),s=e.flags.includes("m"),t=e.flags.includes("s"),n=r?e.source.toLowerCase():e.source;let o="",i=!1,d=!1,g=!1;for(let e=0;e<n.length;e++)if(i)o+=n[e],i=!1;else{if(r)if(d){if(n[e].match(/[a-z]/)){g?(o+=n[e],o+=`${n[e-2]}-${n[e]}`.toUpperCase(),g=!1):"-"===n[e+1]&&n[e+2]?.match(/[a-z]/)?(o+=n[e],g=!0):o+=`${n[e]}${n[e].toUpperCase()}`;continue}}else if(n[e].match(/[a-z]/)){o+=`[${n[e]}${n[e].toUpperCase()}]`;continue}if(s){if("^"===n[e]){o+="(^|(?<=[\r\n]))";continue}if("$"===n[e]){o+="($|(?=[\r\n]))";continue}}t&&"."===n[e]?o+=d?`${n[e]}\r\n`:`[${n[e]}\r\n]`:(o+=n[e],"\\"===n[e]?i=!0:d&&"]"===n[e]?d=!1:d||"["!==n[e]||(d=!0))}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${a.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}