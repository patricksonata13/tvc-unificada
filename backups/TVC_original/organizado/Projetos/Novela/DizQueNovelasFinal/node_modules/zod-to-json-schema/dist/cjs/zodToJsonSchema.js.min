"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.zodToJsonSchema=void 0;const parseDef_js_1=require("./parseDef.js"),Refs_js_1=require("./Refs.js"),any_js_1=require("./parsers/any.js"),zodToJsonSchema=(e,t)=>{const n=(0,Refs_js_1.getRefs)(t);let a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:(0,parseDef_js_1.parseDef)(a._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??(0,any_js_1.parseAnyDef)(n)}),{}):void 0;const s="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,o=(0,parseDef_js_1.parseDef)(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??(0,any_js_1.parseAnyDef)(n),r="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==r&&(o.title=r),n.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[n.openAiAnyTypeName]||(a[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const i=void 0===s?a?{...o,[n.definitionPath]:a}:o:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...a,[s]:o}};return"jsonSchema7"===n.target?i.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==n.target&&"openAi"!==n.target||(i.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};exports.zodToJsonSchema=zodToJsonSchema;