"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseDef=void 0;const Options_js_1=require("./Options.js"),selectParser_js_1=require("./selectParser.js"),getRelativePath_js_1=require("./getRelativePath.js"),any_js_1=require("./parsers/any.js");function parseDef(e,t,r=!1){const s=t.seen.get(e);if(t.override){const n=t.override?.(e,t,s,r);if(n!==Options_js_1.ignoreOverride)return n}if(s&&!r){const e=get$ref(s,t);if(void 0!==e)return e}const n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);const a=(0,selectParser_js_1.selectParser)(e,e.typeName,t),o="function"==typeof a?parseDef(a(),t):a;if(o&&addMeta(e,t,o),t.postProcess){const r=t.postProcess(o,e,t);return n.jsonSchema=o,r}return n.jsonSchema=o,o}exports.parseDef=parseDef;const get$ref=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:(0,getRelativePath_js_1.getRelativePath)(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),(0,any_js_1.parseAnyDef)(t)):"seen"===t.$refStrategy?(0,any_js_1.parseAnyDef)(t):void 0}},addMeta=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);