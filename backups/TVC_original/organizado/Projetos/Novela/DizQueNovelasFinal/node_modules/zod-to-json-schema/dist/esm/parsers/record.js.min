import{ZodFirstPartyTypeKind}from"zod";import{parseDef}from"../parseDef.js";import{parseStringDef}from"./string.js";import{parseBrandedDef}from"./branded.js";import{parseAnyDef}from"./any.js";export function parseRecordDef(e,r){if("openAi"===r.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===r.target&&e.keyType?._def.typeName===ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((t,p)=>({...t,[p]:parseDef(e.valueType._def,{...r,currentPath:[...r.currentPath,"properties",p]})??parseAnyDef(r)}),{}),additionalProperties:r.rejectedAdditionalProperties};const t={type:"object",additionalProperties:parseDef(e.valueType._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??r.allowedAdditionalProperties};if("openApi3"===r.target)return t;if(e.keyType?._def.typeName===ZodFirstPartyTypeKind.ZodString&&e.keyType._def.checks?.length){const{type:p,...a}=parseStringDef(e.keyType._def,r);return{...t,propertyNames:a}}if(e.keyType?._def.typeName===ZodFirstPartyTypeKind.ZodEnum)return{...t,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===ZodFirstPartyTypeKind.ZodBranded&&e.keyType._def.type._def.typeName===ZodFirstPartyTypeKind.ZodString&&e.keyType._def.type._def.checks?.length){const{type:p,...a}=parseBrandedDef(e.keyType._def,r);return{...t,propertyNames:a}}return t}