import{VOID,PRIMITIVE,ARRAY,OBJECT,DATE,REGEXP,MAP,SET,ERROR,BIGINT}from"./types.js";const env="object"==typeof self?self:globalThis,deserializer=(e,r)=>{const n=(r,n)=>(e.set(n,r),r),t=s=>{if(e.has(s))return e.get(s);const[a,c]=r[s];switch(a){case PRIMITIVE:case VOID:return n(c,s);case ARRAY:{const e=n([],s);for(const r of c)e.push(t(r));return e}case OBJECT:{const e=n({},s);for(const[r,n]of c)e[t(r)]=t(n);return e}case DATE:return n(new Date(c),s);case REGEXP:{const{source:e,flags:r}=c;return n(new RegExp(e,r),s)}case MAP:{const e=n(new Map,s);for(const[r,n]of c)e.set(t(r),t(n));return e}case SET:{const e=n(new Set,s);for(const r of c)e.add(t(r));return e}case ERROR:{const{name:e,message:r}=c;return n(new env[e](r),s)}case BIGINT:return n(BigInt(c),s);case"BigInt":return n(Object(BigInt(c)),s);case"ArrayBuffer":return n(new Uint8Array(c).buffer,c);case"DataView":{const{buffer:e}=new Uint8Array(c);return n(new DataView(e),c)}}return n(new env[a](c),s)};return t};export const deserialize=e=>deserializer(new Map,e)(0);